<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[阿城的blog]]></title>
  <subtitle><![CDATA[抓啊抓啊~~~]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://qiutc.me/"/>
  <updated>2016-03-05T04:22:31.000Z</updated>
  <id>http://qiutc.me/</id>
  
  <author>
    <name><![CDATA[阿城]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[JavaScript中的函数式编程二(翻译)]]></title>
    <link href="http://qiutc.me/post/JavaScript%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%BA%8C-%E7%BF%BB%E8%AF%91.html"/>
    <id>http://qiutc.me/post/JavaScript中的函数式编程二-翻译.html</id>
    <published>2016-03-01T03:05:08.000Z</published>
    <updated>2016-03-05T04:22:31.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/img/js.jpeg" alt="js"></p>
<h1 id="tips">tips</h1><p>原文链接: <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-arrays/" target="_blank" rel="external">http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-arrays/</a>;<br>原文作者: <a href="http://jrsinclair.com/about.html" target="_blank" rel="external">James Sinclair</a>;</p>
<h1 id="JavaScript_函数式编程">JavaScript 函数式编程</h1><p>这篇文章是介绍函数式编程的四篇文章中的第二篇。在上一篇文章中，我们看到如何使用函数使代码抽象地更简洁，在这篇文章中我们将使用这个技术在列表上。</p>
<ul>
<li>Part1 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-intro/" target="_blank" rel="external">组成部分和动机</a>,</li>
<li>Part2 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-arrays/" target="_blank" rel="external">使用数组和列表</a>,</li>
<li>Part3 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-functions/" target="_blank" rel="external">生成函数的函数</a>,</li>
<li>Part4 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-functions/" target="_blank" rel="external">使用函数式编程的风格</a>,</li>
</ul>
<h1 id="处理函数和集合">处理函数和集合</h1><p>会想之前的文章，我们谈论了 DRY 准则。我们看到用函数绑定一系列重复的操作是很有用的。但是如果我们重复同一个函数很多次呢？就像这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addColour</span>(<span class="params">colour</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> rainbowEl = <span class="built_in">document</span>.getElementById(<span class="string">'rainbow'</span>);</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    div.style.paddingTop = <span class="string">'10px'</span>;</span><br><span class="line">    div.style.backgroundColour = colour;</span><br><span class="line">    rainbowEl.appendChild(div);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addColour(<span class="string">'red'</span>);</span><br><span class="line">addColour(<span class="string">'orange'</span>);</span><br><span class="line">addColour(<span class="string">'yellow'</span>);</span><br><span class="line">addColour(<span class="string">'green'</span>);</span><br><span class="line">addColour(<span class="string">'blue'</span>);</span><br><span class="line">addColour(<span class="string">'purple'</span>);</span><br></pre></td></tr></table></figure></p>
<p>在这里 addColour 这个函数被调用很多次，我们仍然重复了我们自己，这是我们一直想回避的。一种重构的方法是构建一个数组包含这些颜色的列表，然后循环调用 addColour 这个函数。<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var colours = [</span><br><span class="line">    <span class="string">'red'</span>, <span class="string">'orange'</span>, <span class="string">'yellow'</span>,</span><br><span class="line">    <span class="string">'green'</span>, <span class="string">'blue'</span>, <span class="string">'purple'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">for <span class="comment">(var i = 0; i &lt; colours.length; i = i + 1)</span> &#123;</span><br><span class="line">    addColour<span class="comment">(colours[i])</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="For-Each">For-Each</h1><p>JavaScript 允许我们把一个函数座位参数传递给另一个函数，编写一个 forEach 函数是相当明确了：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forEach</span><span class="params">(callback, <span class="keyword">array</span>)</span> <span class="comment">&#123;</span><br><span class="line">    for (var i = 0; i &lt; array.length; i = i + 1) &#123;</span><br><span class="line">        callback(array[i], i);</span><br><span class="line">    &#125;</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>这个函数接受执行 callback 函数，并且把数组的每一项作为参数调用 callback 函数。<br>现在，在我们的例子中，我们想要对数组的每一个元素去运行 addColour 方法，使用我们的 forEach 我们仅需一行就能完美执行～<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forEach<span class="list">(<span class="keyword">addColour</span>, colours)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>对数组中的每一个元素调用一个方法是非常有用的一个工具，JavaScript 也实现了这么一个特性组成，作为数组对象的一个方法。因此我们也可以使用它来替代我们的 forEach 方法，如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> colours = [</span><br><span class="line">    <span class="string">'red'</span>, <span class="string">'orange'</span>, <span class="string">'yellow'</span>,</span><br><span class="line">    <span class="string">'green'</span>, <span class="string">'blue'</span>, <span class="string">'purple'</span></span><br><span class="line">];</span><br><span class="line">colours.<span class="keyword">forEach</span>(addColour);</span><br></pre></td></tr></table></figure></p>
<p>我们可以查找更多的方法在 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" target="_blank" rel="external">MDN 的 JavaScript 参考文档里</a>。</p>
<h1 id="Map">Map</h1><p>我们的 forEach 已经非常好用了，但是扔有一些局限性。如果回调函数返回一个值，那 forEach 只会忽略掉这个返回值。我们可以适当改造一下 forEach 函数，无论他返回什么类型的值我们都可以取得。我们可以得到一个数组，它包含了我们原始数字相对应的一些值。<br>让我们看看下面的例子，我们有一个 ID 的数组，然后我们想得到他们每个相对应的 DOM 元素集合。在程序上找到解决的方法，我们可以使用循环：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ids = [<span class="string">'unicorn'</span>, <span class="string">'fairy'</span>, <span class="string">'kitten'</span>];</span><br><span class="line"><span class="keyword">var</span> elements = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ids.length; i = i + <span class="number">1</span>) <span class="comment">&#123;</span><br><span class="line">    elements[i] = document.getElementById(ids[i]);</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="comment">// elements now contains the elements we are after</span></span><br></pre></td></tr></table></figure></p>
<p>我们想要阐明计算机是如何创建一个索引变量并且增加它－－细节我们不需多考虑。让我们使用循环就像 forEach 里面一样，并且把它复制给一个叫做 map 的变量。<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="function"><span class="keyword">function</span><span class="params">(callback, <span class="keyword">array</span>)</span> <span class="comment">&#123;</span><br><span class="line">    var newArray = [];</span><br><span class="line">    for (var i = 0; i &lt; array.length; i = i + 1) &#123;</span><br><span class="line">        newArray[i] = callback(array[i], i);</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="title">return</span> <span class="title">newArray</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在我们有了一个 map 函数，可以这么实用它：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getElement = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> elements = map(getElement, ids);</span><br></pre></td></tr></table></figure></p>
<p>这个 map 函数小而简单，但是它里面执行了另一个我们的超级函数，只需在数组的一个入口调用它一次就可以了，成倍的增长了函数的效率。<br>像 forEach 函数一样，JavaScript 本身也实现了 map 函数，作为数组对象的一个方法。我们可以调用这部分方法如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ids = [<span class="string">'unicorn'</span>, <span class="string">'fairy'</span>, <span class="string">'kitten'</span>];</span><br><span class="line"><span class="keyword">var</span> getElement = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> elements = ids.map(getElement, ids);</span><br></pre></td></tr></table></figure></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" target="_blank" rel="external">我们可以在 MDN 上查阅更多关于 map 函数的组成。</a></p>
<h1 id="Reduce">Reduce</h1><p>嗯，map 函数事很有用的。但是我们想实现一个更有用的函数，如果我们对所有的数组元素执行函数但是返回仅仅一个值。这听起来可能有一点反常，函数返回一个值为什么会比返回多个值更有用？为了寻找答案，我们可以先看看下面这个函数是如何工作的。<br>为了解释，我们考虑两个相似的问题：</p>
<ul>
<li>给一个数组一些数值元素，并且计算他们的和；</li>
<li>给一个数组一些字符串元素，并且用空格符在他们直接连接起来。<br>现在我们来看看一个愚蠢、微不足道的例子－－事实是他们也确实如此。这对于我来说相当难忍受，但是如果我们一旦学习到 reduce 函数是如何工作的，我们就可以把它应用在很多有趣的情况下。<br>我们再来看看程序上时如可解决这个问题的，还是循环：<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Given an array of numbers, calculate the sum</span></span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line"><span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; numbers.length; i = i + <span class="number">1</span>) <span class="comment">&#123;</span><br><span class="line">    total = total + numbers[i];</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="comment">// total is 25</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Given an array of words, join them together with a space between each word.</span></span><br><span class="line"><span class="keyword">var</span> words = [<span class="string">'sparkle'</span>, <span class="string">'fairies'</span>, <span class="string">'are'</span>, <span class="string">'amazing'</span>];</span><br><span class="line"><span class="keyword">var</span> sentence = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; words.length; i++) <span class="comment">&#123;</span><br><span class="line">    sentence = sentence + ' ' + words[i];</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="comment">// ' sparkle fairies are amazing'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>两个方案都是一样的其实，他们都使用for循环去迭代，他们都有个执行变量（total 和 sentence），他们都对执行变量赋值一个初始值。<br>让我们把他们循环中的操作抽出来写一个函数：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span><span class="params">(a, b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Given an array of numbers, calculate the sum</span></span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line"><span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; numbers.length; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">    total = add(total, numbers[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// total is 25</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">joinWord</span><span class="params">(sentence, word)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sentence + <span class="string">' '</span> + word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Given an array of words, join them together with a space between each word.</span></span><br><span class="line"><span class="keyword">var</span> words = [<span class="string">'sparkle'</span>, <span class="string">'fairies'</span>, <span class="string">'are'</span>, <span class="string">'amazing'</span>];</span><br><span class="line"><span class="keyword">var</span> sentence = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; words.length; i++) &#123;</span><br><span class="line">    sentence = joinWord(sentence, words[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 'sparkle fairies are amazing'</span></span><br></pre></td></tr></table></figure></p>
<p>现在，它变得简洁有用了，内部函数把执行变量作为他的第一个参数，然后当前遍历到的数组元素值作为第二个参数。现在我们让它更加简洁，我们把凌乱的 for 循环放到函数里面。<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reduce = <span class="function"><span class="keyword">function</span><span class="params">(callback, initialValue, <span class="keyword">array</span>)</span> <span class="comment">&#123;</span><br><span class="line">    var working = initialValue;</span><br><span class="line">    for (var i = 0; i &lt; array.length; i = i + 1) &#123;</span><br><span class="line">        working = callback(working, array[i]);</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="title">return</span> <span class="title">working</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>现在我们又个闪闪发亮的 reduce 新函数了，让我们来使用使用它：<br><figure class="highlight golo"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total = <span class="keyword">reduce</span>(add, <span class="number">0</span>, numbers);</span><br><span class="line"><span class="keyword">var</span> sentence = <span class="keyword">reduce</span>(joinWord, '', words);</span><br></pre></td></tr></table></figure></p>
<p>就像 forEach 和 map 函数，reduce 函数也是 JavaScript 数组对象的标准方法之一。<br>我们可以这么使用它：<br><figure class="highlight golo"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total = numbers.<span class="keyword">reduce</span>(add, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> sentence = words.<span class="keyword">reduce</span>(joinWord, '');</span><br></pre></td></tr></table></figure></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="external">我们可以在 MDN 上查阅更多关于 reduce 函数的组成。</a></p>
<h1 id="总结">总结</h1><p>正如我们前面所提及，他们都是很简单的例子－－add 和 joinWord 函数都非常地简单。更小，更简单的函数易于思考和测试。当我们把两个小而简单的函数结合起来的时候（就像 add 和 reduce），他的结果比起编写一个大而复杂的函数来说仍然很好解释。<br>但是，正如我前面所说，我们可以把很多方法结合起来做一些更有意思的事情。<br>让我们尝试更复杂一些，我们把一个数据对象用 map 和 reduce 函数转化成一个 HTML 列表，数据如下：<br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var ponies = [</span><br><span class="line">    [</span><br><span class="line">        [<span class="attribute">'name</span>', <span class="attribute">'Fluttershy</span>'],</span><br><span class="line">        [<span class="attribute">'image</span>', <span class="attribute">'http</span>://tinyurl.com/gpbnlf6'],</span><br><span class="line">        [<span class="attribute">'description</span>', <span class="attribute">'Fluttershy</span> <span class="keyword">is</span> a female Pegasus pony <span class="keyword">and</span> one <span class="keyword">of</span> the main characters <span class="keyword">of</span> My Little Pony Friendship <span class="keyword">is</span> Magic.']</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        [<span class="attribute">'name</span>', <span class="attribute">'Applejack</span>'],</span><br><span class="line">        [<span class="attribute">'image</span>', <span class="attribute">'http</span>://tinyurl.com/gkur8a6'],</span><br><span class="line">        [<span class="attribute">'description</span>', <span class="attribute">'Applejack</span> <span class="keyword">is</span> a female Earth pony <span class="keyword">and</span> one <span class="keyword">of</span> the main characters <span class="keyword">of</span> My Little Pony Friendship <span class="keyword">is</span> Magic.']</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        [<span class="attribute">'name</span>', <span class="attribute">'Twilight</span> Sparkle'],</span><br><span class="line">        [<span class="attribute">'image</span>', <span class="attribute">'http</span>://tinyurl.com/hj877vs'],</span><br><span class="line">        [<span class="attribute">'description</span>', <span class="attribute">'Twilight</span> Sparkle <span class="keyword">is</span> the primary main <span class="typename">character</span> <span class="keyword">of</span> My Little Pony Friendship <span class="keyword">is</span> Magic.']</span><br><span class="line">    ]</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p>
<p>这些数据不是十分整洁，如果把里面的数组变成对象会更清晰。不过，在之前我们可以 reduce 函数去估算一些简单的值就像数字或者字符串，但是没人敢说 reduce 返回的值一定简单。我们可以把它使用在 对象，数组 或者甚至是 DOM 元素 上面。让我们创造一个函数把内部的数组（像 [‘name’, ‘Fluttershy’]）以键值对的形式添加到一个对象之中。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addToObject = <span class="function"><span class="keyword">function</span><span class="params">(obj, arr)</span> </span>&#123;</span><br><span class="line">    obj[arr[<span class="number">0</span>]] = arr[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>使用 addToObject 函数，我们可以把每个数组转化成对象：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ponyArrayToObject = <span class="function"><span class="keyword">function</span><span class="params">(ponyArray)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> reduce(addToObject, &#123;&#125;, ponyArray);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>然后使用 map 函数把整个数组转化的更简洁清晰：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tidyPonies = <span class="keyword">map</span>(ponyArrayToObject, ponies);</span><br></pre></td></tr></table></figure></p>
<p>现在我们有了一个对象组成的数组，可以从<a href="http://mir.aculo.us/2011/03/09/little-helpers-a-tweet-sized-javascript-templating-engine/" target="_blank" rel="external">Thomas Fuchs’ tweet-sized templating engine</a>获得一些帮助，我们可以再使用 reduce 函数把它转换成 HTML 片段。模版函数接受一个模版字符串和一个对象，他会把字符串当中 mustache-wrapped 格式的部分（像, {name} 或者 {image})）用对象中包含的属性值类替换。比如：<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">var</span> <span class="typedef"><span class="keyword">data</span> = <span class="container">&#123; <span class="title">name</span>: "<span class="type">Fluttershy</span>" &#125;</span>;</span></span><br><span class="line"><span class="title">t</span>(<span class="string">"Hello &#123;name&#125;!"</span>, <span class="typedef"><span class="keyword">data</span>);</span></span><br><span class="line">// <span class="string">"Hello Fluttershy!"</span></span><br><span class="line"></span><br><span class="line"><span class="typedef"><span class="keyword">data</span> = <span class="container">&#123; <span class="title">who</span>: "<span class="type">Fluttershy</span>", <span class="title">time</span>: <span class="type">Date</span>.<span class="title">now</span>() &#125;</span>;</span></span><br><span class="line"><span class="title">t</span>(<span class="string">"Hello &#123;name&#125;! It's &#123;time&#125; ms since epoch."</span>, <span class="typedef"><span class="keyword">data</span>);</span></span><br><span class="line">// <span class="string">"Hello Fluttershy! It's 1454135887369 ms since epoch."</span></span><br></pre></td></tr></table></figure></p>
<p>所以，如果我们想要吧对象转换成列表项，我们可以这么做：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var ponyToListItem = function(pony) &#123;</span><br><span class="line">    var template = '<span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"&#123;image&#125;"</span> <span class="attribute">alt</span>=<span class="value">"&#123;name&#125;"</span>/&gt;</span>' +</span><br><span class="line">                   '<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;<span class="title">h3</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="title">h3</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>&#123;description&#125;<span class="tag">&lt;/<span class="title">p</span>&gt;</span>' +</span><br><span class="line">                   '<span class="tag">&lt;/<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>';</span><br><span class="line">    return t(template, pony);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>在上面我们把对象转换成了 html 片段，但是如果想转换整个数组，我们就需要 reduce 和 joinWord 方法：<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> ponyList = <span class="built_in">map</span>(ponyToListItem, tidyPonies);</span><br><span class="line"><span class="built_in">var</span> html = <span class="string">'&lt;ul&gt;'</span> + reduce(joinWord, <span class="string">''</span>, ponyList) + <span class="string">'&lt;/ul&gt;'</span>;</span><br></pre></td></tr></table></figure></p>
<p>我们可以在<a href="http://jsbin.com/wuzini/edit?html,js,output" target="_blank" rel="external">http://jsbin.com/wuzini/edit?html,js,output</a>看到整个运行结果。</p>
<p>当你理解 reduce 和 map 方法之后，你就不再需要老旧的 for 循环了。事实上，如果你决定在你的下一个项目上完全不使用 for 循环将会是一个很有意思的挑战。当你使用 reduce 和 map 越来越多的时候，你就会注意还有没有更多的部分可以被抽象出来。一些常见的包括<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter" target="_blank" rel="external">过滤filtering</a>，或者<a href="http://ramdajs.com/docs/#pluck" target="_blank" rel="external">plucking</a>。这些部分被使用的越来越频繁，人们把他们放到一个函数式编程的库里面，有一些流行的库包括：</p>
<ul>
<li><a href="http://ramdajs.com/0.19.1/index.html" target="_blank" rel="external">Ramda</a>,</li>
<li><a href="https://lodash.com/" target="_blank" rel="external">Lodash</a>, and</li>
<li><a href="http://underscorejs.org/" target="_blank" rel="external">Underscore</a>.</li>
</ul>
<p>－－－－－－－－－－－－－－－－－</p>
<p><br><br>未亡待续…<br>[阅读下一节～]</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="/img/js.jpeg" alt="js"></p>
<h1 id="tips">tips</h1><p>原文链接: <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to]]>
    </summary>
    
      <category term="JavaScript" scheme="http://qiutc.me/tags/JavaScript/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="教程" scheme="http://qiutc.me/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="翻译" scheme="http://qiutc.me/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="JavaScript" scheme="http://qiutc.me/categories/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[JavaScript中的函数式编程一(翻译)]]></title>
    <link href="http://qiutc.me/post/A-Gentle-Introduction-to-Functional-JavaScript-part-1.html"/>
    <id>http://qiutc.me/post/A-Gentle-Introduction-to-Functional-JavaScript-part-1.html</id>
    <published>2016-03-01T01:32:47.000Z</published>
    <updated>2016-03-12T02:26:04.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/img/js.jpeg" alt="js"></p>
<h1 id="tips">tips</h1><p>原文链接: <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-intro/" target="_blank" rel="external">http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-intro/</a>;<br>原文作者: <a href="http://jrsinclair.com/about.html" target="_blank" rel="external">James Sinclair</a>;</p>
<h1 id="JavaScript_函数式编程">JavaScript 函数式编程</h1><p>这篇文章是介绍函数式编程的四篇文章中的第一篇。在这篇文章中，我们来看一下让 JavaScript 成为适合函数式编程的组成部分，并且看看为什么它将会是很有用的。</p>
<ul>
<li>Part1 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-intro/" target="_blank" rel="external">组成部分和动机</a>,</li>
<li>Part2 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-arrays/" target="_blank" rel="external">使用数组和列表</a>,</li>
<li>Part3 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-functions/" target="_blank" rel="external">生成函数的函数</a>,</li>
<li>Part4 <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-functional-javascript-functions/" target="_blank" rel="external">使用函数式编程的风格</a>,</li>
</ul>
<h1 id="什么是函数？">什么是函数？</h1><p>为什么函数式 JavaScript 如此夸大其词呢？为什么它叫做函数式？它不是像任何人去写一个功能失调或者没有函数式的 JavaScript。它的好处是什么？你的烦恼是什么？<br>对于我来讲，学习函数式编程就像得到了一个<a href="http://youtu.be/4yr_etbfZtQ" target="_blank" rel="external">多功能食品料理机</a>一样：</p>
<ul>
<li>它的前提是需要一些学习成本</li>
<li>你可以告诉你的朋友和家人它是多么令人惊喜</li>
<li>它们将会开始怀疑你是不是加入了某个异教团<br>但是，它确实让很多任务变得简单，它甚至可以自动处理一些在某些方面相当无聊和浪费时间的东西。</li>
</ul>
<h1 id="组成">组成</h1><p>在我们去思考这为什么是个好主意之前，让我们用 JavaScript 的一些基本特性去实现函数式编程。在 JavaScript 中，有两个关键的组成部分：变量和函数，变量就像一个容器，我们可以把一些东西放在里面，就像这样：<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> myContainer</span> = <span class="string">"Hey everybody! Come see how good I look!"</span>;</span><br></pre></td></tr></table></figure></p>
<p>上面的代码创建的一个容器，并且将一个字符串放在了里面。<br>在另一方面，函数，它是一种途径可以绑定一些指令用于我们可以再使用它，它还能让事情变得有条理，因此我们不用一下子去考虑每一件事情。我们可以创建一个函数像这样：<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span></span> <span class="built_in">log</span>(someVariable) &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(someVariable);</span><br><span class="line">    <span class="keyword">return</span> someVariable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们可以这样调用它：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">log</span>(myContainer);</span><br><span class="line"><span class="comment">// Hey everybody! Come see how good I look!</span></span><br></pre></td></tr></table></figure></p>
<p>当时，如果你之前了解过一些 JavaScript ，就会知道我们还可以像下面这样编写和调用函数：<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">log</span> = <span class="function"><span class="keyword">function</span><span class="params">(someVariable)</span></span> &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(someVariable);</span><br><span class="line">    <span class="keyword">return</span> someVariable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span>(myContainer);</span><br><span class="line">// Hey everybody<span class="comment">! Come see how good I look!</span></span><br></pre></td></tr></table></figure></p>
<p>让我们仔细观察，当我们用这种方式定义一个函数的时候，相当于我们创造一个叫做 <code>log</code> 的变量，然后把一个函数赋值给它。事实也确实如此。我们的 <code>log()</code> 函数是一个变量，这意味着我们可以对他做和其他变量一样的事情。<br>让我们试一试，或许我们可以把一个函数作为一个参数传给另一个函数：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> classyMessage = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Stay classy San Diego!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log(classyMessage);</span><br><span class="line"><span class="comment">// [Function]</span></span><br></pre></td></tr></table></figure></p>
<p>hahahaha，好像没什么有用的惊喜啊，让我们尝试用不同的方式：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> doSomething = <span class="function"><span class="keyword">function</span><span class="params">(thing)</span> </span>&#123;</span><br><span class="line">    thing();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sayBigDeal = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> message = <span class="string">"I’m kind of a big deal"</span>;</span><br><span class="line">    log(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doSomething(sayBigDeal);</span><br><span class="line"><span class="comment">// I’m kind of a big deal</span></span><br></pre></td></tr></table></figure></p>
<p>这应该不会让你感到非常激动，当时它让那些计算机科学家非常地激动。它能够把函数放在一个变量中，有时候可以这么说“函数是 JavaScript 中的第一类对象”。这意味着处理对待函数和其他的数据类型就像对象或者字符串没什么两样。并且这一个小的特性将会惊人地有用，为了搞明白为什么，我们得谈一谈 DRY 原则。</p>
<h1 id="不要重复">不要重复</h1><p>程序猿喜欢说 DRY 原则 ———— 不要重复你自己，它的意思是说，如果你需要去多次执行同样的任务，把它们绑定在一类可以重复使用的包里面（就像函数），这样的话，如果你想要调整任务设置的话，你只需在一个地方改动就行了——函数。<br>让我们看看这个例子，我们使用一个轮播库在页面上放三个轮播组件：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el1 = <span class="built_in">document</span>.getElementById(<span class="string">'main-carousel'</span>);</span><br><span class="line"><span class="keyword">var</span> slider1 = <span class="keyword">new</span> Carousel(el1, <span class="number">3000</span>);</span><br><span class="line">slider1.init();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> el2 = <span class="built_in">document</span>.getElementById(<span class="string">'news-carousel'</span>);</span><br><span class="line"><span class="keyword">var</span> slider2 = <span class="keyword">new</span> Carousel(el2, <span class="number">5000</span>);</span><br><span class="line">slider2.init();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> el3 = <span class="built_in">document</span>.getElementById(<span class="string">'events-carousel'</span>);</span><br><span class="line"><span class="keyword">var</span> slider3 = <span class="keyword">new</span> Carousel(el3, <span class="number">7000</span>);</span><br><span class="line">slider3.init();</span><br></pre></td></tr></table></figure></p>
<p>上面的代码有些重复，我们想要给页面上的元素初始化一个轮播组件，并且每个都带有一个特定的 ID ，让我们看看如何在函数中去初始化一个轮播组件，然后给每个 ID 调用这个函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initialiseCarousel</span>(<span class="params">id, frequency</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    <span class="keyword">var</span> slider = <span class="keyword">new</span> Carousel(el, frequency);</span><br><span class="line">    slider.init();</span><br><span class="line">    <span class="keyword">return</span> slider;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">initialiseCarousel(<span class="string">'main-carousel'</span>, <span class="number">3000</span>);</span><br><span class="line">initialiseCarousel(<span class="string">'news-carousel'</span>, <span class="number">5000</span>);</span><br><span class="line">initialiseCarousel(<span class="string">'events-carousel'</span>, <span class="number">7000</span>);</span><br></pre></td></tr></table></figure></p>
<p>这样，代码就非常简洁了并且很好去维护。我们可以遵循下面一个准则：当我们需要对不同的数据做一系列相同的操作的时候，我们可以把这些操作包装在一个函数中。当是如果这些操作也存在一些不同呢？<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unicornEl = <span class="built_in">document</span>.getElementById(<span class="string">'unicorn'</span>);</span><br><span class="line">unicornEl.className += <span class="string">' magic'</span>;</span><br><span class="line">spin(unicornEl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fairyEl = <span class="built_in">document</span>.getElementById(<span class="string">'fairy'</span>);</span><br><span class="line">fairyEl.className += <span class="string">' magic'</span>;</span><br><span class="line">sparkle(fairyEl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> kittenEl = <span class="built_in">document</span>.getElementById(<span class="string">'kitten'</span>);</span><br><span class="line">kittenEl.className += <span class="string">' magic'</span>;</span><br><span class="line">rainbowTrail(kittenEl);</span><br></pre></td></tr></table></figure></p>
<p>去重构这些代码有些复杂，它确实是一个重复的模式，但是我们给每个元素调用了不同的函数，我们可以第一步先包装 <code>document.getElementById()</code> 的调用和添加 <code>className</code> 的操作到一个函数，这样可以降低一些重复度：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMagicClass</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    element.className += <span class="string">' magic'</span>;</span><br><span class="line">    <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> unicornEl = addMagicClass(<span class="string">'unicorn'</span>);</span><br><span class="line">spin(unicornEl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fairyEl = addMagicClass(<span class="string">'fairy'</span>);</span><br><span class="line">sparkle(fairyEl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> kittenEl = addMagicClass(<span class="string">'kitten'</span>);</span><br><span class="line">rainbow(kittenEl);</span><br></pre></td></tr></table></figure></p>
<p>但是我们怎样让他变得更 DRY 一些呢？如果你记得 JavaScript 可以允许我们把一个函数作为一个参数传给另一个函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMagic</span>(<span class="params">id, effect</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    element.className += <span class="string">' magic'</span>;</span><br><span class="line">    effect(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addMagic(<span class="string">'unicorn'</span>, spin);</span><br><span class="line">addMagic(<span class="string">'fairy'</span>, sparkle);</span><br><span class="line">addMagic(<span class="string">'kitten'</span>, rainbow);</span><br></pre></td></tr></table></figure></p>
<p>这变得更简洁了，并且更易于维护，这种把函数座位参数传递的能力是我们看到了更多的可能性，在下一节我们将会看到如何使用这种能力是数组变得更友好。<br>未亡待续…<br><a href="http://qiutc.me/post/JavaScript%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%BA%8C-%E7%BF%BB%E8%AF%91.html">阅读下一节～</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="/img/js.jpeg" alt="js"></p>
<h1 id="tips">tips</h1><p>原文链接: <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to]]>
    </summary>
    
      <category term="JavaScript" scheme="http://qiutc.me/tags/JavaScript/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="教程" scheme="http://qiutc.me/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="翻译" scheme="http://qiutc.me/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="JavaScript" scheme="http://qiutc.me/categories/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用 React 实现一个轮播组件]]></title>
    <link href="http://qiutc.me/post/%E4%BD%BF%E7%94%A8-React-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BD%AE%E6%92%AD%E7%BB%84%E4%BB%B6.html"/>
    <id>http://qiutc.me/post/使用-React-实现一个轮播组件.html</id>
    <published>2016-02-19T06:03:49.000Z</published>
    <updated>2016-02-19T07:39:13.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/img/react.png" alt="React"></p>
<h1 id="tip">tip</h1><p>React 刚出来不久，组件还比较少，不像 jquery 那样已经有很多现成的插件了，当是就自己写了一个基于 React 的轮播组件，当然只是一个小 demo，刚刚有用 es6 的语法重新改了改，就想着写一个小教程给新手，如何实现一个 React 的小组件。<br>先放上仓库地址，可以先 clone 来看看代码：<a href="https://github.com/TongchengQiu/react-slider" target="_blank" rel="external">https://github.com/TongchengQiu/react-slider</a>。<br>react-slider 是一个图片轮播的组件，支持的配置有 图片（必须好不好，要不然轮播毛）、轮播图片的速度、是否自动轮播、自动轮播的时候鼠标放上去是否暂停、自动轮播速度、是否需要前后箭头、是否需要 dot （我不知道怎么表述好，反正意思你懂）。</p>
<h1 id="第一步，需求">第一步，需求</h1><p>首先，写一个组件必须先考虑改组件的需求有哪些，支持的配置需要哪些。<br>如上已经说了改组件的需求：</p>
<ul>
<li>轮播的图片</li>
<li>配置轮播图片切换的速度</li>
<li>可配置是否自动轮播</li>
<li>可配置自动轮播的时候鼠标放上去是否暂停</li>
<li>可配置自动轮播的速度</li>
<li>可配置是否需要前后箭头</li>
<li>可配置是否需要 dot （我不知道怎么表述好，反正意思你懂）<br>这一步先到此为止～～～</li>
</ul>
<h1 id="第二步，构建项目">第二步，构建项目</h1><p>这里我们是使用 React 框架，当然也是用它的好搭档 webpack 来构建自动化流程咯～😏<br>不懂 webpack 的配置可以看我的博客关于 webpack 使用的文章，谢谢～😄<br>这是项目开发目录的文件结构：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├── Slider              <span class="comment">#Slider组件</span></span><br><span class="line">|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   ├──SliderItem          </span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   ├──SliderItem.jsx</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   └──SliderItem.scss</span><br><span class="line"></span>|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   ├──SliderDots        </span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   ├──SliderItem.jsx</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   └──SliderItem.scss</span><br><span class="line"></span>|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   ├──SliderArrows         </span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   ├──SliderItem.jsx</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   └──SliderItem.scss</span><br><span class="line"></span>|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   ├──Slider.jsx         </span><br><span class="line"></span>|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   └──Slider.scss</span><br><span class="line"></span>|</span><br><span class="line">├──images              <span class="comment">#存放demo用的图片文件</span></span><br><span class="line">|<span class="string"></span><br><span class="line">└── index.js           #demo的入口文件</span></span><br></pre></td></tr></table></figure></p>
<p>看目录结构我们应该明白了，我们主要关注 Slider 文件夹。</p>
<h1 id="第三步，基于需求的开发">第三步，基于需求的开发</h1><p>这里我们开发组件的模式是按照需求驱动型，回到第一步的需求，我们先不管组件内代码，先写出我们想怎么样配置使用组件：<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// index.js</span><br><span class="line"><span class="keyword">import</span> React from <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; from <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Slider from <span class="string">'./Slider/Slider'</span>;</span><br><span class="line"></span><br><span class="line">const IMAGE_DATA = [</span><br><span class="line">  &#123;</span><br><span class="line">    src: require(<span class="string">'./images/demo1.jpg'</span>),</span><br><span class="line">    alt: <span class="string">'images-1'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    src: require(<span class="string">'./images/demo2.jpg'</span>),</span><br><span class="line">    alt: <span class="string">'images-2'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    src: require(<span class="string">'./images/demo3.jpg'</span>),</span><br><span class="line">    alt: <span class="string">'images-3'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;Slider</span><br><span class="line">    items=&#123;IMAGE_DATA&#125;</span><br><span class="line">    speed=&#123;<span class="number">1.2</span>&#125;</span><br><span class="line">    delay=&#123;<span class="number">2.1</span>&#125;</span><br><span class="line">    pause=&#123;true&#125;</span><br><span class="line">    autoplay=&#123;true&#125;</span><br><span class="line">    dots=&#123;true&#125;</span><br><span class="line">    arrows=&#123;true&#125;</span><br><span class="line">  /&gt;,</span><br><span class="line">  document.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>可以看到，在使用 Slider 组件的时候，根据需求，我们可以传入这些属性来配置组件。<br>一个 <code>items</code> 数组，决定了需要轮播的内容，items 里面每个元素都是一个对象，有 src 和 alt 属性，分别是轮播图片的 src 地址和 alt 内容；<br><code>speed</code> 是图片切换的时候的速度时间，需要配置一个 number 类型的数据，决定时间是几秒；<br><code>autoplay</code> 是配置是否需要自动轮播，是一个布尔值；<br><code>delay</code> 是在需要自动轮播的时候，每张图片停留的时间，一个 number 值；<br><code>pause</code> 是在需要自动轮播的时候，鼠标停留在图片上，是否暂停轮播，是一个布尔值；<br><code>dots</code> 是配置是否需要轮播下面的小点；<br><code>arrows</code> 是配置是否需要轮播的前后箭头；</p>
<h1 id="第四步，编写组件">第四步，编写组件</h1><p>首先我们来考虑一下需要多少个组件，最外层的 Slider 组件是毋庸置疑的了。<br>根据需求我们可以分出一个 SliderItem 组件，一个 SliderDots，一个 SliderArrows 组件，分别是 轮播每个图片的item，轮播下面dots的组件，左右箭头组件。<br>我们先来编写每个小组件，组件是对外封闭独立的，所以它只需要对外暴漏属性的配置即可。</p>
<h2 id="SliderItem">SliderItem</h2><p>因为 SliderItem 是展示轮播图片的每个内容的，所以它需要的属性有，src 和 alt，因为之前我们已经把每个轮播项写成一个对象了，所以把 src 和 alt 作为属性放在 item，我们只需要一个 item 属性即可；它还需要决定它在父组件中大小，因为在未使用组件的时候我们是不知道轮播项的数目的，所以它的宽度需要根据父组件传给它count（图片数目）来计算。<br>所以它需要的属性有：</p>
<ul>
<li>item (有 src 和 alt 属性)</li>
<li>count （轮播项总数目，计算每个轮播项的宽度）</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SliderItem</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    let &#123; count, item &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    let width = <span class="number">100</span> / count + '%';</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;li className=<span class="string">"slider-item"</span> style=&#123;&#123;width: width&#125;&#125;&gt;</span><br><span class="line">        &lt;img src=&#123;item.src&#125; alt=&#123;item.alt&#125; /&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>let width = 100 / count + &#39;%&#39;;</code> 即是计算它占父组件的宽度百分比。</p>
<h2 id="SliderDots">SliderDots</h2><p>对于 SliderDots 组件，我们需要一个 count（轮播项总数目）来决定显示几个 dot，还需要一个 nowLocal 属性来判断哪个 dot 对应当前显示的轮播项，点击每个 dot 的是否需要一个回调函数 turn 来做出响应。<br>所以它需要的属性有：</p>
<ul>
<li>count（轮播项总数目）</li>
<li>nowLocal（当前的轮播项）</li>
<li>turn（点击 dot 回调函数）</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SliderDots</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleDotClick(i) &#123;</span><br><span class="line">    <span class="keyword">var</span> option = i - <span class="keyword">this</span>.props.nowLocal;</span><br><span class="line">    <span class="keyword">this</span>.props.turn(option);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    let dotNodes = [];</span><br><span class="line">    let &#123; count, nowLocal &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">for</span>(let i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">      dotNodes[i] = (</span><br><span class="line">        &lt;span</span><br><span class="line">          key=&#123;<span class="symbol">'do</span>t' + i&#125;</span><br><span class="line">          className=&#123;<span class="string">"slider-dot"</span> + (i === <span class="keyword">this</span>.props.nowLocal?<span class="string">" slider-dot-selected"</span>:<span class="string">""</span>)&#125;</span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.handleDotClick.bind(<span class="keyword">this</span>, i)&#125;&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"slider-dots-wrap"</span>&gt;</span><br><span class="line">        &#123;dotNodes&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码可以看出，我们用 for 循环根据 count 来决定了需要多少个 dot，然后在每个 dot 绑定函数传入一个 i 值，并且如果这个 dot 对于当前显示的轮播项，就多加一个class slider-dot-selected。<br>每个 dot click 绑定的函数还需要计算需要向前或者向后移动多少个轮播项，然后回调 turn 函数。</p>
<h2 id="SliderArrows">SliderArrows</h2><p>对于 SliderArrows 组件，我们只需要一个 turn 函数作出回调。<br>废话不多少，代码如下：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SliderArrows</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleArrowClick(option) &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.turn(option);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"slider-arrows-wrap"</span>&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          className=<span class="string">"slider-arrow slider-arrow-left"</span></span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.handleArrowClick.bind(<span class="keyword">this</span>, -<span class="number">1</span>)&#125;&gt;</span><br><span class="line">          &amp;lt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          className=<span class="string">"slider-arrow slider-arrow-right"</span></span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.handleArrowClick.bind(<span class="keyword">this</span>, <span class="number">1</span>)&#125;&gt;</span><br><span class="line">          &amp;gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个组件下面有两个箭头，分别是向前和向后，回调的 turn 是 1 和 －1。</p>
<h2 id="Slider_组件">Slider 组件</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">require('./<span class="type">Slider</span>.scss');</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">SliderItem</span> from './<span class="type">SliderItem</span>/<span class="type">SliderItem</span>';</span><br><span class="line"><span class="keyword">import</span> <span class="type">SliderDots</span> from './<span class="type">SliderDots</span>/<span class="type">SliderDots</span>';</span><br><span class="line"><span class="keyword">import</span> <span class="type">SliderArrows</span> from './<span class="type">SliderArrows</span>/<span class="type">SliderArrows</span>';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Slider</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      nowLocal: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向前向后多少</span></span><br><span class="line">  turn(n) &#123;</span><br><span class="line">    <span class="keyword">var</span> _n = <span class="keyword">this</span>.state.nowLocal + n;</span><br><span class="line">    <span class="keyword">if</span>(_n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      _n = _n + <span class="keyword">this</span>.props.items.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(_n &gt;= <span class="keyword">this</span>.props.items.length) &#123;</span><br><span class="line">      _n = _n - <span class="keyword">this</span>.props.items.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;nowLocal: _n&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始自动轮播</span></span><br><span class="line">  goPlay() &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.props.autoplay) &#123;</span><br><span class="line">      <span class="keyword">this</span>.autoPlayFlag = setInterval(() =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.turn(<span class="number">1</span>);</span><br><span class="line">      &#125;, <span class="keyword">this</span>.props.delay * <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 暂停自动轮播</span></span><br><span class="line">  pausePlay() &#123;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>.autoPlayFlag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.goPlay();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    let count = <span class="keyword">this</span>.props.items.length;</span><br><span class="line"></span><br><span class="line">    let itemNodes = <span class="keyword">this</span>.props.items.map((item, idx) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> &lt;<span class="type">SliderItem</span> item=&#123;item&#125; count=&#123;count&#125; key=&#123;<span class="symbol">'ite</span>m' + idx&#125; /&gt;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    let arrowsNode = &lt;<span class="type">SliderArrows</span> turn=&#123;<span class="keyword">this</span>.turn.bind(<span class="keyword">this</span>)&#125;/&gt;;</span><br><span class="line"></span><br><span class="line">    let dotsNode = &lt;<span class="type">SliderDots</span> turn=&#123;<span class="keyword">this</span>.turn.bind(<span class="keyword">this</span>)&#125; count=&#123;count&#125; nowLocal=&#123;<span class="keyword">this</span>.state.nowLocal&#125; /&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div</span><br><span class="line">        className=<span class="string">"slider"</span></span><br><span class="line">        onMouseOver=&#123;<span class="keyword">this</span>.props.pause?<span class="keyword">this</span>.pausePlay.bind(<span class="keyword">this</span>):<span class="literal">null</span>&#125; onMouseOut=&#123;<span class="keyword">this</span>.props.pause?<span class="keyword">this</span>.goPlay.bind(<span class="keyword">this</span>):<span class="literal">null</span>&#125;&gt;</span><br><span class="line">          &lt;ul style=&#123;&#123;</span><br><span class="line">              left: -<span class="number">100</span> * <span class="keyword">this</span>.state.nowLocal + <span class="string">"%"</span>,</span><br><span class="line">              transitionDuration: <span class="keyword">this</span>.props.speed + <span class="string">"s"</span>,</span><br><span class="line">              width: <span class="keyword">this</span>.props.items.length * <span class="number">100</span> + <span class="string">"%"</span></span><br><span class="line">            &#125;&#125;&gt;</span><br><span class="line">              &#123;itemNodes&#125;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.props.arrows?arrowsNode:<span class="literal">null</span>&#125;</span><br><span class="line">          &#123;<span class="keyword">this</span>.props.dots?dotsNode:<span class="literal">null</span>&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Slider</span>.defaultProps = &#123;</span><br><span class="line">  speed: <span class="number">1</span>,</span><br><span class="line">  delay: <span class="number">2</span>,</span><br><span class="line">  pause: <span class="literal">true</span>,</span><br><span class="line">  autoplay: <span class="literal">true</span>,</span><br><span class="line">  dots: <span class="literal">true</span>,</span><br><span class="line">  arrows: <span class="literal">true</span>,</span><br><span class="line">  items: [],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">Slider</span>.autoPlayFlag = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>在这里我们先是 import 依赖，以及 需要的 子组件。</li>
<li>Slider 有一个状态 nowLocal，是表明当前轮播的第几项。</li>
<li>前面一直讲 turn 函数，我们就先分析一下这个函数：<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">turn(n) &#123;</span><br><span class="line">  console.<span class="built_in">log</span>();</span><br><span class="line">  var _n = <span class="keyword">this</span>.state.nowLocal + n;</span><br><span class="line">  <span class="keyword">if</span>(_n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    _n = _n + <span class="keyword">this</span>.props.items.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(_n &gt;= <span class="keyword">this</span>.props.items.length) &#123;</span><br><span class="line">    _n = _n - <span class="keyword">this</span>.props.items.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;nowLocal: _n&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>它传入一个 参数 n ，决定向前或者向后移动多少个轮播项，向前和向后分别对于 － 和 ＋。<br>turn 函数内，声明一个 <code>_n</code> 变量表示下一个轮播的第几项。<br>如果 <code>_n</code> 小于 0 ，那当然是不行的，所以就会让 <code>_n</code> 变成最后一项；<br>如果 <code>_n</code> 大于 items 的长度 ，那当然也是不行的，所以就会让 <code>_n</code> 变成第一项；<br>最后改变状态 <code>nowLocal</code> 等于 <code>_n</code>。</p>
<ul>
<li>下面是一个开始自动轮播的函数 goPlay：<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">goPlay() &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.props.autoplay) &#123;</span><br><span class="line">    <span class="keyword">this</span>.autoPlayFlag = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.turn(<span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="keyword">this</span>.props.delay * <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>如果 autoplay 是 true，则执行 setInterval 来自动调用 this.turn(1) 向前移动轮播项，<code>this.props.delay * 1000</code>就是根据配置的 delay 来决定多久移动一次。<br>这里我们需要一个 autoPlayFlag 参数来保存 setInterval 的回调，用来在鼠标停放在图片上停止自动轮播，我们把这个 autoPlayFlag 作为组件的一个属性来保存。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Slider.autoPlayFlag = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后在组件初始化 componentDidMount 的时候调用这个函数：<br><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">componentDidMount() &#123;</span><br><span class="line">  this<span class="string">.goPlay()</span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>我们还需要一个 pausePlay 函数来暂停自动轮播。</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">pausePlay() &#123;</span><br><span class="line">  clearInterval(this<span class="string">.autoPlayFlag)</span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>最后就是 render 了，根据属性配置哪些函数和组件需要～</p>
</li>
<li>默认属性，这个是需要的，在使用属性的时候如果忘了一些配置项也不会出错。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Slider.defaultProps = &#123;</span><br><span class="line">  speed: <span class="number">1</span>,</span><br><span class="line">  delay: <span class="number">2</span>,</span><br><span class="line">  pause: <span class="literal">true</span>,</span><br><span class="line">  autoplay: <span class="literal">true</span>,</span><br><span class="line">  dots: <span class="literal">true</span>,</span><br><span class="line">  arrows: <span class="literal">true</span>,</span><br><span class="line">  items: [],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="样式">样式</h2><p>什么，你告诉我显示在页面上的都是什么鬼？<br>来写 scss 吧：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class">.slider</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">&amp;</span>&gt;<span class="tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: auto;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transition</span>: left <span class="number">1s</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class">.slider-item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">height</span>: auto;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">&amp;</span>&gt;<span class="tag">img</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: block;</span><br><span class="line">      <span class="attribute">height</span>: auto;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class">.slider-arrow</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">color</span>: <span class="hexcolor">#fff</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">&amp;</span><span class="pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="function">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">&amp;</span><span class="class">.slider-arrow-right</span> &#123;</span><br><span class="line">      <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">&amp;</span><span class="class">.slider-arrow-left</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class">.slider-dots-wrap</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">99</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class">.slider-dot</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: inline-block;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">6px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">6px</span>;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="hexcolor">#ccc</span>;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">6px</span>;</span><br><span class="line">      <span class="attribute">cursor</span>: pointer;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">20px</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">&amp;</span><span class="pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="hexcolor">#868686</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">&amp;</span><span class="class">.slider-dot-selected</span> &#123;</span><br><span class="line">        <span class="attribute">background</span>: <span class="hexcolor">#ccc</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里不多说了，样式就这样～<br>有疑问可以 call me。</p>
<h1 id="谢谢谢谢，谢谢各位客官光看_～_😄_😄_啊哈_😁">谢谢谢谢，谢谢各位客官光看 ～  😄 😄 啊哈 😁</h1><p> 😄 😄 😁 🐶 🐩</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="/img/react.png" alt="React"></p>
<h1 id="tip">tip</h1><p>React 刚出来不久，组件还比较少，不像 jquery 那样已经有很多现成的插件了，当是就自己写了一个基于 React 的轮播组件，当然只]]>
    </summary>
    
      <category term="FE" scheme="http://qiutc.me/tags/FE/"/>
    
      <category term="React" scheme="http://qiutc.me/tags/React/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="教程" scheme="http://qiutc.me/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="React" scheme="http://qiutc.me/categories/React/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[webpack 2 的新特性 - What's new in webpack 2]]></title>
    <link href="http://qiutc.me/post/webpack-2-%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7-What-s-new-in-webpack-2.html"/>
    <id>http://qiutc.me/post/webpack-2-的新特性-What-s-new-in-webpack-2.html</id>
    <published>2016-02-02T09:31:32.000Z</published>
    <updated>2016-02-04T12:46:23.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/img/webpack.png" alt="webpack"></p>
<p>原文 <a href="https://gist.github.com/sokra/27b24881210b56bbaff7" target="_blank" rel="external">What’s new in webpack 2</a></p>
<h1 id="webpack_2_中的新特性">webpack 2 中的新特性</h1><p>创造永无止境，现在 webpack 2 的版本已经更新到了 2.0.5-beta+ 。</p>
<h1 id="主要的变化">主要的变化</h1><h2 id="ES6_Modules">ES6 Modules</h2><p>webpack 2 已经支持原生的 ES6 的模块加载器了，这意味着 webpack 2 能够理解和处理 <code>import</code>和<code>export</code>了，而不用把他们转化成 CommonJS 来处理了。<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; currentPage, readPage &#125; from "./book"<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">currentPage === 0<span class="comment">;</span></span><br><span class="line">readPage()<span class="comment">;</span></span><br><span class="line">currentPage === 1<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// book.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> currentPage = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">readPage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    currentPage++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">"This is a book"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="用_ES6_来做代码拆分">用 ES6 来做代码拆分</h3><p>ES6 的模块加载器定义了<code>System.import</code>这一个方法，<code>System.import</code>能够在运行时动态加载 ES6 模块。<br>webpack 把<code>System.import</code>线程作为一个交叉指针然后把被要求的模块放到一个分离的代码块里面。（这里真心看不懂，乱来了😂，反正意思就是那样）<br><code>System.import</code>函数把模块名作为参数，然后返回一个异步回调函数。<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick</span><span class="params">()</span> &#123;</span></span><br><span class="line">    System.<span class="built_in">import</span>(<span class="string">"./module"</span>).then(<span class="function"><span class="keyword">module</span> =</span>&gt; &#123;</span><br><span class="line">        <span class="function"><span class="keyword">module</span>.<span class="title">default</span>;</span><br><span class="line">    &#125;).<span class="title">catch</span><span class="params">(err =&gt; &#123;</span><br><span class="line">        console.log<span class="params">(<span class="string">"Chunk loading failed"</span>)</span>;</span><br><span class="line">    &#125;)</span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>好消息：模块加载失败可以被捕捉到错误了。</p>
<h3 id="动态表达（异步请求js）">动态表达（异步请求js）</h3><p>可以可以把部分代码传递给 <code>System.import</code> ，它的操作其实和 CommonJS 是类似的，给所有可能的文件创建一个环境。意思就是说当你传递那部分代码的模块还不确定的时候，webpack 会自动生成所有可能的模块，然后根据需求加载。<br>这个特性在前端路由的时候很有用，可以实现按需加载资源。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">route</span><span class="params">(path, query)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> System.<span class="keyword">import</span>(<span class="string">"./routes/"</span> + path + <span class="string">"/route"</span>)</span><br><span class="line">        .then(route =&gt; <span class="keyword">new</span> route.Route(query));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// This creates a separate chunk for each possible route</span></span><br></pre></td></tr></table></figure></p>
<h3 id="混合使用_ES6_和_AMD_和_CommonJS_(Mixing_ES6_with_AMD_and_CommonJS)">混合使用 ES6 和 AMD 和 CommonJS (Mixing ES6 with AMD and CommonJS)</h3><p>在 AMD 和 CommonJS 模块加载器中，你可以混合使用所有（三种）的模块类型（即使是在同一个文件里面）。在下面的情况中 webpack 的处理时类似的。<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// CommonJS consuming ES6 Module</span><br><span class="line"><span class="label">var</span> <span class="keyword">book </span>= <span class="preprocessor">require</span>(<span class="string">"./book"</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">book.currentPage;</span><br><span class="line"></span><span class="keyword">book.readPage();</span><br><span class="line"></span><span class="keyword">book.default </span>=== <span class="string">"This is a book"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6 Module consuming CommonJS</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">"fs"</span>; <span class="comment">// module.exports map to default</span></span><br><span class="line"><span class="keyword">import</span> &#123; readFileSync &#125; <span class="keyword">from</span> <span class="string">"fs"</span>; <span class="comment">// named exports are read from returned object+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> fs.readFileSync === <span class="string">"function"</span>;</span><br><span class="line"><span class="keyword">typeof</span> readFileSync === <span class="string">"function"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="babel_和_webpack">babel 和 webpack</h3><p><code>es2015</code> balel 的默认预处理会把 ES6 模块加载器转化成 CommonJS 模块加载。要是想使用 webpack 新增的对原生 ES6 模块加载器的支持，你需要使用 <code>es2015-webpack</code> 来代替。</p>
<h3 id="对_ES6_优化细述">对 ES6 优化细述</h3><p>ES6 底层支持一些新的优化。比如在很多情况下它可以查明哪些 exports 是使用过的，哪些是未使用过的。<br>很多情况下，当 webpack 可以肯定地认为一个 export 它没有使用过，他会忽略暴漏 export 给其他模块的的声明，这样可以极小成本地标志一个 export 未使用过并且忽略它。<br><br><br>在以下的情况中很可能查明使用状况：</p>
<ul>
<li>named import</li>
<li>default import</li>
<li>reexport</li>
</ul>
<p>在以下的情况中不大可能查明使用状况：</p>
<ul>
<li>import * as …</li>
<li>CommonJS or AMD consuming ES6 module</li>
<li>System.import</li>
</ul>
<h2 id="结构配置">结构配置</h2><p>在过去，由于环境的不同需要去处理不同环境下的结构配置，webpack 2 带来了一种新的方式去配置。<br>配置文件可以暴漏一个返回结构配置的函数，这个函数被 CLI 调用，然后值通过 <code>--env</code> 传递给结构配置的函数。<br>你可以传递一个字符串（–env dev =&gt; “dev”）或者一个复杂的配置对象 (–env.minimize –env.server localhost =&gt; {minimize: true, server: “localhost”}) 给这个函数。我推荐大家使用对象，因为它更具有可扩展性，当是这取决于你。<br>例子：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.babel.js</span></span><br><span class="line">exports <span class="keyword">default</span> <span class="function"><span class="keyword">function</span><span class="params">(options)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        devtool: options.dev ? <span class="string">"cheap-module-eval-source-map"</span> : <span class="string">"hidden-source-map"</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="配置项">配置项</h2><p>这里是一些主要的重构<a href="https://github.com/webpack/enhanced-resolve" target="_blank" rel="external">https://github.com/webpack/enhanced-resolve</a>。它意味着配置项也改变了。<br>大多数是简化了配置，或者是让配置更不容易出错。<br>新的配置：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    modules: [path.<span class="built_in">resolve</span>(__dirname, <span class="string">"app"</span>), <span class="string">"node_modules"</span>]</span><br><span class="line">   <span class="comment"> // (was split into `root`, `modulesDirectories` and `fallback` in the old options)</span></span><br><span class="line">   <span class="comment"> // In which folders the resolver look for modules</span></span><br><span class="line">   <span class="comment"> // relative paths are looked up in every parent folder (like node_modules)</span></span><br><span class="line">   <span class="comment"> // absolute paths are looked up directly</span></span><br><span class="line">   <span class="comment"> // the order is respected</span></span><br><span class="line"></span><br><span class="line">    descriptionFiles: [<span class="string">"package.json"</span>, <span class="string">"bower.json"</span>],</span><br><span class="line">   <span class="comment"> // These JSON files are read in directories</span></span><br><span class="line"></span><br><span class="line">    mainFields: [<span class="string">"main"</span>, <span class="string">"browser"</span>],</span><br><span class="line">   <span class="comment"> // These fields in the description files are looked up when trying to resolve the package directory</span></span><br><span class="line"></span><br><span class="line">    mainFiles: [<span class="string">"index"</span>]</span><br><span class="line">   <span class="comment"> // These files are tried when trying to resolve a directory</span></span><br><span class="line"></span><br><span class="line">    aliasFields: [<span class="string">"browser"</span>],</span><br><span class="line">   <span class="comment"> // These fields in the description files offer aliasing in this package</span></span><br><span class="line">   <span class="comment"> // The content of these fields is an object where requests to a key are mapped to the corresponding value</span></span><br><span class="line"></span><br><span class="line">    extensions: [<span class="string">".js"</span>, <span class="string">".json"</span>],</span><br><span class="line">   <span class="comment"> // These extensions are tried when resolving a file</span></span><br><span class="line"></span><br><span class="line">    enforceExtension: <span class="constant">false</span>,</span><br><span class="line">   <span class="comment"> // If false it will also try to use no extension from above</span></span><br><span class="line"></span><br><span class="line">    moduleExtensions: [<span class="string">"-loader"</span>],</span><br><span class="line">   <span class="comment"> // These extensions are tried when resolving a module</span></span><br><span class="line"></span><br><span class="line">    enforceModuleExtension: <span class="constant">false</span>,</span><br><span class="line">   <span class="comment"> // If false it's also try to use no module extension from above</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">alias</span>: &#123;</span><br><span class="line">        jquery: path.<span class="built_in">resolve</span>(__dirname, <span class="string">"vendor/jquery-2.0.0.js"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment"> // These aliasing is used when trying to resolve a module</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="一些大变化">一些大变化</h1><h2 id="Promise_polyfill">Promise polyfill</h2><h2 id="Loaders_的配置">Loaders 的配置</h2><p>在 loaders 的配置中使用了 <code>resourcePath</code> 来替代原来的 <code>resource</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">loaders:</span> [</span><br><span class="line">    &#123;</span><br><span class="line"><span class="label">        test:</span> <span class="regexp">/\.css$/</span>,</span><br><span class="line"><span class="label">        loaders:</span> [</span><br><span class="line">            <span class="string">"style-loader"</span>,</span><br><span class="line">            &#123; <span class="string">loader:</span> <span class="string">"css-loader"</span>, <span class="string">query:</span> &#123; <span class="string">modules:</span> <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">            &#123;</span><br><span class="line"><span class="label">                loader:</span> <span class="string">"sass-loader"</span>,</span><br><span class="line"><span class="label">                query:</span> &#123;</span><br><span class="line"><span class="label">                    includePaths:</span> [</span><br><span class="line">                        path.resolve(__dirname, <span class="string">"some-folder"</span>)</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h2 id="Minimize">Minimize</h2><p>在 UglifyJsPlugin 中不再支持让 Loaders 最小化文件的模式了，<code>debug</code> 配置也被移除了，Loaders 不能从 webpack 的配置中读取到他们的配置项了，取代的方案是：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.LoaderOptionsPlugin(&#123;</span><br><span class="line">    test: <span class="regexp">/\.css$/</span>, <span class="comment">// optionally pass test, include and exclude, default affects all loaders</span></span><br><span class="line">    minimize: <span class="keyword">true</span>,</span><br><span class="line">    debug: <span class="keyword">false</span>,</span><br><span class="line">    <span class="keyword">options</span>: &#123;</span><br><span class="line">        <span class="comment">// pass stuff to the loader</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="/img/webpack.png" alt="webpack"></p>
<p>原文 <a href="https://gist.github.com/sokra/27b24881210b56bbaff7" target="_blank" rel="ex]]>
    </summary>
    
      <category term="FE" scheme="http://qiutc.me/tags/FE/"/>
    
      <category term="webpack" scheme="http://qiutc.me/tags/webpack/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="构建工具" scheme="http://qiutc.me/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
    
      <category term="webpack" scheme="http://qiutc.me/categories/webpack/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[redux 大法好 —— 入门实例 TodoList]]></title>
    <link href="http://qiutc.me/post/redux-%E5%A4%A7%E6%B3%95%E5%A5%BD-%E2%80%94%E2%80%94-%E5%85%A5%E9%97%A8%E5%AE%9E%E4%BE%8B-TodoList.html"/>
    <id>http://qiutc.me/post/redux-大法好-——-入门实例-TodoList.html</id>
    <published>2015-12-21T06:24:43.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/img/redux.jpeg" alt="redux"></p>
<h1 id="Tip">Tip</h1><p>前端技术真是日新月异，搞完 React 不搭配个数据流都不好意思了。<br>满怀期待的心去翻了翻 flux，简直被官方那意识流的文档折服了，真是又臭又长还是我智商问题？😖<br>转战 redux ，越看越有意思，跟着文档做了个 TodoList 的入门小例子。</p>
<p>废话不多说，先贴上文章用到例子的源码 <a href="https://github.com/TongchengQiu/TodoList-as-redux-demo" target="_blank" rel="external">https://github.com/TongchengQiu/TodoList-as-redux-demo</a><br>redux 的 Github 仓库 <a href="https://github.com/rackt/redux" target="_blank" rel="external">https://github.com/rackt/redux</a><br>还有个中文的 gitbook 翻译文档 <a href="http://camsong.github.io/redux-in-chinese/index.html" target="_blank" rel="external">http://camsong.github.io/redux-in-chinese/index.html</a></p>
<h1 id="advantage">advantage</h1><p>随着spa（不是SPA，是单页应用）的发展，以 react 来说，组件化和状态机的思想真是解放了烦恼的 dom 操作，一切都为状态。state 来操纵 views 的变化。<br>然而，因为页面的组件化，导致每个组件都必须维护自身的一套状态，对于小型应用还好。<br>但是对于比较大的应用来说，过多的状态显得错综复杂，到最后难以维护，很难清晰地组织所有的状态，在多人开发中也是如此，导致经常会出现一些不明所以的变化，越到后面调试上也是越麻烦，很多时候 state 的变化已经不受控制。对于组件间通行、服务端渲染、路由跳转、更新调试，我们很需要一套机制来清晰的组织整个应用的状态，redux 应然而生，这种数据流的思想真是了不起。</p>
<h1 id="state_根对象的结构">state 根对象的结构</h1><p>在 react 中，我们尽量会把状态放在顶层的组件，在顶层组件使用 redux 或者 router。<br>这就把组件分为了两种：容器组件和展示组件。<br>容器组件：和 redux 和 router 交互，维护一套状态和触发 action。<br>展示组件：展示组件是在容器组件的内部，他们不维护状态，所有数据通过 props 传给他们，所有操作也是通过回调完成。<br>这样，我们整套应用的架构就显得清晰了。</p>
<h1 id="part">part</h1><p>redux 分为三大部分，store ， action ，reducer 。</p>
<h2 id="store">store</h2><p>整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。<br>或者这么说 store 的指责有这些：</p>
<ul>
<li>维护整个应用的 state</li>
<li>提供 getState() 方法获取 state；</li>
<li>提供 dispatch(action) 方法更新 state；</li>
<li>通过 subscribe(listener) 注册监听器。</li>
</ul>
<p>这么解释一下，整个应用的 state 都储存在 store 中，容器组件可以从 store 中获取所需要的状态。<br>容器组件同时也可以发送给 store 一个 action，告诉他改变某个状态的值，所以说容器组件只要发送一个指令，就可以叫 store 去 setState，然后 store 的 state 改变，回过来容器组件获取到的 state 改变，导致 views 的更新。</p>
<h2 id="action">action</h2><p>action 可以理解为一种指令，store 数据的唯一由来就是 action，action 是一个对象，它需要至少一个元素，type，type 是这个指令的唯一标识，其它元素是传送这个指令的 state 值<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">type</span>:<span class="value"> ACTION_TYPE,</span><br><span class="line">  text: “content”,</span><br><span class="line"></span></span></span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个指令由组件触发，然后传到 reducer。</p>
<h2 id="reducer">reducer</h2><p>action 只是说明了要去做什么，和做这件事情需要的参数值。<br>具体去改变 store 中的 state 是由 reducer 来做的。<br>reducer 其实是一个包含 switch 的函数，前面不是说组件触发的 action 会传递到 reducer，reducer 接收这个参数 action，他通过 switch(action.type) 然后做不同操作，前面说了，这个 type 是指令的标识，reducer 根据这个标识来作出不同的操作。<br>这个操作是什么呢？<br>reducer 还接收另一个参数 state，这个是旧的 state。从 action 里面还可以获取到做这个操作需要的 参数值。<br>这个操作其实就是对原有的 state 和 从 action 中的到的值，来进行操作（结合，删除，…）然后返回一个 新的 state 到 store。</p>
<h2 id="数据流">数据流</h2><p>把前面的语言组织一下，整个操作的数据流其实是这样的：</p>
<ol>
<li>store 把整个应用的 state，getState()，dispatch()，subscribe() 传给顶层容器组件；</li>
<li>容器组件和三个部分交互：<ul>
<li>内部的展示组件：容器把状态分发给各个组件，把 dispatch（操作数据的函数）以回调的形式分发给各个组件；</li>
<li>action：容器获取 action；</li>
<li>reducer：容器可以调用 dispatch(action)，这个上面说了，会以回调的形式给下面的子组件，这样就可以根据不同的用户操作，调用不同的 dispatch(action)，执行了这个函数之后，就把 action 传给 reducer，然后看 reducer；</li>
</ul>
</li>
<li>reducer 得到容器组件传来的 action 之后，根据 action.type 这个参数执行不同操作，他还会接收到 store 里面的原 state，然后把原 state 和 action 对象里面的其它参数进行操作，然后 return 一个新的对象。</li>
<li>reducer return 一个新的对象到 store，store 根据这个新对象，更新应用状态。</li>
</ol>
<p>－－－－一个循环 ♻️</p>
<h1 id="connect">connect</h1><p>Redux 和 React 之间没有关系，他们并补互相依赖，但是 Redux 和 React 搭配起来简直完美。<br>我们可以通过 react-redux 这个库把他们绑定起来<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save react-redux</span></span></span><br></pre></td></tr></table></figure></p>
<p>react-redux 提供两个东西 Provider 和 connect。</p>
<h2 id="Provider">Provider</h2><p>这个 Provider 其实就是一个中间件，他是在原有 App Container 上面再包一层，他的作用就是接收 store 里面的 store 作为 props，将store放在context里，给下面的connect用的。</p>
<h2 id="connect-1">connect</h2><p>这个组件才是真正连接 Redux 和 React，他包在我们的容器组件的外一层，他接收上面 Provider 提供的 store 里面的 state 和 dispatch，传给一个构造函数，返回一个对象，以属性形式床给我们的容器组件。</p>
<h1 id="实战_TodoList">实战 TodoList</h1><p>这个项目使用 webpack 来构建，想要了解 webpack 的配置可以看我的其它两篇文章：<br><a href="http://qiutc.me/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8webpack%E2%80%94webpack-howto.html">如何使用webpack—webpack-howto</a>;<br><a href="http://qiutc.me/post/webpack-best-practice-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7.html">webpack-best-practice-最佳实践-部署生产</a>.</p>
<h2 id="目录结构">目录结构</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app                 <span class="comment">#开发目录</span></span><br><span class="line">|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   ├──actions          #action的文件</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   ├──components       #内部组件</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   ├──containers       #容器组件</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   ├──reducers         #reducer文件</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   ├──stores           #store配置文件</span><br><span class="line"></span>|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   └──index.js         #入口文件</span><br><span class="line"></span>|<span class="string">      </span><br><span class="line">├── dist                #发布目录</span><br><span class="line">├── node_modules        #包文件夹</span><br><span class="line">├── .gitignore     </span><br><span class="line">├── .jshintrc      </span><br><span class="line">├── server.js           #本地静态服务器      </span><br><span class="line">├── webpack.config.js   #webpack配置文件</span><br><span class="line">└── package.json</span></span><br></pre></td></tr></table></figure>
<p>这里，我们只关注我们的 app 开发目录。</p>
<h2 id="index-js_入口文件">index.js 入口文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./containers/App'</span>;</span><br><span class="line"><span class="keyword">import</span> configureStore <span class="keyword">from</span> <span class="string">'./stores/configureStore'</span>;</span><br><span class="line"><span class="keyword">const</span> store = configureStore();</span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="title">Provider</span> <span class="attribute">store</span>=<span class="value">&#123;store&#125;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">App</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">Provider</span>&gt;</span>,</span><br><span class="line">  document.getElementById('root')</span><br><span class="line">);</span></span><br></pre></td></tr></table></figure>
<p>这里我们从 react-redux 中获取了一个 Provider 组件，我们把它渲染到应用的最外层。<br>他需要一个属性 store ，他把这个 store 放在context里，给App(connect)用。</p>
<h2 id="store-1">store</h2><p><code>app/stores.configureStore.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'../reducers'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">configureStore</span>(<span class="params">initialState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = createStore(rootReducer, initialState);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">'../reducers'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> nextReducer = <span class="built_in">require</span>(<span class="string">'../reducers'</span>);</span><br><span class="line">      store.replaceReducer(nextReducer);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> store;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>他从 redux 拿到 createStore 这个函数，再获取到 rootReducer ；<br>createStore 函数接收两个参数，(reducer, [initialState])，reducer 毋庸置疑，他需要从 store 获取 state，以及连接到 reducer 交互。<br>initialState 是可以自定义的一个初始化 state，可选参数。<br><code>module.hot</code>这个可以不用管，这是 webpack 热加载的处理，你也可以不要他。</p>
<h2 id="容器组件">容器组件</h2><p><code>containers/App.jsx</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, PropTypes &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  addTodo,</span><br><span class="line">  completeTodo,</span><br><span class="line">  setVisibilityFilter,</span><br><span class="line">  VisibilityFilters</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> AddTodo <span class="keyword">from</span> <span class="string">'../components/AddTodo'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../components/TodoList'</span>;</span><br><span class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">'../components/Footer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; dispatch, visibleTodos, visibilityFilter &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">AddTodo</span></span><br><span class="line">          <span class="attribute">onAddClick</span>=<span class="value">&#123;text</span> =&gt;</span></span><br><span class="line">            dispatch(addTodo(text))</span><br><span class="line">          &#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="title">TodoList</span></span><br><span class="line">          <span class="attribute">todos</span>=<span class="value">&#123;visibleTodos&#125;</span></span><br><span class="line">          <span class="attribute">onTodoClick</span>=<span class="value">&#123;index</span> =&gt;</span> dispatch(completeTodo(index))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="title">Footer</span></span><br><span class="line">          <span class="attribute">filter</span>=<span class="value">&#123;visibilityFilter&#125;</span></span><br><span class="line">          <span class="attribute">onFilterChange</span>=<span class="value">&#123;nextFilter</span> =&gt;</span> dispatch(setVisibilityFilter(nextFilter))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    )</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">App.propTypes = &#123;</span><br><span class="line">  visibleTodos: PropTypes.arrayOf(PropTypes.shape(&#123;</span><br><span class="line">    text: PropTypes.string.isRequired,</span><br><span class="line">    completed: PropTypes.bool.isRequired</span><br><span class="line">  &#125;)),</span><br><span class="line">  visibilityFilter: PropTypes.oneOf([</span><br><span class="line">    <span class="string">'SHOW_ALL'</span>,</span><br><span class="line">    <span class="string">'SHOW_COMPLETED'</span>,</span><br><span class="line">    <span class="string">'SHOW_ACTIVE'</span></span><br><span class="line">  ]).isRequired</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selectTodos</span>(<span class="params">todos, filter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (filter) &#123;</span><br><span class="line">    <span class="keyword">case</span> VisibilityFilters.SHOW_ALL:</span><br><span class="line">      <span class="keyword">return</span> todos;</span><br><span class="line">    <span class="keyword">case</span> VisibilityFilters.SHOW_COMPLETED:</span><br><span class="line">      <span class="keyword">return</span> todos.filter(todo =&gt; todo.completed);</span><br><span class="line">    <span class="keyword">case</span> VisibilityFilters.SHOW_ACTIVE:</span><br><span class="line">      <span class="keyword">return</span> todos.filter(todo =&gt; !todo.completed);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里的 state 是 Connect 的组件的</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    visibleTodos: selectTodos(state.todos, state.visibilityFilter),</span><br><span class="line">    visibilityFilter: state.visibilityFilter</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(select)(App);</span><br></pre></td></tr></table></figure></p>
<p>他从 react-redux 获取 connect 连接组件，通过 <code>connect(select)(App)</code> 连接 store 和 App 容器组件。<br>select 是一个函数，他能接收到一个 state 参数，这个就是 store 里面的 state，然后通过这个函数的处理，返回一个对象，把对象里面的参数以属性传送给 App，以及附带一个 dispatch。<br>所以在 App 里面可以：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; dispatch, visibleTodos, visibilityFilter &#125; = <span class="keyword">this</span>.props;</span><br></pre></td></tr></table></figure></p>
<p>所以 App 通过 connect 的到 state 和 dispatch，把 state 传递给子组件。<br>dispatch 这个函数可以接收一个 action 参数，然后就会执行 reducer 里面的操作。<br>比如：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text =&gt;</span><br><span class="line">  dispatch<span class="list">(<span class="keyword">addTodo</span><span class="list">(<span class="keyword">text</span>)</span>)</span></span><br></pre></td></tr></table></figure></p>
<p><code>addTodo(text)</code>，这个函数是在 action 里面的到的，可以看 action 的代码，他其实返回一个 action 对象，所以其实就是<code>dispatch(action)</code> 。</p>
<h2 id="action-1">action</h2><p><code>app/actions/index.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_TODO = <span class="string">'ADD_TODO'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> COMPLETE_TODO = <span class="string">'COMPLETE_TODO'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SET_VISIBILITY_FILTER = <span class="string">'SET_VISIBILITY_FILTER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> VisibilityFilters = &#123;</span><br><span class="line">  SHOW_ALL: <span class="string">'SHOW_ALL'</span>,</span><br><span class="line">  SHOW_COMPLETED: <span class="string">'SHOW_COMPLETED'</span>,</span><br><span class="line">  SHOW_ACTIVE: <span class="string">'SHOW_ACTIVE'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addTodo</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: ADD_TODO,</span><br><span class="line">    text</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">completeTodo</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: COMPLETE_TODO,</span><br><span class="line">    index</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setVisibilityFilter</span>(<span class="params">filter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: SET_VISIBILITY_FILTER,</span><br><span class="line">    filter</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在声明每一个返回 action 函数的时候，我们需要在头部声明这个 action 的 type，以便好组织管理。<br>每个函数都会返回一个 action 对象，所以在 容器组件里面 调用<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text =&gt;</span><br><span class="line">  dispatch<span class="list">(<span class="keyword">addTodo</span><span class="list">(<span class="keyword">text</span>)</span>)</span></span><br></pre></td></tr></table></figure></p>
<p>就是调用<code>dispatch(action)</code> 。</p>
<h2 id="reducer-1">reducer</h2><p><code>app/reducers/visibilityFilter.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  SET_VISIBILITY_FILTER,</span><br><span class="line">  VisibilityFilters</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; SHOW_ALL &#125; = VisibilityFilters;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">visibilityFilter</span>(<span class="params">state = SHOW_ALL, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> SET_VISIBILITY_FILTER:</span><br><span class="line">      <span class="keyword">return</span> action.filter;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> visibilityFilter;</span><br></pre></td></tr></table></figure></p>
<p>这里我们从 actions 获得各个 type 的参数，以便和 action 做好映射对应。<br>整个函数其实就是执行 switch，根据不同的 action.type，返回不同的对象状态。<br>但是如果我们需要 type 很多，比如除了 visibilityFilter，还有 todos，难道要写一个长长的switch，当然不。<br>redux 提供一个 combineReducers 辅助函数，把一个由多个不同 reducer 函数作为 value 的 object，合并成一个最终的 reducer 函数，然后就可以对这个 reducer 调用 createStore。<br>我们把不同的 reducer 放在不同文件下。<br><code>app/reducers/todo.js</code><br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  ADD_TODO,</span><br><span class="line">  COMPLETE_TODO</span><br><span class="line">&#125; <span class="keyword">from</span> '../actions';</span><br><span class="line"></span><br><span class="line">function todos(<span class="keyword">state</span> = [], action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case ADD_TODO:</span><br><span class="line">      return [</span><br><span class="line">        ...<span class="keyword">state</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          text: action.text,</span><br><span class="line">          completed: false</span><br><span class="line">        &#125;</span><br><span class="line">      ];</span><br><span class="line">    case COMPLETE_TODO:</span><br><span class="line">      return [</span><br><span class="line">        ...<span class="keyword">state</span>.slice(<span class="number">0</span>, action.index),</span><br><span class="line">        Object.assign(&#123;&#125;, <span class="keyword">state</span>[action.index], &#123;</span><br><span class="line">          completed: true</span><br><span class="line">        &#125;),</span><br><span class="line">        ...<span class="keyword">state</span>.slice(action.index + <span class="number">1</span>)</span><br><span class="line">      ];</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      return <span class="keyword">state</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> todos;</span><br></pre></td></tr></table></figure></p>
<p>然后通过一个 index.js 把他们合并。<br><code>app/reducers/index.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> todos <span class="keyword">from</span> <span class="string">'./todos'</span>;</span><br><span class="line"><span class="keyword">import</span> visibilityFilter <span class="keyword">from</span> <span class="string">'./visibilityFilter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</span><br><span class="line">  todos,</span><br><span class="line">  visibilityFilter</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure></p>
<h2 id="展示组件">展示组件</h2><p><code>app/components/AddTodo/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"><span class="keyword">import</span> &#123; findDOMNode &#125; from <span class="symbol">'react</span>-dom';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">AddTodo</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input <span class="class"><span class="keyword">type</span>=</span><span class="symbol">'tex</span>t' ref=<span class="symbol">'inpu</span>t' /&gt;</span><br><span class="line">        &lt;button onClick=&#123; e =&gt; <span class="keyword">this</span>.handleClick(e) &#125;&gt;</span><br><span class="line">          <span class="type">Add</span></span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick(e) &#123;</span><br><span class="line">    const inputNode = findDOMNode(<span class="keyword">this</span>.refs.input);</span><br><span class="line">    const text = inputNode.value.trim();</span><br><span class="line">    <span class="keyword">this</span>.props.onAddClick(text);</span><br><span class="line">    inputNode.value = '';</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">AddTodo</span>.propTypes = &#123;</span><br><span class="line">  onAddClick: <span class="type">PropTypes</span>.func.isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>app/components/Todo/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Todo</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; onClick, completed, text &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;li</span><br><span class="line">        onClick=&#123;onClick&#125;</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          textDecoration: completed ? <span class="symbol">'line</span>-through' : <span class="symbol">'non</span>e',</span><br><span class="line">          cursor: completed ? <span class="symbol">'defaul</span>t' : <span class="symbol">'pointe</span>r'</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;text&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Todo</span>.propTypes = &#123;</span><br><span class="line">  onClick: <span class="type">PropTypes</span>.func.isRequired,</span><br><span class="line">  text: <span class="type">PropTypes</span>.string.isRequired,</span><br><span class="line">  completed: <span class="type">PropTypes</span>.bool.isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>app/components/TodoList/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"><span class="keyword">import</span> <span class="type">Todo</span> from '../<span class="type">Todo</span>';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">this</span>.props.todos.map((todo, index) =&gt;</span><br><span class="line">            &lt;<span class="type">Todo</span></span><br><span class="line">              &#123;...todo&#125;</span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onTodoClick(index)&#125;</span><br><span class="line">              key=&#123;index&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">TodoList</span>.propTypes = &#123;</span><br><span class="line">  onTodoClick: <span class="type">PropTypes</span>.func.isRequired,</span><br><span class="line">  todos: <span class="type">PropTypes</span>.arrayOf(<span class="type">PropTypes</span>.shape(&#123;</span><br><span class="line">    text: <span class="type">PropTypes</span>.string.isRequired,</span><br><span class="line">    completed: <span class="type">PropTypes</span>.bool.isRequired</span><br><span class="line">  &#125;).isRequired).isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>app/components/Footer/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Footer</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  renderFilter(filter, name) &#123;</span><br><span class="line">    <span class="keyword">if</span>(filter == <span class="keyword">this</span>.props.filter) &#123;</span><br><span class="line">      <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;a</span><br><span class="line">        href=<span class="string">"#"</span></span><br><span class="line">        onClick=&#123;e =&gt; &#123;</span><br><span class="line">          e.preventDefault();</span><br><span class="line">          <span class="keyword">this</span>.props.onFilterChange(filter);</span><br><span class="line">        &#125;&#125;&gt;</span><br><span class="line">        &#123;name&#125;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        <span class="type">SHOW</span></span><br><span class="line">        &#123;' '&#125;</span><br><span class="line">        &#123;<span class="keyword">this</span>.renderFilter(<span class="symbol">'SHOW_AL</span>L', <span class="symbol">'Al</span>l')&#125;</span><br><span class="line">        &#123;', '&#125;</span><br><span class="line">        &#123;<span class="keyword">this</span>.renderFilter(<span class="symbol">'SHOW_COMPLETE</span>D', <span class="symbol">'Complete</span>d')&#125;</span><br><span class="line">        &#123;', '&#125;</span><br><span class="line">        &#123;<span class="keyword">this</span>.renderFilter(<span class="symbol">'SHOW_ACTIV</span>E', <span class="symbol">'Activ</span>e')&#125;</span><br><span class="line">        .</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Footer</span>.propTypes = &#123;</span><br><span class="line">  onFilterChange: <span class="type">PropTypes</span>.func.isRequired,</span><br><span class="line">  filter: <span class="type">PropTypes</span>.oneOf([</span><br><span class="line">    <span class="symbol">'SHOW_AL</span>L',</span><br><span class="line">    <span class="symbol">'SHOW_COMPLETE</span>D',</span><br><span class="line">    <span class="symbol">'SHOW_ACTIV</span>E'</span><br><span class="line">  ]).isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>可以看出，所有的展示组件需要的 state 和 数据，都从属性中获取的，所有的操作，都是通过容器组件给的回调函数来操作的。<br>他们尽可能地不拥有自己的状态，做无状态组件。</p>
<h1 id="end">end</h1><p>关于 redux 的用法，这只是基础入门的部分，还有的多的搞基操作，比如异步数据流、Middleware、和 router 配合。<br>敬请期待～～～～<br>🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶🐶</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="/img/redux.jpeg" alt="redux"></p>
<h1 id="Tip">Tip</h1><p>前端技术真是日新月异，搞完 React 不搭配个数据流都不好意思了。<br>满怀期待的心去翻了翻 flux，简直被官方那意识流的文档折服了]]>
    </summary>
    
      <category term="FE" scheme="http://qiutc.me/tags/FE/"/>
    
      <category term="react" scheme="http://qiutc.me/tags/react/"/>
    
      <category term="redux" scheme="http://qiutc.me/tags/redux/"/>
    
      <category term="redux" scheme="http://qiutc.me/categories/redux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[谈谈 react-router]]></title>
    <link href="http://qiutc.me/post/%E8%B0%88%E8%B0%88-react-router.html"/>
    <id>http://qiutc.me/post/谈谈-react-router.html</id>
    <published>2015-12-11T01:33:12.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<h1 id="谈谈">谈谈</h1><p>最近使用的 React + webpack 来开发项目，感觉确实是爽的飞起，然而总感觉还是少了点什么。😫<br>😏对，是多页面，每次请求页面还要后端路由给你？😄多不爽啊，试试 react-router ，简直掌控一切的感觉，只开放一个页面路由接口，其他全给数据接口就👌了，😂可以和后端哥哥说拜拜了。<br>👋👋👋👋👋👋👋👋👋👋👋 啪啪啪啪啪～</p>
<p><img src="/img/react-router.png" alt="react-router"></p>
<h1 id="概述">概述</h1><p>先贴上官方文档 <a href="https://github.com/rackt/react-router/tree/master/docs" target="_blank" rel="external">https://github.com/rackt/react-router/tree/master/docs</a>.<br>对了这里还有一份中文文档（不过不是很全）<a href="http://react-guide.github.io/react-router-cn/" target="_blank" rel="external">http://react-guide.github.io/react-router-cn/</a>.<br>react-router 是 React 的完整前端路由解决方案，特别在做一个 spa 应用的时候，他能实现 url 和 视图ui 的同步，并且支持后端渲染，异步按需加载等等😄。<br>由于 react-router 文档的多变，这里的例子以当前版本 1.0.1 为准。（1.0之前文档每一个版本的变动都很大，索多了都是泪）</p>
<h1 id="浏览器支持">浏览器支持</h1><p>所有支持 React 的浏览器。<br>倡议！建议大家也劝说身边的人用<strong><em>现代化</em></strong>浏览器，关爱前端开发者。</p>
<h1 id="安装">安装</h1><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> install react-router<span class="property">@latest</span></span><br></pre></td></tr></table></figure>
<p>同时，react-router 是基于 history 开发的，这里你需要安装 history。<br>注意 react-router 当前版本 1.0.1 依赖的是 history 1.13.1 请不要安装最新版。<br>不要问我为什么知道，被坑惨了；有同学问，那没有办法用 history 的最新版本嘛？毕竟这只是暂缓之计，解决方案还是有的，那就是等 react-router 作者解决咯 😂。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install history@<span class="number">1.13</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></p>
<p>构建工具的话，我依然建议是 webpack ， React 和 webpack 是一对好兄弟。<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> webpack</span><br></pre></td></tr></table></figure></p>
<p>webpack的使用方法可以看我的前两篇文章：</p>
<ul>
<li><a href="http://qiutc.me/post/webpack-best-practice-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7.html">webpack-best-practice-最佳实践-部署生产</a></li>
<li><a href="http://qiutc.me/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8webpack%E2%80%94webpack-howto.html">如何使用webpack—webpack-howto</a><br>(求赞！！！)</li>
</ul>
<h1 id="小例子">小例子</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">// 加载依赖包，这是 es6 的语法（我好啰嗦）。</span><br><span class="line">import React from 'react'</span><br><span class="line">import &#123; render &#125; from 'react-dom'</span><br><span class="line">// 这里从 react-router 引入了三个组件，先不解释。</span><br><span class="line">import &#123; Router, Route, Link &#125; from 'react-router'</span><br><span class="line"></span><br><span class="line">const App = React.createClass(&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      <span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">h1</span>&gt;</span>App<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">Link</span> <span class="attribute">to</span>=<span class="value">"/about"</span>&gt;</span>About<span class="tag">&lt;/<span class="title">Link</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">Link</span> <span class="attribute">to</span>=<span class="value">"/inbox"</span>&gt;</span>Inbox<span class="tag">&lt;/<span class="title">Link</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const Inbox = React.createClass(&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      <span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        Inbox</span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const About = React.createClass(&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      <span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        About</span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">render((</span><br><span class="line">  <span class="tag">&lt;<span class="title">Router</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"/"</span> <span class="attribute">component</span>=<span class="value">&#123;App&#125;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"about"</span> <span class="attribute">component</span>=<span class="value">&#123;About&#125;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"inbox"</span> <span class="attribute">component</span>=<span class="value">&#123;Inbox&#125;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">Router</span>&gt;</span></span><br><span class="line">), document.getElementById('root'));</span><br></pre></td></tr></table></figure>
<p>我就偷个懒把官方文档的demo直接copy了。<br>直接先来看 render 下面的内容，这里是用 jsx 语法。 最外层组件是 Router（可以把他看作是react-router提供的最外层容器） , 下一层是 Route，这个是路由组件。对应关系如下：<br><code>/ ---&gt; &lt;App /&gt;</code><br><code>/about ---&gt; &lt;App&gt;&lt;About /&gt;&lt;/App&gt;</code><br><code>/inbox ---&gt; &lt;App&gt;&lt;Inbox /&gt;&lt;/App&gt;</code><br>path 对应路径，component 对应当前路径渲染的组件。<br>Route 里面的 Route 表示在父组件路由的 path 路径下面的一级 path 对应的路由，这里的路由是父子嵌套，对应的组件也同样是父子嵌套的。<br>如果是多级嵌套也同样如此。</p>
<h1 id="不想用_jsx_来写，换个方式吧～">不想用 jsx 来写，换个方式吧～</h1><p>以上例子可以改写成：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">const routerConfig = [</span><br><span class="line">  &#123;</span><br><span class="line"><span class="label">    path:</span> <span class="string">'/'</span>,</span><br><span class="line"><span class="label">    component:</span> App,</span><br><span class="line"><span class="label">    childrenRoutes:</span> [</span><br><span class="line">      &#123; <span class="string">path:</span> <span class="string">'about'</span>, <span class="string">component:</span> About &#125;,</span><br><span class="line">      &#123; <span class="string">path:</span> <span class="string">'inbox'</span>, <span class="string">component:</span> Inbox &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line">render((</span><br><span class="line">  &lt;Router routes=&#123;routeConfig&#125; /&gt;</span><br><span class="line">), document.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure></p>
<p>这里的结构就更清晰了，我是比较喜欢这种方式。</p>
<h1 id="默认的路由">默认的路由</h1><p>比如上面的例子，/ 对于的组件是 App , 如果 App 只是渲染了一个导航条，却没有自组件，那打开 比如 qiutc.me/ 的时候不是就没有内容了吗。<br>把上面例子改一下<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 添加组件 Index</span></span><br><span class="line">const Index = React.createClass(&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        Index</span><br><span class="line">        Index</span><br><span class="line">        Index</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 修改配置</span></span><br><span class="line">const routerConfig = [</span><br><span class="line">  &#123;</span><br><span class="line"><span class="label">    path:</span> <span class="string">'/'</span>,</span><br><span class="line"><span class="label">    component:</span> App,</span><br><span class="line"><span class="label">    indexRoute:</span> &#123; <span class="string">component:</span> Index &#125;,</span><br><span class="line"><span class="label">    childrenRoutes:</span> [</span><br><span class="line">      &#123; <span class="string">path:</span> <span class="string">'about'</span>, <span class="string">component:</span> About &#125;,</span><br><span class="line">      &#123; <span class="string">path:</span> <span class="string">'inbox'</span>, <span class="string">component:</span> Inbox &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p>
<p>这里加了一个 <code>indexRoute</code> ，表示他在没有匹配子路由的时候，在 / 路由下渲染默认的子组件 Index。<br>路由组件嵌套也是一样的，比如：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123; <span class="rule"><span class="attribute">path</span>:<span class="value"> <span class="string">'about'</span>, component: About, indexRoute: &#123;component: AboutIndex</span></span></span>&#125; &#125;,</span><br></pre></td></tr></table></figure></p>
<p>以此类推。</p>
<h1 id="404_NotFound">404  NotFound</h1><p>如果我们打开了一个没有设置路由的链接，就必然需要一个友好的 404 页面。配置如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 添加 404 组件</span></span><br><span class="line">const NotFound = React.createClass(&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        <span class="number">404</span></span><br><span class="line">        NotFound</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 修改配置</span></span><br><span class="line">const routerConfig = [</span><br><span class="line">  &#123;</span><br><span class="line"><span class="label">    path:</span> <span class="string">'/'</span>,</span><br><span class="line"><span class="label">    component:</span> App,</span><br><span class="line"><span class="label">    indexRoute:</span> &#123; <span class="string">component:</span> Index &#125;,</span><br><span class="line"><span class="label">    childrenRoutes:</span> [</span><br><span class="line">      &#123; <span class="string">path:</span> <span class="string">'about'</span>, <span class="string">component:</span> About &#125;,</span><br><span class="line">      &#123; <span class="string">path:</span> <span class="string">'inbox'</span>, <span class="string">component:</span> Inbox &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line"><span class="label">    path:</span> <span class="string">'*'</span>,</span><br><span class="line"><span class="label">    component:</span> NotFound,</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p>
<p>如此简单。</p>
<h1 id="绝对路径与重定向">绝对路径与重定向</h1><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const routerConfig = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    component: App,</span><br><span class="line">    indexRoute: &#123; component: Index &#125;,</span><br><span class="line">    childrenRoutes: [</span><br><span class="line">      &#123; path: <span class="string">'about'</span>, component: About &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'inbox'</span>,</span><br><span class="line">        component: Inbox,</span><br><span class="line">        childrenRoutes: [</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">'message/:id'</span>,</span><br><span class="line">            component: Message,</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'*'</span>,</span><br><span class="line">    component: NotFound,</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>在这里我们访问 /inbox/message/1 对于渲染 Message 组件，这个链接太长了，我们想直接 /message/1 那怎么办，改路由结构？太麻烦了！绝对路径可以帮你做到这个。<br>把 <code>path: &#39;message/:id&#39;,</code> 改为 <code>path: &#39;/message/:id&#39;,</code> 就好了。<br>等等如果用户之前收藏的链接是 /inbox/message/1 ，那不是就打不开了嘛，和后端路由一样，react-router 也有重定向：redirect<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">const routerConfig = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    component: App,</span><br><span class="line">    indexRoute: &#123; component: Index &#125;,</span><br><span class="line">    childrenRoutes: [</span><br><span class="line">      &#123; path: <span class="string">'about'</span>, component: About &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'inbox'</span>,</span><br><span class="line">        component: Inbox,</span><br><span class="line">        childrenRoutes: [</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">'/message/:id'</span>,</span><br><span class="line">            component: Message,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">'message/:id'</span>,</span><br><span class="line">            onEnter: function (nextState, replaceState) &#123;</span><br><span class="line">              replaceState(null, <span class="string">'/messages/'</span> + nextState.params.id);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'*'</span>,</span><br><span class="line">    component: NotFound,</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p>
<h2 id="onEnter_方法表示进入这个路由前执行的方法，在进入_/inbox/messages/:id_的前，执行">onEnter 方法表示进入这个路由前执行的方法，在进入 /inbox/messages/:id 的前，执行</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(nextState, replaceState)</span> </span>&#123;</span><br><span class="line">  replaceState(<span class="literal">null</span>, <span class="string">'/messages/'</span> + nextState.params.id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>nextState</code>表示要进入的下一个路由，这里就是 /inbox/messages/:id ，<code>replaceState</code> 表示替换路由状态的方法，把 /inbox/messages/:id 替换成 /messages/:id，然后就可以重定向到 /messages/:id。</p>
<h2 id="同样的也有_onLeave_这个方法">同样的也有 onLeave 这个方法</h2><p>表示在离开路由前执行。<br>———————————————————<br>当然如果你用的是 jsx 语法，有更简单的组件可以实现：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Redirect &#125; from 'react-router'</span><br><span class="line"></span><br><span class="line">React.render((</span><br><span class="line">  <span class="tag">&lt;<span class="title">Router</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"/"</span> <span class="attribute">component</span>=<span class="value">&#123;App&#125;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">IndexRoute</span> <span class="attribute">component</span>=<span class="value">&#123;Index&#125;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"about"</span> <span class="attribute">component</span>=<span class="value">&#123;About&#125;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"inbox"</span> <span class="attribute">component</span>=<span class="value">&#123;Inbox&#125;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"/messages/:id"</span> <span class="attribute">component</span>=<span class="value">&#123;Message&#125;</span> /&gt;</span></span><br><span class="line">        &#123;/* 跳转 /inbox/messages/:id 到 /messages/:id */&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="title">Redirect</span> <span class="attribute">from</span>=<span class="value">"messages/:id"</span> <span class="attribute">to</span>=<span class="value">"/messages/:id"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">Router</span>&gt;</span></span><br><span class="line">), document.getElementById('root'))</span><br></pre></td></tr></table></figure></p>
<h1 id="路径匹配原理">路径匹配原理</h1><h2 id="嵌套关系">嵌套关系</h2><blockquote>
<p>React Router 使用路由嵌套的概念来让你定义 view 的嵌套集合，当一个给定的 URL 被调用时，整个集合中（命中的部分）都会被渲染。嵌套路由被描述成一种树形结构。React Router 会深度优先遍历整个理由配置来寻找一个与给定的 URL 相匹配的路由。</p>
</blockquote>
<p>简单来讲，就是说，匹配的时候会先匹配到外层路径，然后依次遍历到内层。<br>比如 /inbox/messages/:id 会先匹配 /，渲染 / 对应的组件 App，然后再到 / 的下一层寻找 /inbox ，同样渲染 /inbox 对应的组件 Inbox，依次类推，直到到 message/:id。</p>
<p>tip：使用绝对路径可以忽略嵌套关系，如上面例子。</p>
<h2 id="路径语法">路径语法</h2><p>路由路径是匹配一个（或一部分）URL 的 一个字符串模式。大部分的路由路径都可以直接按照字面量理解，除了以下几个特殊的符号：</p>
<ul>
<li>/:paramName – 匹配一段位于 /、? 或 # 之后的 URL。 命中的部分将被作为一个参数</li>
<li>(/) – 在它内部的内容被认为是可选的</li>
<li><p>/* – 匹配任意字符（非贪婪的）直到命中下一个字符或者整个 URL 的末尾，并创建一个 splat 参数</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="constant">Route </span>path=<span class="string">"/hello/:name"</span>&gt;         <span class="regexp">//</span> 匹配 /hello/michael 和 /hello/ryan</span><br><span class="line">&lt;<span class="constant">Route </span>path=<span class="string">"/hello(/:name)"</span>&gt;       <span class="regexp">//</span> 匹配 /hello, <span class="regexp">/hello/michael</span> 和 /hello/ryan</span><br><span class="line">&lt;<span class="constant">Route </span>path=<span class="string">"/files/*.*"</span>&gt;           <span class="regexp">//</span> 匹配 /files/hello.jpg 和 /files/path/to/hello.jpg</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="优先级">优先级</h2><p>最后，路由算法会根据定义的顺序自顶向下匹配路由。因此，当你拥有两个兄弟路由节点配置时，你必须确认前一个路由不会匹配后一个路由中的路径。例如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"/comments"</span> <span class="attribute">...</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">Redirect</span> <span class="attribute">from</span>=<span class="value">"/comments"</span> <span class="attribute">...</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>第二个是不会被执行的。</p>
<h1 id="拿到参数路径的">拿到参数路径的</h1><p>比如上面的 /messages/:id ，这个id可能是我们在 Message 获取数据时需要的 id。<br>他会被当做一个参数传给 params，parmas 会传给 Message 组件的 props：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Message = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;&#123; <span class="keyword">this</span>.props.params.id &#125;&lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这样就可以获取到了。</p>
<h1 id="history_配置">history 配置</h1><p>React Router 是建立在 history 之上的。 简而言之，一个 history 知道如何去监听浏览器地址栏的变化， 并解析这个 URL 转化为 location 对象， 然后 router 使用它匹配到路由，最后正确地渲染对应的组件。<br>常用的 history 有三种形式， 但是你也可以使用 React Router 实现自定义的 history。</p>
<ul>
<li>createHashHistory</li>
<li>createBrowserHistory</li>
<li>createMemoryHistory</li>
</ul>
<h2 id="这三个有什么区别呢：">这三个有什么区别呢：</h2><h3 id="createHashHistory">createHashHistory</h3><p>这是一个你会获取到的默认 history ，如果你不指定某个 history 。它用到的是 URL 中的 hash（#）部分去创建形如 example.com/#/some/path 的路由。<br>这个 支持 ie8＋ 的浏览器，但是因为是 hash 值，所以不推荐使用。</p>
<h3 id="createBrowserHistory">createBrowserHistory</h3><p>Browser history 是由 React Router 创建浏览器应用推荐的 history。它使用 History API 在浏览器中被创建用于处理 URL，新建一个像这样真实的 URL example.com/some/path。</p>
<h3 id="Memoryhistory">Memoryhistory</h3><p>不会在地址栏被操作或读取。</p>
<h2 id="使用">使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory, useBasename &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">const</span> historyConfig = useBasename(createHistory)(&#123;</span><br><span class="line">  basename: <span class="string">'/'</span>        <span class="comment">// 根目录名</span></span><br><span class="line">&#125;);</span><br><span class="line">...</span><br><span class="line">render((</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="title">Router</span> <span class="attribute">routes</span>=<span class="value">&#123;routeConfig&#125;</span> <span class="attribute">History</span>=<span class="value">&#123;historyConfig&#125;</span> /&gt;</span></span><br><span class="line">)</span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure>
<h1 id="Link&amp;IndexLink">Link&amp;IndexLink</h1><h2 id="Link">Link</h2><p>我们在最开头看到这样一个东西：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const App = React.createClass(&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      <span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">h1</span>&gt;</span>App<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">Link</span> <span class="attribute">to</span>=<span class="value">"/about"</span>&gt;</span>About<span class="tag">&lt;/<span class="title">Link</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">Link</span> <span class="attribute">to</span>=<span class="value">"/inbox"</span>&gt;</span>Inbox<span class="tag">&lt;/<span class="title">Link</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Link 会被渲染成 a ，to 其实就是 href ，<br>但是 react-router 会阻止默认跳转页面，而改成 history 路由的变换。</p>
<p>参数：</p>
<ul>
<li>to<br>切换到的路由地址</li>
<li>query<br>跟在 url 的 query 参数，比如<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query=<span class="expansion">&#123;&#123;<span class="symbol">q:</span> <span class="string">"que"</span>&#125;&#125;</span> 对应 <span class="string">`/example?a=que</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这里的 query 同样可以像 params 会被传入下一个路由组件的 props</p>
<ul>
<li>hash<br>跟在 url 的 hash 参数，比如<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash=&#123;<span class="number">111</span>&#125; 对应 `/example<span class="preprocessor">#<span class="number">111</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这里的 query 同样可以像 params 会被传入下一个路由组件的 props</p>
<ul>
<li><p>activeClassName<br>当前 url 路径如果和 Link 的 to 匹配 这个 Link 就会有一个定义的属性，比如：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在 /index 下</span><br><span class="line">&lt;<span class="constant">Link</span> to=<span class="string">"/index"</span> activeClassName=&#123;<span class="string">"active"</span>&#125; activeStyle=<span class="expansion">&#123;&#123;<span class="symbol">color:</span> <span class="string">'red'</span>&#125;&#125;</span> &gt;<span class="regexp">/&lt;/</span><span class="constant">Link</span>&gt;</span><br><span class="line">这里渲染出来的 a 标签会有一个激活的 active 类名，还会有一个颜色 red</span><br><span class="line">&lt;<span class="constant">Link</span> to=<span class="string">"/about"</span> activeClassName=&#123;<span class="string">"active"</span>&#125; activeStyle=<span class="expansion">&#123;&#123;<span class="symbol">color:</span> <span class="string">'red'</span>&#125;&#125;</span> &gt;<span class="regexp">/&lt;/</span><span class="constant">Link</span>&gt;</span><br><span class="line">这里渲染出来的 a 标签就不会有以上属性</span><br></pre></td></tr></table></figure>
</li>
<li><p>activeStyle<br>同上</p>
</li>
<li>onClick<br>点击的时候执行的函数，会传入一个 e 事件对象，你可以 <code>e.stopPropagation()</code> 阻止默认路由切换。</li>
</ul>
<h2 id="IndexLink">IndexLink</h2><p>在上面有一个问题如果：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在 / 下 和 /index</span><br><span class="line">&lt;<span class="constant">Link</span> to=<span class="string">"/"</span> activeClassName=&#123;<span class="string">"active"</span>&#125; activeStyle=<span class="expansion">&#123;&#123;<span class="symbol">color:</span> <span class="string">'red'</span>&#125;&#125;</span> &gt;<span class="regexp">/&lt;/</span><span class="constant">Link</span>&gt;</span><br><span class="line">这个 <span class="constant">Link</span> 渲染出来的 a 标签都会激活 active 属性，并且会带上 <span class="symbol">color:</span> <span class="string">'red'</span></span><br><span class="line">因为 / 和 /index 和 ／ 都是匹配的</span><br></pre></td></tr></table></figure></p>
<p>这时候就可以用:<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="constant">IndexLink</span> to=<span class="string">"/"</span> activeClassName=&#123;<span class="string">"active"</span>&#125; activeStyle=<span class="expansion">&#123;&#123;<span class="symbol">color:</span> <span class="string">'red'</span>&#125;&#125;</span> &gt;<span class="regexp">/&lt;/</span><span class="constant">IndexLink</span>&gt;</span><br><span class="line">只会在 / 下呗激活，在 /index 或者其他下面，不会被激活</span><br></pre></td></tr></table></figure></p>
<h1 id="未完待续">未完待续</h1><p>关于 <strong><em>根据路由按需异步加载js</em></strong> 和 <strong><em>服务器端渲染路由视图</em></strong> 以及 <strong><em>react-router的更高级用法</em></strong> 会在下一篇文章来探讨。<br>毕竟哥也需要去深入研究一下才敢献丑。😂😂😂<br>🐶</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="谈谈">谈谈</h1><p>最近使用的 React + webpack 来开发项目，感觉确实是爽的飞起，然而总感觉还是少了点什么。😫<br>😏对，是多页面，每次请求页面还要后端路由给你？😄多不爽啊，试试 react-router ，简直掌控一切的感觉，只开放]]>
    </summary>
    
      <category term="React" scheme="http://qiutc.me/tags/React/"/>
    
      <category term="react-router" scheme="http://qiutc.me/tags/react-router/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="http://qiutc.me/categories/React/"/>
    
      <category term="react-router" scheme="http://qiutc.me/categories/React/react-router/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[webpack-best-practice-最佳实践-部署生产]]></title>
    <link href="http://qiutc.me/post/webpack-best-practice-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7.html"/>
    <id>http://qiutc.me/post/webpack-best-practice-最佳实践-部署生产.html</id>
    <published>2015-12-02T02:56:39.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/img/webpack.png" alt="webpack"></p>
<h1 id="tip">tip</h1><p>webpack的入门篇可以看我的这一片博文。<br><a href="http://qiutc.me/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8webpack%E2%80%94webpack-howto.html">《如何使用webpack—webpack-howto》</a>.</p>
<h1 id="前言">前言</h1><p>最近一段时间在项目中使用了webpack和React来开发，总之来说也是遇到了许多坑，webpack毕竟还是比较新的技术，而且也很难有一个很好的构建案例来适应所有的项目，总之，在看了许多项目demo和官方文档以及官方推荐的tutorials之后，也算是自己总结出的一套最佳实践吧。</p>
<h2 id="代码">代码</h2><p>代码可以在我的<a href="https://github.com/TongchengQiu/webpack-best-practice" target="_blank" rel="external">Github</a>上。<br><a href="https://github.com/TongchengQiu/webpack-best-practice" target="_blank" rel="external">可以戳这里～～</a>。</p>
<h1 id="package-json_命令配置">package.json 命令配置</h1><p>既然是需要用到的是实际项目的构建，那么必然就要考虑开发环境和生产环境下的配置项了：<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"webpack --progress --colors --watch"</span>,</span><br><span class="line">    <span class="string">"watch"</span>: <span class="string">"webpack-dev-server --hot --progress --colors"</span>,</span><br><span class="line">    <span class="string">"dist"</span>: <span class="string">"NODE_ENV=production webpack --progress --colors"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以在目录下执行 <code>npm run build</code> , <code>npm run watch</code> , <code>npm run dist</code><br>解释一下:</p>
<ul>
<li>build 是在我们开发环境下执行的构建命令;</li>
<li>watch 也是在开发环境下执行，但是加了webpack最强大的功能－－搭建静态服务器和热插拔功能（这个在后面介绍;</li>
<li>dist 是项目在要部署到生产环境时打包发布。</li>
</ul>
<p>dist 里面的<code>NODE_ENV=production</code>是声明了当前执行的环境是production－生产环境<br><br><br>后面跟着几个命令：</p>
<ul>
<li>–colors 输出的结果带彩色</li>
<li>–progress 输出进度显示</li>
<li>–watch 动态实时监测依赖文件变化并且更新</li>
<li>–hot 是热插拔</li>
<li>–display-error-details 错误的时候显示更多详细错误信息</li>
<li>–display-modules 默认情况下 node_modules 下的模块会被隐藏，加上这个参数可以显示这些被隐藏的模块</li>
<li>-w 动态实时监测依赖文件变化并且更新</li>
<li>-d 提供sorcemap</li>
<li>-p 对打包文件进行压缩</li>
</ul>
<h1 id="目录结构">目录结构</h1><p>现在前端模块化的趋势导致目录结构也发生了很大的改变和争议，这只是我自己用到的一种形式，可以参考。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app                 <span class="comment">#开发目录</span></span><br><span class="line">|<span class="string">   ├──assets           #存放静态资源</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   ├──datas        #存放数据 json 文件</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   ├──images       #存放图片资源文件</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   └──styles       #存放全局sass变量文件和reset文件</span><br><span class="line"></span>|<span class="string">   ├──lib</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   ├──components   #存放数据 模块组件 文件</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">   └──Header</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">       ├──Header.jsx</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">       └──Header.scss</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">       </span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   └──utils        #存放utils工具函数文件</span><br><span class="line"></span>|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   └──views</span><br><span class="line"></span>|<span class="string">       ├──Index        #入口文件</span><br><span class="line"></span>|<span class="string">       </span>|<span class="string">   ├──Index.html #html文件</span><br><span class="line"></span>|<span class="string">       </span>|<span class="string">   ├──Index.jsx</span><br><span class="line"></span>|<span class="string">       </span>|<span class="string">   └──Index.scss</span><br><span class="line"></span>|<span class="string">       └──Index2</span><br><span class="line">├── dist                #发布目录</span><br><span class="line">├── node_modules        #包文件夹</span><br><span class="line">├── .gitignore     </span><br><span class="line">├── .jshintrc      </span><br><span class="line">├── webpack.config.js   #webpack配置文件</span><br><span class="line">└── package.json</span></span><br></pre></td></tr></table></figure></p>
<p>具体可以到Github上看demo。</p>
<h1 id="webpack-config-js">webpack.config.js</h1><h2 id="引入包">引入包</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br></pre></td></tr></table></figure>
<p>这个毋庸置疑吧。</p>
<h2 id="判断是否是在当前生产环境">判断是否是在当前生产环境</h2><p>定义函数判断是否是在当前生产环境，这个很重要，一位开发环境和生产环境配置上有一些区别<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isProduction = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> process.env.NODE_ENV === <span class="string">'production'</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="声明文件夹">声明文件夹</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义输出文件夹</span></span><br><span class="line"><span class="keyword">var</span> outputDir = <span class="string">'./dist'</span>;</span><br><span class="line"><span class="comment">// 定义开发文件夹</span></span><br><span class="line"><span class="keyword">var</span> entryPath = <span class="string">'./app/views'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="定义插件">定义插件</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var plugins = [</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">'commons'</span>,</span><br><span class="line">    filename: <span class="string">'js/commons.js'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">    React: <span class="string">'react'</span>,</span><br><span class="line">    ReactDOM: <span class="string">'react-dom'</span>,</span><br><span class="line">    reqwest: <span class="string">'reqwest'</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">];</span><br><span class="line"><span class="keyword">if</span>( isProduction() ) &#123;</span><br><span class="line">  plugins.<span class="keyword">push</span>(</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">      test: <span class="regexp">/(\.jsx|\.js)$/</span>,</span><br><span class="line">      compress: &#123;</span><br><span class="line">        warnings: <span class="keyword">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>CommonsChunkPlugin 插件可以打包所有文件的共用部分生产一个commons.js文件。</li>
<li>ProvidePlugin 插件可以定义一个共用的入口，比如 下面加的 React ,他会在每个文件自动require了react，所以你在文件中不需要 require(‘react’)，也可以使用 React。</li>
<li>如果是在生产环境下，则加入插件 UglifyJsPlugin ，执行代码压缩，并且去除 warnings。</li>
</ol>
<h2 id="自动遍历多文件入口">自动遍历多文件入口</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var entris = fs.readdirSync(entryPath).reduce(function (o, <span class="keyword">filename</span>) &#123;</span><br><span class="line">    !/\./.test(<span class="keyword">filename</span>) &amp;&amp;</span><br><span class="line">    (o[<span class="keyword">filename</span>] = <span class="string">'./'</span> + path.<span class="keyword">join</span>(entryPath, <span class="keyword">filename</span>, <span class="keyword">filename</span> + <span class="string">'.jsx'</span>));</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">  &#125;, &#123;&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>函数会自动遍历开发的入口文件夹下面的文件，然后一一生产入口并且返回一个对象－－入口。</p>
<h2 id="如果在这一步不需要多页面多入口">如果在这一步不需要多页面多入口</h2><p>那么可以使用<a href="https://www.npmjs.com/package/html-webpack-plugin" target="_blank" rel="external">html-webpack-plugin</a>插件，它可以自动为入口生成一个html文件，配置如下：<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line">plugins.push(<span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  <span class="attribute">title</span>: <span class="string">'index'</span>,</span><br><span class="line">  <span class="attribute">filename</span>: outputDir+<span class="string">'/index.html'</span>,  <span class="comment">#生成html的位置</span></span><br><span class="line">  <span class="attribute">inject</span>: <span class="string">'body'</span>,                     <span class="comment">#插入script在body标签里</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p>
<p>entry 就可以自定义一个入口就够了</p>
<h2 id="config的具体配置">config的具体配置</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">  target: <span class="string">'web'</span>,</span><br><span class="line">  cache: <span class="literal">true</span>,</span><br><span class="line">  entry: entris,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: outputDir,</span><br><span class="line">    filename: <span class="string">'js/[name].bundle.js'</span>,</span><br><span class="line">    publicPath: isProduction()? <span class="string">'http://******'</span> : <span class="string">'http://localhost:3000'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="module"><span class="keyword">module</span>: </span>&#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/(\.jsx|\.js)$/</span>,</span><br><span class="line">        loaders: [<span class="string">'babel?presets[]=es2015&amp;presets[]=react'</span>],</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        loaders: [<span class="string">'style'</span>, <span class="string">'css?root='</span>+__dirname, <span class="string">'resolve-url'</span>, <span class="string">'sass'</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.json$/</span>,</span><br><span class="line">        loader: <span class="string">'json'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(jpe?g|png|gif|svg)$/</span>,</span><br><span class="line">        loader: <span class="string">'url?limit=1024&amp;name=img/[name].[ext]'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(woff2?|otf|eot|svg|ttf)$/i</span>,</span><br><span class="line">        loader: <span class="string">'url?name=fonts/[name].[ext]'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">        loader: <span class="string">'file?name=views/[name].[ext]'</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: plugins,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'jsx'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: isProduction()?<span class="literal">null</span>:<span class="string">'source-map'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里来一一说明：</p>
<h3 id="对于output">对于output</h3><p>path和filename都不用多说了，path是生成文件的存放目录，filename是文件名，当然可以在前面加上目录位置。<br>这里提醒一下，filename 的相对路径就是 path了，并且下面 静态文件生成的filename也是相对于这里的path的，比如 image 和 html。<br>publicPath 的话是打包的时候生成的文件链接，比如 图片 资源，<br>如果是在生产环境当然是用服务器地址，如果是开发环境就是用本地静态服务器的地址。</p>
<h3 id="module_loaders_打包加载的处理器">module loaders 打包加载的处理器</h3><p>可以不用夹 loader了 比如 原来 url-loader  现在 url</p>
<h4 id="js/jsx">js/jsx</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">test</span>:<span class="value"> /(\.jsx|\.js)$/,</span><br><span class="line">  loaders: [<span class="string">'babel?presets[]=es2015&amp;presets[]=react'</span>],</span><br><span class="line">  exclude: /node_modules/</span><br><span class="line"></span></span></span>&#125;,</span><br></pre></td></tr></table></figure>
<p>对于js文件和jsx文件用了babel来处理，这里注意一下，最新版本的babel吧es2015和react的处理分开了，所有要这么写。</p>
<h3 id="处理scss文件">处理scss文件</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">test</span>:<span class="value"> /\.scss$/,</span><br><span class="line">  loaders: [<span class="string">'style'</span>, <span class="string">'css?root='</span>+__dirname, <span class="string">'resolve-url'</span>, <span class="string">'sass'</span>]</span><br><span class="line"></span></span></span>&#125;,</span><br></pre></td></tr></table></figure>
<p>这里用了sass、css、style的loader这不用多说了。<br>那么root和resolve-url是怎么回事呢，root是定义了scss文件里面声明的url地址是相对于根目录的，然后resolve-url回去相对解析这个路径，而不用require去获取，比如<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span><span class="value">: <span class="function">url</span>(<span class="string">'./assets/images/webpack.png'</span>);</span></span><br></pre></td></tr></table></figure></p>
<p>这样就可以加载到<code>./assets/images/webpack.png</code>这个文件，而不用使用相对路径和require</p>
<h3 id="处理json文件">处理json文件</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">test</span>:<span class="value"> /\.json$/,</span><br><span class="line">  loader: <span class="string">'json'</span>,</span><br><span class="line"></span></span></span>&#125;,</span><br></pre></td></tr></table></figure>
<p>对于json文件，可以自动请求该模块并且打包。</p>
<h3 id="处理_图片_字体_资源文件">处理 图片 字体 资源文件</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">test</span>:<span class="value"> /\.(jpe?g|png|gif|svg)$/,</span><br><span class="line">  loader: <span class="string">'url?limit=1024&amp;name=img/[name].[ext]'</span></span><br><span class="line"></span></span></span>&#125;,</span><br><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">test</span>:<span class="value"> /\.(woff2?|otf|eot|svg|ttf)$/i,</span><br><span class="line">  loader: <span class="string">'url?name=fonts/[name].[ext]'</span></span><br><span class="line"></span></span></span>&#125;,</span><br></pre></td></tr></table></figure>
<p>这里使用了 url 这个loader，但是url依赖 file-loader，它是对file-loader的二次封装。<br>在请求图片的时候如果文件大小小于 1024k ，使用内联 base64 URLs，否则会自动导入到name所声明的目录，这里是相对之前声明的 outputDir 路径。<br>字体资源也是一样。</p>
<h3 id="处理html文件">处理html文件</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">test</span>:<span class="value"> /\.html$/,</span><br><span class="line">  loader: <span class="string">'file?name=views/[name].[ext]'</span></span><br><span class="line"></span></span></span>&#125;,</span><br></pre></td></tr></table></figure>
<p>在多页面的项目中需要，可以自动吧html文件导入到指定的生产文件夹下。</p>
<h2 id="resolve">resolve</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">resolve</span>: <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">extensions</span>:<span class="value"> [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'jsx'</span>],</span><br><span class="line"></span></span></span>&#125;,</span><br></pre></td></tr></table></figure>
<p>是可以忽略的文件后缀名，比如可以直接<code>require(&#39;Header&#39;);</code>而不用加.jsx。</p>
<h2 id="devtool">devtool</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">devtool:</span> isProduction()?null:<span class="string">'source-map'</span>,</span><br></pre></td></tr></table></figure>
<p>规定了在开发环境下才使用 source-map。</p>
<h1 id="疑问">疑问</h1><p>目前为止，对于多页面项目还是没有找到一个很好的方案去构建自动化。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="/img/webpack.png" alt="webpack"></p>
<h1 id="tip">tip</h1><p>webpack的入门篇可以看我的这一片博文。<br><a href="http://qiutc.me/post/%E5%A6%82%]]>
    </summary>
    
      <category term="FE" scheme="http://qiutc.me/tags/FE/"/>
    
      <category term="webpack" scheme="http://qiutc.me/tags/webpack/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="构建工具" scheme="http://qiutc.me/tags/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
    
      <category term="webpack" scheme="http://qiutc.me/categories/webpack/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[[RN]2.样式style--React-Native learning notes]]></title>
    <link href="http://qiutc.me/post/RN-2-%E6%A0%B7%E5%BC%8Fstyle-React-Native-learning-notes.html"/>
    <id>http://qiutc.me/post/RN-2-样式style-React-Native-learning-notes.html</id>
    <published>2015-11-22T08:27:03.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<h1 id="tip:">tip:</h1><p>这是一篇学习 React-Native for Android 的学习笔记，主要上其实是看官方的文档来自己学习 RN，目前的主要是学习android的开发。</p>
<p>😏😏😏😏😏😏😏😏😏😏😏😏😏😏😏😏</p>
<h1 id="React-Native_for_Android_样式的使用。">React-Native for Android 样式的使用。</h1><p>React-Native 编写的应用的样式不是靠css来实现的，而是依赖javascript来为你的应用来添加样式，先不讨论这样做的好处与坏处，因为这个实现方法本身就存在着很多争议，我们主要关注他的样式的语法和特性。</p>
<h1 id="声明样式:">声明样式:</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> styles = StyleSheet.create(&#123;</span><br><span class="line">     <span class="keyword">base</span>: &#123;</span><br><span class="line">          width: <span class="number">38</span>,</span><br><span class="line">          height: <span class="number">38</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     background: &#123;</span><br><span class="line">          backgroundColor: <span class="string">'#222222'</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     active: &#123;</span><br><span class="line">          borderWidth: <span class="number">2</span>,</span><br><span class="line">          borderColor: ‘<span class="preprocessor">#ff00ff',</span></span><br><span class="line">     &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>从语法来看：调用了React-Native的一个构造方法，传入一个对象生成style，如果你写过React就应该很熟悉这种写法，和React的React.createCladd()语法是一样的，传入对象的key就相当于类名（我是这么理解），每个类也是一个对象，可以配置各种样式参数，总体来说和CSS的写法差不多，差别上把CSS的命名又“-”连字符改成驼峰写法，然后长度不用加单位“px”，字符串比如色值需要加引号写成字符串。<br>其实也是和React的行内样式写法的语法一样。</p>
<h1 id="样式的使用:">样式的使用:</h1><p>所有的核心组件都支持样式属性<br><code>&lt;View style={style.base} /&gt;</code><br>当你需要设置多个属性类的时候，可以传入一个数组<br><code>&lt;View style={[style.base,style.backgroundColor]} /&gt;</code><br>在两个样式又冲突的情况下，以右边的值优先，有些情况下可以加一些条件判断样式是否加载，比如，<br><code>&lt;View style={[style.base,this.state.active&amp;&amp;style.active]} /&gt;</code><br>你也可以在组件中render样式，然而这种做法不推荐，其实就像一般html页面中行内样式不推荐一样，<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;View</span><br><span class="line">  style=&#123;[styles.base,&#123;<span class="variable">width</span>:<span class="keyword">this</span>.state.<span class="variable">width</span>, <span class="variable">height</span>:<span class="keyword">this</span>.state.<span class="variable">width</span>*<span class="keyword">this</span>.state.aspectRatio&#125;]&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="布局_–_flexbox">布局 – flexbox</h1><p>React-Native 采用flexbox布局方式，flexbox是css3引入的布局模型－－弹性盒子模型，旨在通过弹性的方式对齐和分布容器中的item，使其适应不同的宽度和高度。<br>在 React-Native 中的flexbox 是css3中flexbox的一个子集，并不支持所有的flexbox属性。<br>flexbox  布局分为flexbox container 和 flexbox item ：如下图<br><img src="/img/RN_img_4.png" alt=""><br>flexbox 是一个属性的集合，有些是属于container的有些湿属于item的。<br>可以看下面这幅图：<br><img src="/img/RN_img_5.png" alt=""><br>对于 container 有 main axis（主轴）和cross axis（交叉轴）。main size 和 cross size 分别是container主轴方向的交叉轴方向的宽度，main start 和 main end 分别是主轴的起始和结点，其他同理，container里面包含items。<br>下面介绍一下属性：</p>
<h2 id="container的属性：">container的属性：</h2><ul>
<li><p>flexDirection: ‘ row ‘ | ‘ column ‘<br>主轴的方向，水平 | 垂直，默认是 column ，item会按照主轴方向排列。</p>
</li>
<li><p>flexWrap: ‘ warp ‘ | ‘ nowrap ’<br>flexbox 会默认将所有元素基于一行，这个属性表示是否折行。</p>
</li>
<li><p>alignItems: ‘ flex-start ’ | ’ flex-end ’ | ’ center ’ | ‘ stretch ‘<br>表示item在 cross axis 上的对齐方式，基于cross axis的顶部｜基于cross axis的底部｜基于cross axis的中部｜布满整个。</p>
</li>
<li><p>justifyContent: ‘ flex-start ’ | ‘ flex-end ‘ | ‘ center ‘ | ‘ space-between ‘ | ’space-around’<br>表示item在 main axis 上的对齐方式，基于主轴开始｜基于主轴结束｜居中｜左右两边对齐，item间隔相等｜每个item两端间隔相等。</p>
</li>
</ul>
<h2 id="item的属性">item的属性</h2><ul>
<li><p>flex: num<br>item 所占的比例大小。</p>
</li>
<li><p>alignSelf:‘ flex-start ’ | ’ flex-end ’ | ’ center ’ | ‘ stretch ‘<br>它允许项目中当个item和其他itemsyou不一样的对齐方式，会覆盖alignitems的属性。</p>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="tip:">tip:</h1><p>这是一篇学习 React-Native for Android 的学习笔记，主要上其实是看官方的文档来自己学习 RN，目前的主要是学习android的开发。</p>
<p>😏😏😏😏😏😏😏😏😏😏😏😏😏😏]]>
    </summary>
    
      <category term="FE" scheme="http://qiutc.me/tags/FE/"/>
    
      <category term="React-Native" scheme="http://qiutc.me/tags/React-Native/"/>
    
      <category term="learning notes" scheme="http://qiutc.me/tags/learning-notes/"/>
    
      <category term="React-Native" scheme="http://qiutc.me/categories/React-Native/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[[RN]1.环境搭建--React-Native learning notes]]></title>
    <link href="http://qiutc.me/post/RN-1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-React-Native-learning-notes.html"/>
    <id>http://qiutc.me/post/RN-1-环境搭建-React-Native-learning-notes.html</id>
    <published>2015-11-21T12:57:35.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<h1 id="tip:">tip:</h1><p>这是一篇学习 React-Native for Android 的学习笔记，主要上其实是看官方的文档来自己学习 RN，目前的主要是学习android的开发。</p>
<h1 id="React-Native_for_Android_的环境搭建">React-Native for Android 的环境搭建</h1><h3 id="要求：">要求：</h3><ol>
<li>前提 OS X (假设大家有用Mac了😏ß);</li>
<li><a href="http://brew.sh/" target="_blank" rel="external">Homebrew</a> (包管理器)(用来安装Watchman 和 Flow);</li>
<li>安装<a href="https://nodejs.org/" target="_blank" rel="external">node.js</a> 4.0 或者以上;</li>
<li>安装 watchman(文件监控) ,在命令行: <code>brew install watchman</code>;</li>
<li>安装 flow ,在命令行: <code>brew install flow</code>;</li>
<li>安装最新的 <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">JDK</a>;</li>
<li>安装 SDK ,在命令行: <code>brew install android-idk</code>;</li>
<li>配置 android 环境:<br>在 ~/.bashrc, ~/.bash_profile写入<br>  <code>export ANDROID_HOME=/usr/local/opt/android-sdk</code>;<br>(在这一步可以先到~目录下，然后如果没有.bashrc，就创建一个，然后vim .bashrc，然后写入上面代码，按esc键，输入<code>:wq</code>，然后自动保存退出，.bash_profile同理);</li>
<li>配置 SDK:<br>新开一个shell窗口：运行 <code>android</code>,<br>会弹出 Android SDK Manager窗口，<br>安装下列选项:<br><img src="/img/RN_img_1.png" alt=""><br><img src="/img/RN_img_2.png" alt=""><br>(tip: 这一步可能需要翻墙);</li>
<li>安装 <a href="https://www.genymotion.com/#!/download/freemium/mac/classical" target="_blank" rel="external">Genymotion</a> (android 的模拟器,推荐使用这个吧);</li>
<li>安装react native 的命令行工具包,在命令行: <code>npm install -g react-native-cli</code>;</li>
<li>命令行进入需要创建的文件夹目录下: <code>react-native init AwesomeProject</code>，会自动获取下载react native的包（建议翻墙）;</li>
<li><p>项目的目录结构如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="tag">android</span>           <span class="id">#android</span>需要的文件夹</span><br><span class="line">├── <span class="tag">ios</span>               <span class="id">#ios</span>需要的文件夹</span><br><span class="line">├── <span class="tag">node_modules</span>      <span class="id">#npm</span>包文件夹</span><br><span class="line">├── <span class="tag">index</span><span class="class">.android</span><span class="class">.js</span>  <span class="id">#android</span>应用的入口<span class="tag">js</span>文件</span><br><span class="line">├── <span class="tag">index</span><span class="class">.ios</span><span class="class">.js</span>      <span class="id">#ios</span>应用的入口<span class="tag">js</span>文件</span><br><span class="line">└── <span class="tag">package</span><span class="class">.json</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>打开Genymotion,下载安装最新的android模拟器，打开;</p>
</li>
<li>在文件夹下运行命令行: <code>react-native run-android</code>,等待安装，<br>然后android的模拟器就会出现：<br><img src="/img/RN_img_3.png" alt=""><br>ß<h2 id="完成！">完成！</h2></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="tip:">tip:</h1><p>这是一篇学习 React-Native for Android 的学习笔记，主要上其实是看官方的文档来自己学习 RN，目前的主要是学习android的开发。</p>
<h1 id="React-Native_for_Androi]]>
    </summary>
    
      <category term="FE" scheme="http://qiutc.me/tags/FE/"/>
    
      <category term="React-Native" scheme="http://qiutc.me/tags/React-Native/"/>
    
      <category term="learning notes" scheme="http://qiutc.me/tags/learning-notes/"/>
    
      <category term="React-Native" scheme="http://qiutc.me/categories/React-Native/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用webpack—webpack-howto]]></title>
    <link href="http://qiutc.me/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8webpack%E2%80%94webpack-howto.html"/>
    <id>http://qiutc.me/post/如何使用webpack—webpack-howto.html</id>
    <published>2015-10-21T02:58:10.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<h1 id="如何使用webpack">如何使用webpack</h1><p>本文章翻译自petehunt的webpack-howto教程，<a href="https://github.com/petehunt/webpack-howto" target="_blank" rel="external">原地址https://github.com/petehunt/webpack-howto</a>，还有源码。</p>
<h2 id="本教程的目标">本教程的目标</h2><p>这是一本如何使用webpack来处理代码的“烹饪书”，它包括了我们在Instagram用的大多数东西以及我们还没在项目中用到过的。<br>我（作者）的建议：把这本书作为你学习webpack文档的开端，然后配合看官方文档的说明。</p>
<h2 id="预备知识">预备知识</h2><ul>
<li>你了解browserify，ReqiureJs或者其他类似的东西。</li>
<li>你明白这些东西的价值：<ul>
<li>打包分离</li>
<li>异步加载</li>
<li>打包静态资源，比如图片和CSS</li>
</ul>
</li>
</ul>
<h2 id="1-为什么使用webpack？">1.为什么使用webpack？</h2><ul>
<li><strong>他类似browserify</strong> 但是可以把你的应用分离成许多文件，如果你有许多页面在你的单页应用里面，用户只需要下载当前页面所需要的代码。如果你跳转到另一个页面，他们不需要重新加载通用的代码。</li>
<li><strong>他能替代grunt或者gulp大部分的功能</strong> 因为他可以构建和打包CSS，预处理CSS，编译JS和打包处理图片，甚至更多事情。<br>他支持AMD和CommonJs以及其他的模块化系统（Angular，ES6）。如果你不知道用什么，那么可以用CommonJs。</li>
</ul>
<h2 id="2-给用browserify的人">2.给用browserify的人</h2><p>下面的代码是等价的：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">browserify</span> <span class="tag">main</span><span class="class">.js</span> &gt; <span class="tag">bundle</span><span class="class">.js</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">webpack</span> <span class="tag">main</span><span class="class">.js</span> <span class="tag">bundle</span><span class="class">.js</span></span><br></pre></td></tr></table></figure>
<p>然而，webpack比browserify更加强大，你可能会更愿意去编写一个<code>webpack.config.js</code>来合理地组织你的项目：<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports = </span>&#123;</span><br><span class="line">    entry: <span class="string">'./main.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这就是JS，所以你可以很轻松地在这个文件里编写代码。</p>
<h2 id="3-如何调用webpack？">3.如何调用webpack？</h2><p>切换带包含webpack.config.js的目录然后在命令行运行：</p>
<ul>
<li><code>webpack</code> 执行一次开发时的编译</li>
<li><code>webpack -p</code> 执行一次生成环境的编译（压缩）</li>
<li><code>webpack --watch</code> 在开发时持续监控增量编译（很快）</li>
<li><code>webpack -d</code> 让他生成SourceMaps</li>
</ul>
<h2 id="编译JS语言">编译JS语言</h2><p>webpack和browserify一样能转化（transforms）的RequireJs插件是一个加载器（loader）<br>你能让webpack加载CoffeeScript和Facebook的JSX+ES6支持（你必须先 <code>npm install babel-loader coffee-loader</code>）:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">module.exports = &#123;</span><br><span class="line"><span class="label">    entry:</span> <span class="string">'./main.js'</span>,</span><br><span class="line"><span class="label">    output:</span> &#123;</span><br><span class="line"><span class="label">        filename:</span> <span class="string">'bundle,js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="label">    module:</span> &#123;</span><br><span class="line"><span class="label">        loader:</span> [</span><br><span class="line">            &#123; <span class="string">test:</span> <span class="regexp">/\.coffee$/</span>, <span class="string">loader:</span> <span class="string">'coffee-loader'</span> &#125;,</span><br><span class="line">            &#123; <span class="string">test:</span> <span class="regexp">/\.js$/</span>, <span class="string">loader:</span> <span class="string">'bebel-loader'</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>为了开启后缀名的自动补全，你需要添加<code>resolve.extensions</code>参数来指定哪些文件是webpack需要搜索的：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> webpack.config.js</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attribute">entry</span>: <span class="string">'./main.js'</span>,</span><br><span class="line">    <span class="attribute">output</span>: &#123;</span><br><span class="line">        <span class="attribute">filename</span>: <span class="string">'bundle,js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attribute">module</span>: &#123;</span><br><span class="line">        <span class="attribute">loader</span>: [</span><br><span class="line">            &#123; <span class="attribute">test</span>: <span class="regexp">/\.coffee$/</span>, <span class="attribute">loader</span>: <span class="string">'coffee-loader'</span> &#125;,</span><br><span class="line">            &#123; <span class="attribute">test</span>: <span class="regexp">/\.js$/</span>, <span class="attribute">loader</span>: <span class="string">'bebel-loader'</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attribute">resolve</span>: &#123;</span><br><span class="line">        <span class="regexp">//</span> 你现在可以使用 `<span class="javascript"></span>`<span class="built_in">require</span>(<span class="string">'file'</span>)`<span class="javascript"></span>` 来代替 `<span class="javascript"></span>`<span class="built_in">require</span>(<span class="string">'file.coffee'</span>)`<span class="javascript"></span>` 。</span><br><span class="line">        <span class="attribute">extensions</span>: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.coffee'</span>, <span class="string">'.jsx'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="5-样式和图片">5.样式和图片</h2><p>首先你需要更新你的代码去请求 <code>require()</code> 你的静态资源（命名和他们在node里面使用 <code>require()</code> 一样）。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./bootstrap.css'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./myapp.less'</span>);</span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">img.src = <span class="built_in">require</span>(<span class="string">'./glyph.png'</span>);</span><br></pre></td></tr></table></figure></p>
<p>当你请求CSS（或者less或者其他）的时候，webpack会把CSS像字符串一样内联到JS包里面，require（）会在页面插入一个style标签。<br>当你请求图片时，webpack会内联一个图片的URL链接到你的代码包然后通过<code>require()</code>返回。<br>但是你需要去教webpack去做这件事（再次重复，用loaders）：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">module.exports = &#123;</span><br><span class="line"><span class="label">  entry:</span> <span class="string">'./main.js'</span>,</span><br><span class="line"><span class="label">  output:</span> &#123;</span><br><span class="line"><span class="label">    path:</span> <span class="string">'./build'</span>, <span class="comment">// 图片和js会被打包到这个目录</span></span><br><span class="line"><span class="label">    publicPath:</span> <span class="string">'http://mycdn.com/'</span>, <span class="comment">// 这个是用来生成图片地址的URL</span></span><br><span class="line"><span class="label">    filename:</span> <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line"><span class="label">  module:</span> &#123;</span><br><span class="line"><span class="label">    loaders:</span> [</span><br><span class="line">      &#123; <span class="string">test:</span> <span class="regexp">/\.less$/</span>, <span class="string">loader:</span> <span class="string">'style-loader!css-loader!less-loader'</span> &#125;, <span class="comment">// 使用 ! 来链接多个loader</span></span><br><span class="line">      &#123; <span class="string">test:</span> <span class="regexp">/\.css$/</span>, <span class="string">loader:</span> <span class="string">'style-loader!css-loader'</span> &#125;,</span><br><span class="line">      &#123;<span class="string">test:</span> <span class="regexp">/\.(png|jpg)$/</span>, <span class="string">loader:</span> <span class="string">'url-loader?limit=8192'</span>&#125; <span class="comment">// 内联小于8k的base64图片，其他的直接使用URL</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="6-功能标志">6.功能标志</h2><p>有些代码可能我们只想要在生产环境下运行（比如日志logging）和我们内部的测试调试服务器（就像我们的测试人员在测试应用），可以在你的代码引入全局环境变量。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(__DEV__) &#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(<span class="string">'Extra logging'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">if</span>(__PRERELEASE__) &#123;</span><br><span class="line">    showSecretFeature();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这会教webpack这些奇特的全局环境：<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// definePlugin 接收字符串插入到代码当中, 所以你需要的话可以写上 JS 的字符串.</span></span><br><span class="line"><span class="keyword">var</span> definePlugin = <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">  __DEV__: <span class="built_in">JSON</span>.stringify(<span class="built_in">JSON</span>.parse(process.env.BUILD_DEV || <span class="string">'true'</span>)),</span><br><span class="line">  __PRERELEASE__: <span class="built_in">JSON</span>.stringify(<span class="built_in">JSON</span>.parse(process.env.BUILD_PRERELEASE || <span class="string">'false'</span>))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports = </span>&#123;</span><br><span class="line">  entry: <span class="string">'./main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>       </span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [definePlugin]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>你可以在控制台里执行 <code>BUILD_DEV=1 BUILD_PRERELEASE=1 webpack</code> .<br>注意：<code>webpack -p</code>会丑化并且剔除死代码，然和包含在里面的代码都会被剔除掉，这样你就不用担心泄露秘密咯~</p>
<h2 id="7-多重入口">7.多重入口</h2><p>比如说你有一个profile和一个feed页面，你不想让用户在只想要profile页面的时候下载feed页面的代码，所以你可以创建多个包，每个页面都有一个”main module”。<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports = </span>&#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    Profile: <span class="string">'./profile.js'</span>,</span><br><span class="line">    Feed: <span class="string">'./feed.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: <span class="string">'build'</span>,</span><br><span class="line">    filename: <span class="string">'[name].js'</span> <span class="comment">// 模板基于上面入口文件的key</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>在profile页面，插入 <code>&lt;script src=&quot;build/Profile.js&quot;&gt;&lt;/script&gt;</code> .feed页面也会这样。</p>
<h2 id="8-优化通用代码">8.优化通用代码</h2><p>feed和profile页面共享许多通用的代码（比如React和公用样式和组件）。<br>webpack可以计算出哪些代码是它们公用的然后生成一个共享的包然后在页面之间被缓存。<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> commonsPlugin =</span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports = </span>&#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    Profile: <span class="string">'./profile.js'</span>,</span><br><span class="line">    Feed: <span class="string">'./feed.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: <span class="string">'build'</span>,</span><br><span class="line">    filename: <span class="string">'[name].js'</span> <span class="comment">// Template based on keys in entry above</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [commonsPlugin]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>在script标签添加之前添加 <code>&lt;script src=&quot;build/common.js&quot;&gt;&lt;/script&gt;</code> 就可以使用缓存啦~</p>
<h2 id="9-异步加载">9.异步加载</h2><p>CommonJs是同步加载的，但是webpack提供了一个方法可以异步加载指定的依赖项。<br>这对于客户端的路由是很有用的，每一个页面都需要路由，但是在某个功能被用到之前你不会想去下载这部分代码的。<br>在你想要异步加载的地方指定分离点，比如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.location.pathname === <span class="string">'/feed'</span>) &#123;</span><br><span class="line">  showLoadingState();</span><br><span class="line">  <span class="built_in">require</span>.ensure([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 这个语法很怪异但是他能执行</span></span><br><span class="line">    hideLoadingState();</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./feed'</span>).show(); <span class="comment">// 当这个函数被调用的时候, 这个模块时可以同步的。</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.location.pathname === <span class="string">'/profile'</span>) &#123;</span><br><span class="line">  showLoadingState();</span><br><span class="line">  <span class="built_in">require</span>.ensure([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hideLoadingState();</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./profile'</span>).show();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>webpack会做剩下的事情并且生成额外的包然后给你加载。<br>webpack在html的script标签加载时会假设这些文件是在你的根目录下的，比如，你可以使用 <code>output.publicPath来配置他</code><br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="tag">output</span>: &#123;</span><br><span class="line">    <span class="attribute">path</span>: <span class="string">"/home/proj/public/assets"</span>, <span class="comment">//path指向你编译时的文件目录</span></span><br><span class="line">    <span class="attribute">publicPath</span>: <span class="string">"/assets/"</span> <span class="comment">//publicPath指向你引用文件是考虑的地址</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="其他资源">其他资源</h1><p>可以看一看一个成功的团队如何在真实项目中使用webpack：<a href="http://youtu.be/VkTCL6Nqm6Y" target="_blank" rel="external">http://youtu.be/VkTCL6Nqm6Y</a><br>这是Pete Hunt 在OSCon大会上说的关于webpack在Instagram.com中的使用。</p>
<h1 id="FAQ">FAQ</h1><p><strong>webpack不像模块化？</strong><br>webpack非常的模块化。他能让插件自身集成到编译过程中的许多地方相比于browserify和requireJs.<br>许多看起来是在被编写在核心代码中的功能实际上是被默认加载的插件，他们可以被覆盖。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="如何使用webpack">如何使用webpack</h1><p>本文章翻译自petehunt的webpack-howto教程，<a href="https://github.com/petehunt/webpack-howto" target="_blank" r]]>
    </summary>
    
      <category term="webpack" scheme="http://qiutc.me/tags/webpack/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="教程" scheme="http://qiutc.me/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="翻译" scheme="http://qiutc.me/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="webpack" scheme="http://qiutc.me/categories/webpack/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CSS 伪类before/after content内容生成技术----纯CSS实现tooltip]]></title>
    <link href="http://qiutc.me/post/CSS-%E4%BC%AA%E7%B1%BBbefore-after-content%E5%86%85%E5%AE%B9%E7%94%9F%E6%88%90%E6%8A%80%E6%9C%AF-%E7%BA%AFCSS%E5%AE%9E%E7%8E%B0tooltip.html"/>
    <id>http://qiutc.me/post/CSS-伪类before-after-content内容生成技术-纯CSS实现tooltip.html</id>
    <published>2015-10-17T07:30:41.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<h1 id="一、介绍before/after">一、介绍before/after</h1><p>CSS中的before和after伪类选择器早在CSS2时就被引入，改属性被所有主流浏览器所支持了。<br>before和after顾名思义，分别指的是伪元素在元素前/后添加内容，默认他们是display是inline，但是可以使用CSS设置为block。<br>应用before/和after也比较简单，举个例子：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">a</span><span class="pseudo">:after</span> <span class="rules">&#123;</span><br><span class="line">      <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">" after "</span></span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">display</span>:<span class="value">  block</span></span>;</span><br><span class="line">      <span class="rule"><span class="attribute">coloe</span>:<span class="value"> red</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>可以在浏览器看到，a标签元素后面多出了一段文字 after。（在CSS3中伪类元素使用是如a::after的，不过目前两者并无多大区别）。<br>（伪元素不可通过DOM使用，IE6/7对该属性不支持）</p>
<p>after和before伪元素有许多用处，还可以简化代码，比如可以写一个计数器、tip小三角形、清除浮动……特别在CSS3中新加的一些属性更是丰富了它的应用，这里有个小教程，用before/after伪元素来实现一个纯CSS3的tooltip。</p>
<h1 id="二、tooltip实现教程">二、tooltip实现教程</h1><p>这里我们主要是用草after/before伪元素content中的attr属性，先来看看实现后的样子：</p>
<h2 id="1-实现样式">1.实现样式</h2><p><img src="/img/after&amp;before-demo.png" alt="DEMO"></p>
<h2 id="2-代码">2.代码</h2><p>鼠标hover button之后，出现一个tooltip小标签。<br>代码先贴上：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>demo<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="class">.btn</span> <span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">200px</span> auto</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">200px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">10px</span> <span class="number">20px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">20px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#6bdf4e</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">1px</span> solid <span class="hexcolor">#6bdf4e</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">cursor</span>:<span class="value"> pointer</span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">        <span class="class">.btn</span><span class="pseudo">::after</span> <span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="function">attr</span>(data-tip)</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">display</span>:<span class="value"> none</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">5px</span> <span class="number">10px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">50%</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">bottom</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">margin-bottom</span>:<span class="value"> <span class="number">12px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">transform</span>:<span class="value"> <span class="function">translateX</span>(-<span class="number">50%</span>)</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">16px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#000</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">cursor</span>:<span class="value"> default</span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">        <span class="class">.btn</span><span class="pseudo">::before</span> <span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">" "</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">display</span>:<span class="value"> none</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">50%</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">bottom</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">transform</span>:<span class="value"> <span class="function">translateX</span>(-<span class="number">50%</span>)</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">margin-bottom</span>:<span class="value"> <span class="number">3px</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">border-left</span>:<span class="value"> <span class="number">6px</span> solid transparent</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">border-right</span>:<span class="value"> <span class="number">6px</span> solid transparent</span></span>;</span><br><span class="line">            <span class="rule"><span class="attribute">border-top</span>:<span class="value"> <span class="number">9px</span> solid <span class="hexcolor">#000</span></span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">        <span class="class">.btn</span><span class="pseudo">:hover</span><span class="pseudo">::after</span>,</span><br><span class="line">        <span class="class">.btn</span><span class="pseudo">:hover</span><span class="pseudo">::before</span> <span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">class</span>=<span class="value">"btn"</span> <span class="attribute">data-tip</span>=<span class="value">"ToolTip"</span>&gt;</span>button<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-实现过程">3.实现过程</h2><ul>
<li>一. 创建一个标签，然后在标签内加上一个属性 data-[] = “ToolTip”,[]表示的是自定义的属性名称，引号里面是tooltip需要显示的内容。</li>
<li>二. 给标签加样式，position设置为relative，因为之后伪元素需要设置绝对定位来设置位置。</li>
<li>三. 给after加样式，after是需要显示的tooltip，通过content: attr(data-tip);拿到需要显示的内容，设置绝对定位，调整位置。</li>
<li>四. 给before加样式，before需要设置成一个小三角tip放在after下面。</li>
<li>五. 给after/before的display都设置为none。</li>
<li>六. 给需要tooltip的元素伪类选择hover时设置after/before的display为block，这里需要注意的是after/before默认display为inline，所以我们前面创建调试是display应该先设置为block。</li>
<li>七. 打开浏览器查看效果~</li>
</ul>
<h1 id="三、对于不支持伪元素的IE6/7">三、对于不支持伪元素的IE6/7</h1><p>解决方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $beforeAfter = <span class="function"><span class="keyword">function</span>(<span class="params">dom</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.querySelector || !dom &amp;&amp; dom.nodeType !== <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">var</span> content = dom.getAttribute(<span class="string">"data-content"</span>) || <span class="string">''</span>;     </span><br><span class="line">    <span class="keyword">var</span> before = <span class="built_in">document</span>.createElement(<span class="string">"before"</span>)</span><br><span class="line">        , after = <span class="built_in">document</span>.createElement(<span class="string">"after"</span>);</span><br><span class="line">    before.innerHTML = content;</span><br><span class="line">    after.innerHTML = content;</span><br><span class="line">    dom.insertBefore(before, dom.firstChild);</span><br><span class="line">    dom.appendChild(after);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h1 id="四、tip">四、tip</h1><p>关于after/before还有许多有趣有用的用法，感兴趣的同学可以研究研究哦~</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="一、介绍before/after">一、介绍before/after</h1><p>CSS中的before和after伪类选择器早在CSS2时就被引入，改属性被所有主流浏览器所支持了。<br>before和after顾名思义，分别指的是伪元素在元素前/后添加内容，]]>
    </summary>
    
      <category term="CSS" scheme="http://qiutc.me/tags/CSS/"/>
    
      <category term="前端" scheme="http://qiutc.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="教程" scheme="http://qiutc.me/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="CSS" scheme="http://qiutc.me/categories/CSS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[AARRR运营模型]]></title>
    <link href="http://qiutc.me/post/AARRR%E8%BF%90%E8%90%A5%E6%A8%A1%E5%9E%8B.html"/>
    <id>http://qiutc.me/post/AARRR运营模型.html</id>
    <published>2015-10-14T03:28:09.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<h1 id="前提：">前提：</h1><p>目前许多产品认为只要推广了1，获取大量用户流量，只看重下载量和激活量，以此来衡量一个产品，出现了“重推广，轻运营”的情况。然而何为留存率，是用户下载了APP并且打开甚至注册了吗？不，下载了不一定会继续使用留存，何时留存？当产品满足甚至超出用户期望，产品核心定位人群瞄准该用户，用户有再次打开使用时才是留存率。<br><br><br>AARRR运营模型更加的符合当前移动APP的运营模式。何为AARRR，下面一张图给出大概的结构：<br><img src="/img/aarrr.png" alt="AARRR"></p>
<hr>
<h1 id="何为AARRR模型？">何为AARRR模型？</h1><p>简单来讲，AARRR模型分为  Acquisition（推广）、activation（提高活跃度）、retention（提高留存）、revenue（获取收入）、refer（自传播）。</p>
<h2 id="1-_推广（Acquisition）">1. 推广（Acquisition）</h2><p>这是一款产品推出的第一步，把产品推广出去，获取用户量，没有用户用何运营。目前一款APP推广主要有这些渠道：各大应用商店、论坛帖吧、RP、刷机预装、线下推广扫码等、……<br>在这个阶段，最初大家关心的数据是下载量，然而下载了不一定安装，安装了不一定激活，激活了不一定留存。在推广的时候应该分渠道分析数据，一款产品不会符合所有人的需求和兴趣的，只有分析产品本身和数据，找到合适的目标人群，有针对性的推广，才能获取到高质量的用户。从另一方面来说，获取用户也是需要成本的，之后会在第四个环节revenue来说明，应该做的是找准产品的目标人群，选择最合适的推广渠道，获取高质量用户，个人观点认同“流量经济已过、之后的趋势是粉丝经济”。</p>
<h2 id="2-提高活跃度（Activation）">2.提高活跃度（Activation）</h2><p>在第一步的时候获取用户的渠道许许多多，许多用户并不是主动获取的，针对自己的产品选择适合的推广渠道前面已经说明过了。<br>衡量活跃度我们可能马上想到的就是 DAU（日活跃用户）、MAU（月活跃用户）。这两个也是运营人员必看的指标，注意的是还是需要根据自身产品来选择合适的用户指标。<br>对一个产品来说，往往用户第一次使用的前几十秒觉得了用户是否感兴趣。<br>提高活跃度主要有一下方法：</p>
<ul>
<li>（1）产品本身设计时需要考虑：通过签到、每日任务、每日推送等等方法来诱导用户周期性使用，当然产品本身也是需要做好，用户才会有兴趣。</li>
<li>（2）有规律的版本更新：每一次有效的版本更新都会刺激活跃用户。</li>
<li>（3）Notification :使用Notification 也需要小心，选择合适的内容、选择合适的频率、选择合适的时段。</li>
</ul>
<h2 id="3-提高留存（retention）">3.提高留存（retention）</h2><p> 一款应用的生命周期如下：渠道–点击–下载–安装–激活–留存–卸载<br> 如何提高生命周期、提高用户使用价值主要靠提高留存。<br> 保留一个老用户的成本远远要低于获取一个新用户的成本，获取用户之后需要做的是分析用户数据，提高留存率。有些产品不分析用户为何流失，另一方面却又一直不断开拓新用户，造成了用户大量流失，运营成本大大增加的情况。</p>
<h2 id="4-获取收入（revenue）">4.获取收入（revenue）</h2><p>收入是应用运营最核心的一点，产品的收入方式主要：付费应用、应用内付费、广告、渠道手续费获利….。付费应用在国内不大现实，毕竟没有这样的用户习惯，应用内付费大多出现在游戏应用，主要要做的是设计产品的时候就应该设计好盈利模式，运营时把用户最大化转化为价值。收入还和CAC（用户获取成本）大大关联，利润=收入-成本，成本来说除掉开发成本等等其实主要大头就是CAC了，如何平衡CAC和用户实际带来的成本需要最大化用户的价值。</p>
<h2 id="5-自传播（refer）">5.自传播（refer）</h2><p> 随着移动社交网络的兴起，自传播成为运营的一大方面，基于移动社交网络的病毒式营销，用户自驱动的传播推广产品，二次获取用户，把AARRR的金字塔陀螺式的上升增长，把运营提高到更高的一个层次。利用用户邀请新用户，用户在自己的社交圈内推广产品，二次获取新用户。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="前提：">前提：</h1><p>目前许多产品认为只要推广了1，获取大量用户流量，只看重下载量和激活量，以此来衡量一个产品，出现了“重推广，轻运营”的情况。然而何为留存率，是用户下载了APP并且打开甚至注册了吗？不，下载了不一定会继续使用留存，何时留存？当产品满足甚]]>
    </summary>
    
      <category term="产品" scheme="http://qiutc.me/tags/%E4%BA%A7%E5%93%81/"/>
    
      <category term="运营" scheme="http://qiutc.me/tags/%E8%BF%90%E8%90%A5/"/>
    
      <category term="产品" scheme="http://qiutc.me/categories/%E4%BA%A7%E5%93%81/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用hexo+github搭建静态博客]]></title>
    <link href="http://qiutc.me/post/%E4%BD%BF%E7%94%A8hexo-github%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2.html"/>
    <id>http://qiutc.me/post/使用hexo-github搭建静态博客.html</id>
    <published>2015-10-04T03:01:31.000Z</published>
    <updated>2016-03-12T01:38:01.000Z</updated>
    <content type="html"><![CDATA[<h1 id="认识hexo">认识hexo</h1><p>&#8195;&#8195;hexo是一款基于Node.js的静态博客框架，可以生成静态文件并且一键部署到github pages上，并且他可以使用markdown来编写文章，十分简单。</p>
<p>他有许多优点：</p>
<ul>
<li>快速：hexo基于Node.js，支持多进程，几百篇文章可以秒生成。</li>
<li>写文章流程：支持GitHub Flavored Markdown和所有Octopress的插件。</li>
<li>扩展性：Hexo支持EJS、Swig和Stylus。通过插件支持Haml、Jade和Less。</li>
</ul>
<p><em>这是一篇用hexo在github上面搭建博客的教程</em></p>
<hr>
<h1 id="安装：">安装：</h1><h2 id="系统环境：">系统环境：</h2><ul>
<li>系统： win10 64bit</li>
<li>编译器：<a href="http://www.sublimetext.com/" target="_blank" rel="external">sublime text 3</a>（可以看这篇文章）</li>
<li>编码： 把文本编码确定成 UTF-8</li>
</ul>
<h2 id="Git">Git</h2><ol>
<li>可以选择安装GitHub for Windows 或者 git 。</li>
<li>注册github，选择Repositories，然后new新建一个仓库，建好仓库之后选择settings，到GitHub Pages那一栏，选择Launch automatic page generator，接下去就是确定。</li>
<li>然后就是把仓库clone下来，关于怎么clone和使用git可以参考这篇文字。</li>
</ol>
<h2 id="nodejs">nodejs</h2><p>下载安装<a href="https://nodejs.org/" target="_blank" rel="external">nodejs</a>，nodejs安装后会自动带有npm包，如果嫌外网下npm下载包文件比较慢，可以使用淘宝的<a href="http://npm.taobao.org/" target="_blank" rel="external">cnpm</a>镜像。<br>nodejs安装好之后可以打开命令行（win+r，输入cmd，确定），<br>输入 node -v 查看nodejs版本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">$ v0.<span class="number">12.7</span> <span class="comment">##版本号</span></span><br></pre></td></tr></table></figure></p>
<p>输入 npm -v 查看npm版本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm -v</span><br><span class="line">$ v2.<span class="number">11.3</span> <span class="comment">##版本号</span></span><br></pre></td></tr></table></figure></p>
<p>到这里说明nodejs安装成功了。</p>
<h2 id="hexo">hexo</h2><p>打开命令行，我这里安装的是3.x版本（后面可能会有个小坑）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-cli -g <span class="operator">-d</span></span><br></pre></td></tr></table></figure></p>
<p>查看hexo的版本号：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo -v</span><br></pre></td></tr></table></figure></p>
<p>进入到我们clone的那个文件夹，执行命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init</span><br></pre></td></tr></table></figure></p>
<p>接着安装依赖包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br></pre></td></tr></table></figure></p>
<p>接着可以启动服务测试一下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br></pre></td></tr></table></figure></p>
<p>用浏览器打开<code>http://localhost:4000/</code>或者<code>http://127.0.0.1:4000/</code>就可以看到页面了。</p>
<hr>
<h1 id="Hexo的使用">Hexo的使用</h1><h2 id="目录和文件">目录和文件</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── .deploy       <span class="preprocessor">#需要部署的文件</span></span><br><span class="line">├── node_modules  <span class="preprocessor">#Hexo插件</span></span><br><span class="line">├── <span class="keyword">public</span>        <span class="preprocessor">#生成的静态网页文件</span></span><br><span class="line">├── scaffolds     <span class="preprocessor">#模板</span></span><br><span class="line">├── source        <span class="preprocessor">#博客正文和其他源文件, <span class="number">404</span> 、favicon 、CNAME</span></span><br><span class="line">|   ├── _drafts   <span class="preprocessor">#草稿</span></span><br><span class="line">|   └── _posts    <span class="preprocessor">#文章</span></span><br><span class="line">├── themes        <span class="preprocessor">#主题</span></span><br><span class="line">├── _config.yml   <span class="preprocessor">#全局配置文件</span></span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>
<p>（有些文件是在部署时才会产生的）</p>
<h2 id="全局站点配置文件_config-yml">全局站点配置文件_config.yml</h2><p>（yml语法严格，注意冒号后面必须加空格）<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># Site #站点信息</span></span><br><span class="line"><span class="label">title:</span> Hexo <span class="preprocessor">#博客标题</span></span><br><span class="line"><span class="label">subtitle:</span> 啦啦啦 <span class="preprocessor">#副标题</span></span><br><span class="line"><span class="label">description:</span> 哈哈哈 <span class="preprocessor">#描述</span></span><br><span class="line"><span class="label">author:</span> John Doe <span class="preprocessor">#作者</span></span><br><span class="line"><span class="label">language:</span> <span class="built_in">zh</span>-Hans <span class="preprocessor">#语言</span></span><br><span class="line"><span class="label">timezone:</span> Asia/Shanghai <span class="preprocessor">#时区</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># URL #链接格式</span></span><br><span class="line"><span class="label">url:</span> http://yoursite.com <span class="preprocessor">#博客网址</span></span><br><span class="line"><span class="label">root:</span> / <span class="preprocessor">#根目录</span></span><br><span class="line"><span class="label">permalink:</span> :year/:month/:day/:title/ <span class="preprocessor">#文章的链接格式</span></span><br><span class="line"><span class="label">permalink_defaults:</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Directory #目录</span></span><br><span class="line"><span class="label">source_dir:</span> source <span class="preprocessor">#源文件</span></span><br><span class="line"><span class="label">public_dir:</span> public <span class="preprocessor">#生成的文件</span></span><br><span class="line"><span class="label">tag_dir:</span> tags <span class="preprocessor">#标签文件夹</span></span><br><span class="line"><span class="label">archive_dir:</span> archives <span class="preprocessor">#归档文件夹</span></span><br><span class="line"><span class="label">category_dir:</span> categories <span class="preprocessor">#分类文件夹</span></span><br><span class="line"><span class="label">code_dir:</span> downloads/code <span class="preprocessor">#下载文件</span></span><br><span class="line"><span class="label">i18n_dir:</span> :lang <span class="preprocessor">#国际化</span></span><br><span class="line"><span class="label">skip_render:</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Writing #写作</span></span><br><span class="line"><span class="label">new_post_name:</span> :title.md <span class="preprocessor">#文章标题</span></span><br><span class="line"><span class="label">default_layout:</span> post <span class="preprocessor">#模板</span></span><br><span class="line"><span class="label">titlecase:</span> false <span class="preprocessor">#标题是否换成小写</span></span><br><span class="line"><span class="label">external_link:</span> true <span class="preprocessor">#是否在新页面打开链接</span></span><br><span class="line"><span class="label">filename_case:</span> <span class="number">0</span></span><br><span class="line"><span class="label">render_drafts:</span> false</span><br><span class="line"><span class="label">post_asset_folder:</span> false</span><br><span class="line"><span class="label">relative_link:</span> false</span><br><span class="line"><span class="label">future:</span> true</span><br><span class="line"><span class="label">highlight:</span></span><br><span class="line">  enable: true</span><br><span class="line">  line_number: true</span><br><span class="line">  auto_detect: true</span><br><span class="line">  tab_replace:</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Category &amp; Tag #分类和标签</span></span><br><span class="line"><span class="label">default_category:</span> uncategorized</span><br><span class="line"><span class="label">category_map:</span></span><br><span class="line"><span class="label">tag_map:</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Date #时间日期格式</span></span><br><span class="line"><span class="label">date_format:</span> YYYY-MM-DD</span><br><span class="line"><span class="label">time_format:</span> HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Pagination #分页</span></span><br><span class="line"><span class="label">per_page:</span> <span class="number">10</span> <span class="preprocessor">#每页文章数</span></span><br><span class="line"><span class="label">pagination_dir:</span> page</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Extensions #插件和主题</span></span><br><span class="line"><span class="preprocessor">## Plugins: http://hexo.io/plugins/</span></span><br><span class="line"><span class="preprocessor">## Themes: http://hexo.io/themes/</span></span><br><span class="line"><span class="label">theme:</span> landscape</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Deployment #部署配置</span></span><br><span class="line"><span class="preprocessor">## Docs: http://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="label">deploy:</span></span><br><span class="line">  type:</span><br></pre></td></tr></table></figure></p>
<h2 id="站点的_config-yml_配置">站点的_config.yml 配置</h2><h3 id="站点建立时间">站点建立时间</h3><p>例如 <code>© 2015 - 2016</code><br>在文件添加：<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">since</span>: <span class="string">2015</span></span><br></pre></td></tr></table></figure></p>
<h3 id="头像设置">头像设置</h3><p>/images/avatar.jpg //头像图片放置在主题的 source/images/<br>在文件添加：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">avatar:</span> <span class="regexp">/images/</span>avatar.png</span><br></pre></td></tr></table></figure></p>
<h3 id="侧边栏社交链接">侧边栏社交链接</h3><p>增加 social<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># Social links</span></span><br><span class="line">social:</span><br><span class="line">  GitHub: https:<span class="comment">//github.com/tongchengqiu</span></span><br><span class="line">  Twitter: https:<span class="comment">//twitter.com/tongchengqiu</span></span><br><span class="line">  Zhihu: http:<span class="comment">//www.zhihu.com/people/tongchengqiu</span></span><br></pre></td></tr></table></figure></p>
<h2 id="友情链接">友情链接</h2><h3 id="标题">标题</h3><p>links_title: 友情链接</p>
<h3 id="链接">链接</h3><p>links:<br>  Hexo: <a href="http://hexo.io/" target="_blank" rel="external">http://hexo.io/</a><br>  Lmintlcx: <a href="http://blog.lmintlcx.com/" target="_blank" rel="external">http://blog.lmintlcx.com/</a></p>
<h2 id="命令的使用">命令的使用</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hexo help <span class="preprocessor">#查看帮助</span></span><br><span class="line">hexo init <span class="preprocessor">#初始化目录</span></span><br><span class="line">hexo <span class="keyword">new</span> <span class="string">"postName"</span> <span class="preprocessor">#新建文章</span></span><br><span class="line">hexo <span class="keyword">new</span> page <span class="string">"pageName"</span> <span class="preprocessor">#新建页面</span></span><br><span class="line">hexo generate <span class="preprocessor">#生成网页, 可以在public目录查看整个网站的文件</span></span><br><span class="line">hexo <span class="keyword">server</span> <span class="preprocessor">#本地预览,'Ctrl+C'关闭</span></span><br><span class="line">hexo deploy <span class="preprocessor">#部署.deploy目录</span></span><br><span class="line">hexo clean <span class="preprocessor">#清除缓存, 建议每次执行命令前先清理缓存</span></span><br><span class="line">hexo n == hexo <span class="keyword">new</span></span><br><span class="line">hexo g == hexo generate</span><br><span class="line">hexo s == hexo <span class="keyword">server</span></span><br><span class="line">hexo d == hexo deploy</span><br></pre></td></tr></table></figure>
<h2 id="写文章">写文章</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> <span class="string">"文章标题"</span></span><br></pre></td></tr></table></figure>
<p>然后到_post 目录下打开 文章标题.md<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">title: 文章标题</span><br><span class="line">date: <span class="number">2015</span>-<span class="number">10</span>-<span class="number">3</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span></span><br><span class="line">tags:</span><br><span class="line">- 标签<span class="number">1</span></span><br><span class="line">- 标签<span class="number">2</span></span><br><span class="line">- 标签<span class="number">3</span></span><br><span class="line">categories: [分类<span class="number">1</span>,分类<span class="number">2</span>,分类<span class="number">3</span>]</span><br><span class="line">---</span><br><span class="line">正文, 使用 Markdown 语法书写</span><br></pre></td></tr></table></figure></p>
<p>编辑后可以先预览<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">hexo</span> clean</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure></p>
<p>然后打开浏览器预览</p>
<h2 id="部署上传更新">部署上传更新</h2><p>以github为例，打开站点根目录下的_config.yml文件，找到deploy部分，更改配置<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">deploy</span>:</span><br><span class="line">  <span class="attribute">type</span>: git</span><br><span class="line">  <span class="attribute">repository</span>: git<span class="variable">@github</span>.<span class="attribute">com</span>:test/test.git #在仓库找到该仓库的ssh</span><br><span class="line">  <span class="attribute">branch</span>: github-pages #分支，这里为github-pages</span><br></pre></td></tr></table></figure></p>
<p>然后就可以部署了，在文件根目录执行命令行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure></p>
<p>这里有可能会报个错误<code>ERROR Deployer not found : git</code><br>这里需要安装一个包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p>
<p>然后就可以继续执行<code>deploy</code>了，第一次部署可能会有点慢，可以耐心等候哦。<br>成功之后可以继续打开仓库的settings，在GitHub Pages会看到 Your site is published at <a href="http://qiutongcheng.com.（如果还没有绑定域名就会是github给你分配的url哦）" target="_blank" rel="external">http://qiutongcheng.com.（如果还没有绑定域名就会是github给你分配的url哦）</a><br>就可以打开链接看看咯~</p>
<hr>
<h1 id="绑定域名">绑定域名</h1><p>当然我们的个人博客当然希望绑定自己的一个个性域名咯~</p>
<h2 id="注册购买顶级域名">注册购买顶级域名</h2><p>国内购买可以上<a href="http://wanwang.aliyun.com/" target="_blank" rel="external">万网</a>；<br>嫌国内不好可以用<a href="https://www.godaddy.com/" target="_blank" rel="external">godaddy</a>。</p>
<h2 id="DNS设置">DNS设置</h2><p>在购买域名的后台管理设置DNS<br>主机记录@, 类型A, 记录值192.30.252.153<br>主机记录www, 类型A, 记录值192.30.252.153</p>
<h2 id="在github绑定域名">在github绑定域名</h2><p>在source文件夹下面新建 CNAME（不要后缀），内容输入要绑定的域名，比如<br><code>qiutongcheng.com</code>或者<code>www.qiutongcheng.com</code>。</p>
<h2 id="绑定子域名">绑定子域名</h2><p>比如要绑定 <code>blog.qiutongcheng.com</code> ：<br>吧CNAME内容改成 <code>blog.qiutongcheng.com</code><br>DNS设置里面添加 主机记录有blog，类型 CNAME ，记录值 <code>blog.qiutongcheng.com</code></p>
<hr>
<h1 id="主题">主题</h1><p>hexo的<a href="https://github.com/hexojs/hexo/wiki/Themes" target="_blank" rel="external">(主题列表)</a><br>我使用的是 NexT 主题，这里一NexT主题为例剖析一下吧。</p>
<h2 id="下载与使用">下载与使用</h2><p>执行命令行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/iissnan/hexo-theme-next themes/next <span class="comment">#主题的地址</span></span><br></pre></td></tr></table></figure></p>
<p>也可以下载zip文件，然后手动解压到themes目录下<br>配置全局站点文件<code>_config.yml</code><br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">themes: <span class="keyword">next</span> <span class="preprocessor">#主题文件夹名</span></span><br></pre></td></tr></table></figure></p>
<h2 id="主题的目录结构">主题的目录结构</h2><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── languages          <span class="preprocessor">#国际化</span></span><br><span class="line">|   ├── <span class="keyword">default</span>.yml    <span class="preprocessor">#默认</span></span><br><span class="line">|   └── zh-CN.yml      <span class="preprocessor">#中文</span></span><br><span class="line">├── <span class="keyword">layout</span>             <span class="preprocessor">#布局</span></span><br><span class="line">|   ├── _partial       <span class="preprocessor">#局部的布局</span></span><br><span class="line">|   └── _widget        <span class="preprocessor">#小挂件的布局</span></span><br><span class="line">├── script             <span class="preprocessor">#js脚本</span></span><br><span class="line">├── source             <span class="preprocessor">#源代码文件</span></span><br><span class="line">|   ├── css            <span class="preprocessor">#CSS</span></span><br><span class="line">|   |   ├── _base      <span class="preprocessor">#基础CSS</span></span><br><span class="line">|   |   ├── _partial   <span class="preprocessor">#局部CSS</span></span><br><span class="line">|   |   ├── fonts      <span class="preprocessor">#字体</span></span><br><span class="line">|   |   ├── images     <span class="preprocessor">#图片</span></span><br><span class="line">|   |   └── style.styl <span class="preprocessor">#style.css</span></span><br><span class="line">|   ├── fancybox       <span class="preprocessor">#fancybox</span></span><br><span class="line">|   └── js             <span class="preprocessor">#js</span></span><br><span class="line">├── _config.yml        <span class="preprocessor">#主题配置文件</span></span><br><span class="line">└── README.md          <span class="preprocessor">#主题介绍</span></span><br></pre></td></tr></table></figure>
<h2 id="主题配置文件_config-yml文件">主题配置文件_config.yml文件</h2><p>打开主题目录下的_config.yml文件<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">menu: #菜单</span><br><span class="line">  home: / #首页</span><br><span class="line">  archives: /archives #归档</span><br><span class="line">  #commonweal: /<span class="number">404.</span>html #<span class="number">404</span>页面</span><br><span class="line">  #tags: /tags #标签</span><br><span class="line">  #categories: /categories #分类</span><br><span class="line">  about: /about #关于</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 小图标</span></span><br><span class="line">favicon: /favicon.ico</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 默认关键词</span></span><br><span class="line">keywords: <span class="string">"~"</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 留空使用默认的, false 禁用, 也可以写指定的地址</span></span><br><span class="line">rss:</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Icon fonts</span></span><br><span class="line"><span class="preprocessor"># default | linecons | fifty-shades | feather</span></span><br><span class="line">icon_font: <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 代码高亮主题 https://github.com/chriskempson/tomorrow-theme</span></span><br><span class="line"><span class="preprocessor"># normal | night | night eighties | night blue | night bright</span></span><br><span class="line">highlight_theme: normal</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># MathJax Support #数学公式</span></span><br><span class="line">mathjax: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Schemes #启用主题中的主题Mist</span></span><br><span class="line">scheme: Mist</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 侧边栏</span></span><br><span class="line"><span class="preprocessor">#  - post    只在文章页面显示</span></span><br><span class="line"><span class="preprocessor">#  - always  所有页面显示</span></span><br><span class="line"><span class="preprocessor">#  - hide    隐藏</span></span><br><span class="line">sidebar: always</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 自动滚动到"阅读更多"标记的下面</span></span><br><span class="line">scroll_to_more: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 自动给目录添加序号</span></span><br><span class="line">toc_list_number: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 自动截取摘要</span></span><br><span class="line">auto_excerpt:</span><br><span class="line">  enable: <span class="literal">false</span></span><br><span class="line">  length: <span class="number">150</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Lato 字体</span></span><br><span class="line">use_font_lato: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Make duoshuo show UA</span></span><br><span class="line"><span class="preprocessor"># user_id must NOT be null when admin_enable is true!</span></span><br><span class="line"><span class="preprocessor"># you can visit http://dev.duoshuo.com get duoshuo user id.</span></span><br><span class="line">duoshuo_info:</span><br><span class="line">  ua_enable: <span class="literal">true</span></span><br><span class="line">  admin_enable: <span class="literal">false</span></span><br><span class="line">  user_id: <span class="number">0</span></span><br><span class="line">  #admin_nickname: ROOT</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## DO NOT EDIT THE FOLLOWING SETTINGS</span></span><br><span class="line"><span class="preprocessor">## UNLESS YOU KNOW WHAT YOU ARE DOING</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 动画</span></span><br><span class="line">use_motion: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Fancybox 看图插件</span></span><br><span class="line">fancybox: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Static files</span></span><br><span class="line">vendors: vendors</span><br><span class="line">css: css</span><br><span class="line">js: js</span><br><span class="line">images: images</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Theme version</span></span><br><span class="line">version: <span class="number">0.4</span><span class="number">.5</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="选择Scheme">选择Scheme</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scheme</span>: <span class="string">Mist</span></span><br></pre></td></tr></table></figure>
<h3 id="添加网站图标">添加网站图标</h3><p>将网站图标文件 favicon.ico 放到source目录下面<br>修改主题_config.yml文件<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">favicon</span>: <span class="string">/favicon.ico</span></span><br></pre></td></tr></table></figure></p>
<h3 id="菜单设置">菜单设置</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">menu</span>:</span><br><span class="line">  <span class="attribute">home</span>: /</span><br><span class="line">  <span class="attribute">archives</span>: /archives</span><br><span class="line">  <span class="attribute">categories</span>: /categories</span><br><span class="line">  <span class="attribute">tags</span>: /tags</span><br><span class="line">  <span class="attribute">commonweal</span>: /<span class="number">404</span>.html</span><br><span class="line">  <span class="attribute">about</span>: /about</span><br></pre></td></tr></table></figure>
<h3 id="标签页面">标签页面</h3><p>执行命令行<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> page <span class="string">"tags"</span></span><br></pre></td></tr></table></figure></p>
<p>到生成的页面文件里<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: tags</span><br><span class="line">date: 2015-10-4 22:37:08</span><br><span class="line">type: "tags"</span><br><span class="line"><span class="header">comments: false    #关闭评论（建议）</span><br><span class="line">---</span></span><br></pre></td></tr></table></figure></p>
<h3 id="分类页面">分类页面</h3><p>执行命令行<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> page <span class="string">"categories"</span></span><br></pre></td></tr></table></figure></p>
<p>到生成的页面文件里<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: categories</span><br><span class="line">date: 2015-10-4 22:37:08</span><br><span class="line">type: "categories"</span><br><span class="line"><span class="header">comments: false    #关闭评论（建议）</span><br><span class="line">---</span></span><br></pre></td></tr></table></figure></p>
<h3 id="关于页面">关于页面</h3><p>执行命令行<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> page <span class="string">"about"</span></span><br></pre></td></tr></table></figure></p>
<p>到生成的页面文件里<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: about</span><br><span class="line">date: 2015-10-4 22:37:08</span><br><span class="line">type: "about"</span><br><span class="line"><span class="header">comments: false    #关闭评论（建议）</span><br><span class="line">---</span></span><br></pre></td></tr></table></figure></p>
<h3 id="RSS链接">RSS链接</h3><p>编辑主题的_config.yml文件<br>禁止：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">rss:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">rss:</span></span><br></pre></td></tr></table></figure></p>
<p>需要安装插件 hexo-generator-feed ，继续看下面有安装插件教程<br>自定义：<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">rss:</span> url<span class="preprocessor">#自定义的地址</span></span><br></pre></td></tr></table></figure></p>
<h3 id="侧边栏设置">侧边栏设置</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">sidebar:</span> post  <span class="preprocessor">#只在文章页面自动显示</span></span><br><span class="line"><span class="preprocessor">#sidebar: always #在所以页面自动显示</span></span><br><span class="line"><span class="preprocessor">#sidebar: hide #全隐藏</span></span><br></pre></td></tr></table></figure>
<h3 id="腾讯公益_404_页面">腾讯公益 404 页面</h3><p>source 目录下新建 404.html 页面<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"content-type"</span> <span class="attribute">content</span>=<span class="value">"text/html;charset=utf-8;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"X-UA-Compatible"</span> <span class="attribute">content</span>=<span class="value">"IE=edge,chrome=1"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"robots"</span> <span class="attribute">content</span>=<span class="value">"all"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"robots"</span> <span class="attribute">content</span>=<span class="value">"index,follow"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"http://www.qq.com/404/search_children.js"</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span> <span class="attribute">homePageUrl</span>=<span class="value">"your-site-url"</span> <span class="attribute">homePageName</span>=<span class="value">"回到我的主页"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="首页文章摘录">首页文章摘录</h3><p>在主题配置文件添加<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_excerpt:</span><br><span class="line">  enable: <span class="literal">true</span></span><br><span class="line">  length: <span class="number">150</span> <span class="preprocessor">#默认截取的长度为 <span class="number">150</span> 字符</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="扩展">扩展</h1><h2 id="评论系统">评论系统</h2><h3 id="多说评论系统">多说评论系统</h3><p>注册<a href="http://duoshuo.com/" target="_blank" rel="external">多说</a>，配置域名站点域名 xxx.duoshuo.com<br>在站点配置文件添加：<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">duoshuo_shortname</span>: <span class="string">xxx</span></span><br></pre></td></tr></table></figure></p>
<h2 id="设置网站统计">设置网站统计</h2><h3 id="百度统计">百度统计</h3><p>登陆注册<a href="http://tongji.baidu.com/web/welcome/login" target="_blank" rel="external">百度统计</a>，配置后到代码获取页面，<br>找到代码里 <code>hm?js</code> 复制后面一串字符串ID  xxx<br>在站点配置文件添加：<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">baidu_analytics</span>: <span class="string">xxxxxxxxxxxxxxxx</span></span><br></pre></td></tr></table></figure></p>
<h2 id="分享">分享</h2><h3 id="百度分享">百度分享</h3><p>在站点配置文件添加：<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 百度分享服务</span></span><br><span class="line">baidushare: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="多说分享">多说分享</h3><p>在站点配置文件添加：<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 多说分享服务</span></span><br><span class="line">duoshuo_share: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<h2 id="版权协议">版权协议</h2><p>在站点配置文件添加：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Creative Commons 4.0 International License.</span><br><span class="line"># http:<span class="comment">//creativecommons.org/</span></span><br><span class="line"># Available: <span class="keyword">by</span> | <span class="keyword">by</span>-nc | <span class="keyword">by</span>-nc-nd | <span class="keyword">by</span>-nc-<span class="keyword">sa</span> | <span class="keyword">by</span>-nd | <span class="keyword">by</span>-<span class="keyword">sa</span> | zero</span><br><span class="line">creative_commons: <span class="keyword">by</span>-nc-<span class="keyword">sa</span></span><br></pre></td></tr></table></figure></p>
<h2 id="网站访问量统计">网站访问量统计</h2><p>使用 <a href="http://service.ibruce.info/" target="_blank" rel="external">不蒜子</a> 提供的服务<br>算法a: pv的方式, 单个用户连续点击n篇文章, 记录n次访问量.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"busuanzi_container_site_pv"</span>&gt;</span></span><br><span class="line">    本站总访问量<span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"busuanzi_value_site_pv"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>次</span><br><span class="line"><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>算法b: uv的方式, 单个用户连续点击n篇文章, 只记录1次访客数.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"busuanzi_container_site_uv"</span>&gt;</span></span><br><span class="line">  本站访客数<span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"busuanzi_value_site_uv"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>人次</span><br><span class="line"><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>找到themes/next/layout/partials/footer.wsig文件<br>在最后一行前面添加<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">async</span> <span class="attribute">src</span>=<span class="value">"https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"busuanzi_container_site_pv"</span>&gt;</span></span><br><span class="line">    本站总访问量<span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"busuanzi_value_site_pv"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>次</span><br><span class="line"><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="网站运行时间">网站运行时间</h2><p>在最后一行前面添加<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> birthDay = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"11/20/2014"</span>);</span><br><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">var</span> duration = now.getTime() - birthDay.getTime();</span><br><span class="line"><span class="keyword">var</span> total= <span class="built_in">Math</span>.floor(duration / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>));</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"showDays"</span>).innerHTML = <span class="string">"本站已运行 "</span>+total+<span class="string">" 天"</span>;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">"showDays"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="认识hexo">认识hexo</h1><p>&#8195;&#8195;hexo是一款基于Node.js的静态博客框架，可以生成静态文件并且一键部署到github pages上，并且他可以使用markdown来编写文章，十分简单。</p>
<p>他有许多优点：</]]>
    </summary>
    
      <category term="blog" scheme="http://qiutc.me/tags/blog/"/>
    
      <category term="hexo" scheme="http://qiutc.me/tags/hexo/"/>
    
      <category term="nodejs" scheme="http://qiutc.me/tags/nodejs/"/>
    
      <category term="教程" scheme="http://qiutc.me/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="hexo" scheme="http://qiutc.me/categories/hexo/"/>
    
  </entry>
  
</feed>
