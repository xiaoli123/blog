<!DOCTYPE html>
<html lang="en">
<head>
  <!-- content-Type -->
<meta charset="utf-8">


<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="language" content="en">
<meta name="robots" content="all">


<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="email=no" name="format-detection">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



<meta name="author" content="theme.author, theme.email">
<meta name="reply-to" content="theme.email">
<meta name="owner" content="theme.author">




<meta name="google-site-verification" content="UA-78049587-1" />




<meta name="baidu-site-verification" content="fRBucd9VmI" />




<meta name="baidu-gxt-verify-token" content="ca8f032797b876ef3be37c3d492168a0" />




<meta name="description" content="hello word! ğŸ˜º" />




<meta name="keywords" content="JavaScript,React,redux," />


<meta name="description" content="Tipå‰ç«¯æŠ€æœ¯çœŸæ˜¯æ—¥æ–°æœˆå¼‚ï¼Œæå®Œ React ä¸æ­é…ä¸ªæ•°æ®æµéƒ½ä¸å¥½æ„æ€äº†ã€‚æ»¡æ€€æœŸå¾…çš„å¿ƒå»ç¿»äº†ç¿» fluxï¼Œç®€ç›´è¢«å®˜æ–¹é‚£æ„è¯†æµçš„æ–‡æ¡£æŠ˜æœäº†ï¼ŒçœŸæ˜¯åˆè‡­åˆé•¿è¿˜æ˜¯æˆ‘æ™ºå•†é—®é¢˜ï¼ŸğŸ˜–è½¬æˆ˜ redux ï¼Œè¶Šçœ‹è¶Šæœ‰æ„æ€ï¼Œè·Ÿç€æ–‡æ¡£åšäº†ä¸ª TodoList çš„å…¥é—¨å°ä¾‹å­ã€‚
åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆè´´ä¸Šæ–‡ç« ç”¨åˆ°ä¾‹å­çš„æºç  https://github.com/TongchengQiu/TodoList-as-redux-demo">
<meta property="og:type" content="article">
<meta property="og:title" content="redux å¤§æ³•å¥½ â€”â€” å…¥é—¨å®ä¾‹ TodoList">
<meta property="og:url" content="http://qiutc.me/post/redux-å¤§æ³•å¥½-â€”â€”-å…¥é—¨å®ä¾‹-TodoList.html">
<meta property="og:site_name" content="é˜¿åŸçš„blog">
<meta property="og:description" content="Tipå‰ç«¯æŠ€æœ¯çœŸæ˜¯æ—¥æ–°æœˆå¼‚ï¼Œæå®Œ React ä¸æ­é…ä¸ªæ•°æ®æµéƒ½ä¸å¥½æ„æ€äº†ã€‚æ»¡æ€€æœŸå¾…çš„å¿ƒå»ç¿»äº†ç¿» fluxï¼Œç®€ç›´è¢«å®˜æ–¹é‚£æ„è¯†æµçš„æ–‡æ¡£æŠ˜æœäº†ï¼ŒçœŸæ˜¯åˆè‡­åˆé•¿è¿˜æ˜¯æˆ‘æ™ºå•†é—®é¢˜ï¼ŸğŸ˜–è½¬æˆ˜ redux ï¼Œè¶Šçœ‹è¶Šæœ‰æ„æ€ï¼Œè·Ÿç€æ–‡æ¡£åšäº†ä¸ª TodoList çš„å…¥é—¨å°ä¾‹å­ã€‚
åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆè´´ä¸Šæ–‡ç« ç”¨åˆ°ä¾‹å­çš„æºç  https://github.com/TongchengQiu/TodoList-as-redux-demo">
<meta property="og:image" content="http://qiutc.me/img/redux.jpeg">
<meta property="og:updated_time" content="2016-05-10T03:53:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redux å¤§æ³•å¥½ â€”â€” å…¥é—¨å®ä¾‹ TodoList">
<meta name="twitter:description" content="Tipå‰ç«¯æŠ€æœ¯çœŸæ˜¯æ—¥æ–°æœˆå¼‚ï¼Œæå®Œ React ä¸æ­é…ä¸ªæ•°æ®æµéƒ½ä¸å¥½æ„æ€äº†ã€‚æ»¡æ€€æœŸå¾…çš„å¿ƒå»ç¿»äº†ç¿» fluxï¼Œç®€ç›´è¢«å®˜æ–¹é‚£æ„è¯†æµçš„æ–‡æ¡£æŠ˜æœäº†ï¼ŒçœŸæ˜¯åˆè‡­åˆé•¿è¿˜æ˜¯æˆ‘æ™ºå•†é—®é¢˜ï¼ŸğŸ˜–è½¬æˆ˜ redux ï¼Œè¶Šçœ‹è¶Šæœ‰æ„æ€ï¼Œè·Ÿç€æ–‡æ¡£åšäº†ä¸ª TodoList çš„å…¥é—¨å°ä¾‹å­ã€‚
åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆè´´ä¸Šæ–‡ç« ç”¨åˆ°ä¾‹å­çš„æºç  https://github.com/TongchengQiu/TodoList-as-redux-demo">






  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.0.1" />






<link href="http://cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.0.1"/>


<script>
(function(){
  var bp = document.createElement('script');
  bp.src = '//push.zhanzhang.baidu.com/push.js';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-3271451042395249",
    enable_page_level_ads: true
  });
</script>

  <title> redux å¤§æ³•å¥½ â€”â€” å…¥é—¨å®ä¾‹ TodoList </title>
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-78049587-1', 'auto');
  ga('send', 'pageview');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?47d302b006bf28a09c22990da53cd3da";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



</head>
<body lang="zh-Hans">

  <!--[if lte IE 9]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->


  <div class="another-theme layout">

    
<header class="header" id="header">

  <div class="header-cont">
    <div class="text-area">
      
        <h1 class="title" data-text="redux å¤§æ³•å¥½ â€”â€” å…¥é—¨å®ä¾‹ TodoList"> redux å¤§æ³•å¥½ â€”â€” å…¥é—¨å®ä¾‹ TodoList </h1>

        
        <div class="post-meta">
          <div class="post-time">
            å‘è¡¨äº
            <time  datetime="2015-12-21T14:24:43+08:00" content="2015-12-21">
              2015-12-21
            </time>
          </div>

          
            <div class="post-category" >
              
                <span>
                  <a href="/categories#React" itemprop="url" rel="index">
                    <span itemprop="name">React</span>
                  </a>
                </span>

                
                

              
            </div>
          

          
            
              <span class="post-comments-count">
                <a href="/post/redux-å¤§æ³•å¥½-â€”â€”-å…¥é—¨å®ä¾‹-TodoList.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="post/redux-å¤§æ³•å¥½-â€”â€”-å…¥é—¨å®ä¾‹-TodoList.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          
        </div>
        
      
    </div>
    <!-- Navigation -->
    
    <nav class="navigation clearfix" id="navigation">
      
        
        <a class="nav-link" href="/" rel="section">
          é¦–é¡µ
        </a>
      
        
        <a class="nav-link" href="/categories" rel="section">
          åˆ†ç±»
        </a>
      
        
        <a class="nav-link" href="/tags" rel="section">
          æ ‡ç­¾
        </a>
      
        
        <a class="nav-link" href="/about" rel="section">
          å…³äº
        </a>
      
    </nav>
    
  </div>
  <div class="mask"></div>
</header>


    <main class="container">

      

  <article class="post-article post-type-normal post" itemscope>

  <div class="post-body">

    <div class="content markdown-body"><p><img src="/img/redux.jpeg" alt="redux"></p>
<h1 id="Tip">Tip</h1><p>å‰ç«¯æŠ€æœ¯çœŸæ˜¯æ—¥æ–°æœˆå¼‚ï¼Œæå®Œ React ä¸æ­é…ä¸ªæ•°æ®æµéƒ½ä¸å¥½æ„æ€äº†ã€‚<br>æ»¡æ€€æœŸå¾…çš„å¿ƒå»ç¿»äº†ç¿» fluxï¼Œç®€ç›´è¢«å®˜æ–¹é‚£æ„è¯†æµçš„æ–‡æ¡£æŠ˜æœäº†ï¼ŒçœŸæ˜¯åˆè‡­åˆé•¿è¿˜æ˜¯æˆ‘æ™ºå•†é—®é¢˜ï¼ŸğŸ˜–<br>è½¬æˆ˜ redux ï¼Œè¶Šçœ‹è¶Šæœ‰æ„æ€ï¼Œè·Ÿç€æ–‡æ¡£åšäº†ä¸ª TodoList çš„å…¥é—¨å°ä¾‹å­ã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆè´´ä¸Šæ–‡ç« ç”¨åˆ°ä¾‹å­çš„æºç  <a href="https://github.com/TongchengQiu/TodoList-as-redux-demo" target="_blank" rel="external">https://github.com/TongchengQiu/TodoList-as-redux-demo</a><br>redux çš„ Github ä»“åº“ <a href="https://github.com/rackt/redux" target="_blank" rel="external">https://github.com/rackt/redux</a><br>è¿˜æœ‰ä¸ªä¸­æ–‡çš„ gitbook ç¿»è¯‘æ–‡æ¡£ <a href="http://camsong.github.io/redux-in-chinese/index.html" target="_blank" rel="external">http://camsong.github.io/redux-in-chinese/index.html</a></p>
<h1 id="advantage">advantage</h1><p>éšç€spaï¼ˆä¸æ˜¯SPAï¼Œæ˜¯å•é¡µåº”ç”¨ï¼‰çš„å‘å±•ï¼Œä»¥ react æ¥è¯´ï¼Œç»„ä»¶åŒ–å’ŒçŠ¶æ€æœºçš„æ€æƒ³çœŸæ˜¯è§£æ”¾äº†çƒ¦æ¼çš„ dom æ“ä½œï¼Œä¸€åˆ‡éƒ½ä¸ºçŠ¶æ€ã€‚state æ¥æ“çºµ views çš„å˜åŒ–ã€‚<br>ç„¶è€Œï¼Œå› ä¸ºé¡µé¢çš„ç»„ä»¶åŒ–ï¼Œå¯¼è‡´æ¯ä¸ªç»„ä»¶éƒ½å¿…é¡»ç»´æŠ¤è‡ªèº«çš„ä¸€å¥—çŠ¶æ€ï¼Œå¯¹äºå°å‹åº”ç”¨è¿˜å¥½ã€‚<br>ä½†æ˜¯å¯¹äºæ¯”è¾ƒå¤§çš„åº”ç”¨æ¥è¯´ï¼Œè¿‡å¤šçš„çŠ¶æ€æ˜¾å¾—é”™ç»¼å¤æ‚ï¼Œåˆ°æœ€åéš¾ä»¥ç»´æŠ¤ï¼Œå¾ˆéš¾æ¸…æ™°åœ°ç»„ç»‡æ‰€æœ‰çš„çŠ¶æ€ï¼Œåœ¨å¤šäººå¼€å‘ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¯¼è‡´ç»å¸¸ä¼šå‡ºç°ä¸€äº›ä¸æ˜æ‰€ä»¥çš„å˜åŒ–ï¼Œè¶Šåˆ°åé¢è°ƒè¯•ä¸Šä¹Ÿæ˜¯è¶Šéº»çƒ¦ï¼Œå¾ˆå¤šæ—¶å€™ state çš„å˜åŒ–å·²ç»ä¸å—æ§åˆ¶ã€‚å¯¹äºç»„ä»¶é—´é€šè¡Œã€æœåŠ¡ç«¯æ¸²æŸ“ã€è·¯ç”±è·³è½¬ã€æ›´æ–°è°ƒè¯•ï¼Œæˆ‘ä»¬å¾ˆéœ€è¦ä¸€å¥—æœºåˆ¶æ¥æ¸…æ™°çš„ç»„ç»‡æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼Œredux åº”ç„¶è€Œç”Ÿï¼Œè¿™ç§æ•°æ®æµçš„æ€æƒ³çœŸæ˜¯äº†ä¸èµ·ã€‚</p>
<h1 id="state_æ ¹å¯¹è±¡çš„ç»“æ„">state æ ¹å¯¹è±¡çš„ç»“æ„</h1><p>åœ¨ react ä¸­ï¼Œæˆ‘ä»¬å°½é‡ä¼šæŠŠçŠ¶æ€æ”¾åœ¨é¡¶å±‚çš„ç»„ä»¶ï¼Œåœ¨é¡¶å±‚ç»„ä»¶ä½¿ç”¨ redux æˆ–è€… routerã€‚<br>è¿™å°±æŠŠç»„ä»¶åˆ†ä¸ºäº†ä¸¤ç§ï¼šå®¹å™¨ç»„ä»¶å’Œå±•ç¤ºç»„ä»¶ã€‚<br>å®¹å™¨ç»„ä»¶ï¼šå’Œ redux å’Œ router äº¤äº’ï¼Œç»´æŠ¤ä¸€å¥—çŠ¶æ€å’Œè§¦å‘ actionã€‚<br>å±•ç¤ºç»„ä»¶ï¼šå±•ç¤ºç»„ä»¶æ˜¯åœ¨å®¹å™¨ç»„ä»¶çš„å†…éƒ¨ï¼Œä»–ä»¬ä¸ç»´æŠ¤çŠ¶æ€ï¼Œæ‰€æœ‰æ•°æ®é€šè¿‡ props ä¼ ç»™ä»–ä»¬ï¼Œæ‰€æœ‰æ“ä½œä¹Ÿæ˜¯é€šè¿‡å›è°ƒå®Œæˆã€‚<br>è¿™æ ·ï¼Œæˆ‘ä»¬æ•´å¥—åº”ç”¨çš„æ¶æ„å°±æ˜¾å¾—æ¸…æ™°äº†ã€‚</p>
<h1 id="part">part</h1><p>redux åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼Œstore ï¼Œ action ï¼Œreducer ã€‚</p>
<h2 id="store">store</h2><p>æ•´ä¸ªåº”ç”¨çš„ state è¢«å‚¨å­˜åœ¨ä¸€æ£µ object tree ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ª object tree åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ª store ä¸­ã€‚<br>æˆ–è€…è¿™ä¹ˆè¯´ store çš„æŒ‡è´£æœ‰è¿™äº›ï¼š</p>
<ul>
<li>ç»´æŠ¤æ•´ä¸ªåº”ç”¨çš„ state</li>
<li>æä¾› getState() æ–¹æ³•è·å– stateï¼›</li>
<li>æä¾› dispatch(action) æ–¹æ³•æ›´æ–° stateï¼›</li>
<li>é€šè¿‡ subscribe(listener) æ³¨å†Œç›‘å¬å™¨ã€‚</li>
</ul>
<p>è¿™ä¹ˆè§£é‡Šä¸€ä¸‹ï¼Œæ•´ä¸ªåº”ç”¨çš„ state éƒ½å‚¨å­˜åœ¨ store ä¸­ï¼Œå®¹å™¨ç»„ä»¶å¯ä»¥ä» store ä¸­è·å–æ‰€éœ€è¦çš„çŠ¶æ€ã€‚<br>å®¹å™¨ç»„ä»¶åŒæ—¶ä¹Ÿå¯ä»¥å‘é€ç»™ store ä¸€ä¸ª actionï¼Œå‘Šè¯‰ä»–æ”¹å˜æŸä¸ªçŠ¶æ€çš„å€¼ï¼Œæ‰€ä»¥è¯´å®¹å™¨ç»„ä»¶åªè¦å‘é€ä¸€ä¸ªæŒ‡ä»¤ï¼Œå°±å¯ä»¥å« store å» setStateï¼Œç„¶å store çš„ state æ”¹å˜ï¼Œå›è¿‡æ¥å®¹å™¨ç»„ä»¶è·å–åˆ°çš„ state æ”¹å˜ï¼Œå¯¼è‡´ views çš„æ›´æ–°ã€‚</p>
<h2 id="action">action</h2><p>action å¯ä»¥ç†è§£ä¸ºä¸€ç§æŒ‡ä»¤ï¼Œstore æ•°æ®çš„å”¯ä¸€ç”±æ¥å°±æ˜¯ actionï¼Œaction æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒéœ€è¦è‡³å°‘ä¸€ä¸ªå…ƒç´ ï¼Œtypeï¼Œtype æ˜¯è¿™ä¸ªæŒ‡ä»¤çš„å”¯ä¸€æ ‡è¯†ï¼Œå…¶å®ƒå…ƒç´ æ˜¯ä¼ é€è¿™ä¸ªæŒ‡ä»¤çš„ state å€¼<br><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">type</span>:<span class="value"> ACTION_TYPE,</span><br><span class="line">  text: â€œcontentâ€,</span><br><span class="line"></span></span></span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæŒ‡ä»¤ç”±ç»„ä»¶è§¦å‘ï¼Œç„¶åä¼ åˆ° reducerã€‚</p>
<h2 id="reducer">reducer</h2><p>action åªæ˜¯è¯´æ˜äº†è¦å»åšä»€ä¹ˆï¼Œå’Œåšè¿™ä»¶äº‹æƒ…éœ€è¦çš„å‚æ•°å€¼ã€‚<br>å…·ä½“å»æ”¹å˜ store ä¸­çš„ state æ˜¯ç”± reducer æ¥åšçš„ã€‚<br>reducer å…¶å®æ˜¯ä¸€ä¸ªåŒ…å« switch çš„å‡½æ•°ï¼Œå‰é¢ä¸æ˜¯è¯´ç»„ä»¶è§¦å‘çš„ action ä¼šä¼ é€’åˆ° reducerï¼Œreducer æ¥æ”¶è¿™ä¸ªå‚æ•° actionï¼Œä»–é€šè¿‡ switch(action.type) ç„¶ååšä¸åŒæ“ä½œï¼Œå‰é¢è¯´äº†ï¼Œè¿™ä¸ª type æ˜¯æŒ‡ä»¤çš„æ ‡è¯†ï¼Œreducer æ ¹æ®è¿™ä¸ªæ ‡è¯†æ¥ä½œå‡ºä¸åŒçš„æ“ä½œã€‚<br>è¿™ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>reducer è¿˜æ¥æ”¶å¦ä¸€ä¸ªå‚æ•° stateï¼Œè¿™ä¸ªæ˜¯æ—§çš„ stateã€‚ä» action é‡Œé¢è¿˜å¯ä»¥è·å–åˆ°åšè¿™ä¸ªæ“ä½œéœ€è¦çš„ å‚æ•°å€¼ã€‚<br>è¿™ä¸ªæ“ä½œå…¶å®å°±æ˜¯å¯¹åŸæœ‰çš„ state å’Œ ä» action ä¸­çš„åˆ°çš„å€¼ï¼Œæ¥è¿›è¡Œæ“ä½œï¼ˆç»“åˆï¼Œåˆ é™¤ï¼Œâ€¦ï¼‰ç„¶åè¿”å›ä¸€ä¸ª æ–°çš„ state åˆ° storeã€‚</p>
<h2 id="æ•°æ®æµ">æ•°æ®æµ</h2><p>æŠŠå‰é¢çš„è¯­è¨€ç»„ç»‡ä¸€ä¸‹ï¼Œæ•´ä¸ªæ“ä½œçš„æ•°æ®æµå…¶å®æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>store æŠŠæ•´ä¸ªåº”ç”¨çš„ stateï¼ŒgetState()ï¼Œdispatch()ï¼Œsubscribe() ä¼ ç»™é¡¶å±‚å®¹å™¨ç»„ä»¶ï¼›</li>
<li>å®¹å™¨ç»„ä»¶å’Œä¸‰ä¸ªéƒ¨åˆ†äº¤äº’ï¼š<ul>
<li>å†…éƒ¨çš„å±•ç¤ºç»„ä»¶ï¼šå®¹å™¨æŠŠçŠ¶æ€åˆ†å‘ç»™å„ä¸ªç»„ä»¶ï¼ŒæŠŠ dispatchï¼ˆæ“ä½œæ•°æ®çš„å‡½æ•°ï¼‰ä»¥å›è°ƒçš„å½¢å¼åˆ†å‘ç»™å„ä¸ªç»„ä»¶ï¼›</li>
<li>actionï¼šå®¹å™¨è·å– actionï¼›</li>
<li>reducerï¼šå®¹å™¨å¯ä»¥è°ƒç”¨ dispatch(action)ï¼Œè¿™ä¸ªä¸Šé¢è¯´äº†ï¼Œä¼šä»¥å›è°ƒçš„å½¢å¼ç»™ä¸‹é¢çš„å­ç»„ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ä¸åŒçš„ç”¨æˆ·æ“ä½œï¼Œè°ƒç”¨ä¸åŒçš„ dispatch(action)ï¼Œæ‰§è¡Œäº†è¿™ä¸ªå‡½æ•°ä¹‹åï¼Œå°±æŠŠ action ä¼ ç»™ reducerï¼Œç„¶åçœ‹ reducerï¼›</li>
</ul>
</li>
<li>reducer å¾—åˆ°å®¹å™¨ç»„ä»¶ä¼ æ¥çš„ action ä¹‹åï¼Œæ ¹æ® action.type è¿™ä¸ªå‚æ•°æ‰§è¡Œä¸åŒæ“ä½œï¼Œä»–è¿˜ä¼šæ¥æ”¶åˆ° store é‡Œé¢çš„åŸ stateï¼Œç„¶åæŠŠåŸ state å’Œ action å¯¹è±¡é‡Œé¢çš„å…¶å®ƒå‚æ•°è¿›è¡Œæ“ä½œï¼Œç„¶å return ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li>
<li>reducer return ä¸€ä¸ªæ–°çš„å¯¹è±¡åˆ° storeï¼Œstore æ ¹æ®è¿™ä¸ªæ–°å¯¹è±¡ï¼Œæ›´æ–°åº”ç”¨çŠ¶æ€ã€‚</li>
</ol>
<p>ï¼ï¼ï¼ï¼ä¸€ä¸ªå¾ªç¯ â™»ï¸</p>
<h1 id="connect">connect</h1><p>Redux å’Œ React ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œä»–ä»¬å¹¶è¡¥äº’ç›¸ä¾èµ–ï¼Œä½†æ˜¯ Redux å’Œ React æ­é…èµ·æ¥ç®€ç›´å®Œç¾ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ react-redux è¿™ä¸ªåº“æŠŠä»–ä»¬ç»‘å®šèµ·æ¥<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save react-redux</span></span></span><br></pre></td></tr></table></figure></p>
<p>react-redux æä¾›ä¸¤ä¸ªä¸œè¥¿ Provider å’Œ connectã€‚</p>
<h2 id="Provider">Provider</h2><p>è¿™ä¸ª Provider å…¶å®å°±æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä»–æ˜¯åœ¨åŸæœ‰ App Container ä¸Šé¢å†åŒ…ä¸€å±‚ï¼Œä»–çš„ä½œç”¨å°±æ˜¯æ¥æ”¶ store é‡Œé¢çš„ store ä½œä¸º propsï¼Œå°†storeæ”¾åœ¨contexté‡Œï¼Œç»™ä¸‹é¢çš„connectç”¨çš„ã€‚</p>
<h2 id="connect-1">connect</h2><p>è¿™ä¸ªç»„ä»¶æ‰æ˜¯çœŸæ­£è¿æ¥ Redux å’Œ Reactï¼Œä»–åŒ…åœ¨æˆ‘ä»¬çš„å®¹å™¨ç»„ä»¶çš„å¤–ä¸€å±‚ï¼Œä»–æ¥æ”¶ä¸Šé¢ Provider æä¾›çš„ store é‡Œé¢çš„ state å’Œ dispatchï¼Œä¼ ç»™ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥å±æ€§å½¢å¼åºŠç»™æˆ‘ä»¬çš„å®¹å™¨ç»„ä»¶ã€‚</p>
<h1 id="å®æˆ˜_TodoList">å®æˆ˜ TodoList</h1><p>è¿™ä¸ªé¡¹ç›®ä½¿ç”¨ webpack æ¥æ„å»ºï¼Œæƒ³è¦äº†è§£ webpack çš„é…ç½®å¯ä»¥çœ‹æˆ‘çš„å…¶å®ƒä¸¤ç¯‡æ–‡ç« ï¼š<br><a href="http://qiutc.me/post/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8webpack%E2%80%94webpack-howto.html">å¦‚ä½•ä½¿ç”¨webpackâ€”webpack-howto</a>;<br><a href="http://qiutc.me/post/webpack-best-practice-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7.html">webpack-best-practice-æœ€ä½³å®è·µ-éƒ¨ç½²ç”Ÿäº§</a>.</p>
<h2 id="ç›®å½•ç»“æ„">ç›®å½•ç»“æ„</h2><figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ app                 <span class="comment">#å¼€å‘ç›®å½•</span></span><br><span class="line">|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   â”œâ”€â”€actions          #actionçš„æ–‡ä»¶</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   â”œâ”€â”€components       #å†…éƒ¨ç»„ä»¶</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   â”œâ”€â”€containers       #å®¹å™¨ç»„ä»¶</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   â”œâ”€â”€reducers         #reduceræ–‡ä»¶</span><br><span class="line"></span>|<span class="string">   </span>|<span class="string">   </span><br><span class="line"></span>|<span class="string">   â”œâ”€â”€stores           #storeé…ç½®æ–‡ä»¶</span><br><span class="line"></span>|<span class="string">   </span>|</span><br><span class="line">|<span class="string">   â””â”€â”€index.js         #å…¥å£æ–‡ä»¶</span><br><span class="line"></span>|<span class="string">      </span><br><span class="line">â”œâ”€â”€ dist                #å‘å¸ƒç›®å½•</span><br><span class="line">â”œâ”€â”€ node_modules        #åŒ…æ–‡ä»¶å¤¹</span><br><span class="line">â”œâ”€â”€ .gitignore     </span><br><span class="line">â”œâ”€â”€ .jshintrc      </span><br><span class="line">â”œâ”€â”€ server.js           #æœ¬åœ°é™æ€æœåŠ¡å™¨      </span><br><span class="line">â”œâ”€â”€ webpack.config.js   #webpacké…ç½®æ–‡ä»¶</span><br><span class="line">â””â”€â”€ package.json</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬åªå…³æ³¨æˆ‘ä»¬çš„ app å¼€å‘ç›®å½•ã€‚</p>
<h2 id="index-js_å…¥å£æ–‡ä»¶">index.js å…¥å£æ–‡ä»¶</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./containers/App'</span>;</span><br><span class="line"><span class="keyword">import</span> configureStore <span class="keyword">from</span> <span class="string">'./stores/configureStore'</span>;</span><br><span class="line"><span class="keyword">const</span> store = configureStore();</span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="title">Provider</span> <span class="attribute">store</span>=<span class="value">&#123;store&#125;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">App</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">Provider</span>&gt;</span>,</span><br><span class="line">  document.getElementById('root')</span><br><span class="line">);</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬ä» react-redux ä¸­è·å–äº†ä¸€ä¸ª Provider ç»„ä»¶ï¼Œæˆ‘ä»¬æŠŠå®ƒæ¸²æŸ“åˆ°åº”ç”¨çš„æœ€å¤–å±‚ã€‚<br>ä»–éœ€è¦ä¸€ä¸ªå±æ€§ store ï¼Œä»–æŠŠè¿™ä¸ª store æ”¾åœ¨contexté‡Œï¼Œç»™App(connect)ç”¨ã€‚</p>
<h2 id="store-1">store</h2><p><code>app/stores.configureStore.js</code><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'../reducers'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">configureStore</span>(<span class="params">initialState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = createStore(rootReducer, initialState);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">'../reducers'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> nextReducer = <span class="built_in">require</span>(<span class="string">'../reducers'</span>);</span><br><span class="line">      store.replaceReducer(nextReducer);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> store;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»–ä» redux æ‹¿åˆ° createStore è¿™ä¸ªå‡½æ•°ï¼Œå†è·å–åˆ° rootReducer ï¼›<br>createStore å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œ(reducer, [initialState])ï¼Œreducer æ¯‹åº¸ç½®ç–‘ï¼Œä»–éœ€è¦ä» store è·å– stateï¼Œä»¥åŠè¿æ¥åˆ° reducer äº¤äº’ã€‚<br>initialState æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ä¸€ä¸ªåˆå§‹åŒ– stateï¼Œå¯é€‰å‚æ•°ã€‚<br><code>module.hot</code>è¿™ä¸ªå¯ä»¥ä¸ç”¨ç®¡ï¼Œè¿™æ˜¯ webpack çƒ­åŠ è½½çš„å¤„ç†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸è¦ä»–ã€‚</p>
<h2 id="å®¹å™¨ç»„ä»¶">å®¹å™¨ç»„ä»¶</h2><p><code>containers/App.jsx</code><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, PropTypes &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  addTodo,</span><br><span class="line">  completeTodo,</span><br><span class="line">  setVisibilityFilter,</span><br><span class="line">  VisibilityFilters</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> AddTodo <span class="keyword">from</span> <span class="string">'../components/AddTodo'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'../components/TodoList'</span>;</span><br><span class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">'../components/Footer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; dispatch, visibleTodos, visibilityFilter &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">AddTodo</span></span><br><span class="line">          <span class="attribute">onAddClick</span>=<span class="value">&#123;text</span> =&gt;</span></span><br><span class="line">            dispatch(addTodo(text))</span><br><span class="line">          &#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="title">TodoList</span></span><br><span class="line">          <span class="attribute">todos</span>=<span class="value">&#123;visibleTodos&#125;</span></span><br><span class="line">          <span class="attribute">onTodoClick</span>=<span class="value">&#123;index</span> =&gt;</span> dispatch(completeTodo(index))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="title">Footer</span></span><br><span class="line">          <span class="attribute">filter</span>=<span class="value">&#123;visibilityFilter&#125;</span></span><br><span class="line">          <span class="attribute">onFilterChange</span>=<span class="value">&#123;nextFilter</span> =&gt;</span> dispatch(setVisibilityFilter(nextFilter))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    )</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">App.propTypes = &#123;</span><br><span class="line">  visibleTodos: PropTypes.arrayOf(PropTypes.shape(&#123;</span><br><span class="line">    text: PropTypes.string.isRequired,</span><br><span class="line">    completed: PropTypes.bool.isRequired</span><br><span class="line">  &#125;)),</span><br><span class="line">  visibilityFilter: PropTypes.oneOf([</span><br><span class="line">    <span class="string">'SHOW_ALL'</span>,</span><br><span class="line">    <span class="string">'SHOW_COMPLETED'</span>,</span><br><span class="line">    <span class="string">'SHOW_ACTIVE'</span></span><br><span class="line">  ]).isRequired</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selectTodos</span>(<span class="params">todos, filter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (filter) &#123;</span><br><span class="line">    <span class="keyword">case</span> VisibilityFilters.SHOW_ALL:</span><br><span class="line">      <span class="keyword">return</span> todos;</span><br><span class="line">    <span class="keyword">case</span> VisibilityFilters.SHOW_COMPLETED:</span><br><span class="line">      <span class="keyword">return</span> todos.filter(todo =&gt; todo.completed);</span><br><span class="line">    <span class="keyword">case</span> VisibilityFilters.SHOW_ACTIVE:</span><br><span class="line">      <span class="keyword">return</span> todos.filter(todo =&gt; !todo.completed);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œçš„ state æ˜¯ Connect çš„ç»„ä»¶çš„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    visibleTodos: selectTodos(state.todos, state.visibilityFilter),</span><br><span class="line">    visibilityFilter: state.visibilityFilter</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(select)(App);</span><br></pre></td></tr></table></figure></p>
<p>ä»–ä» react-redux è·å– connect è¿æ¥ç»„ä»¶ï¼Œé€šè¿‡ <code>connect(select)(App)</code> è¿æ¥ store å’Œ App å®¹å™¨ç»„ä»¶ã€‚<br>select æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»–èƒ½æ¥æ”¶åˆ°ä¸€ä¸ª state å‚æ•°ï¼Œè¿™ä¸ªå°±æ˜¯ store é‡Œé¢çš„ stateï¼Œç„¶åé€šè¿‡è¿™ä¸ªå‡½æ•°çš„å¤„ç†ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡é‡Œé¢çš„å‚æ•°ä»¥å±æ€§ä¼ é€ç»™ Appï¼Œä»¥åŠé™„å¸¦ä¸€ä¸ª dispatchã€‚<br>æ‰€ä»¥åœ¨ App é‡Œé¢å¯ä»¥ï¼š<br><figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; dispatch, visibleTodos, visibilityFilter &#125; = <span class="keyword">this</span>.props;</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥ App é€šè¿‡ connect çš„åˆ° state å’Œ dispatchï¼ŒæŠŠ state ä¼ é€’ç»™å­ç»„ä»¶ã€‚<br>dispatch è¿™ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ª action å‚æ•°ï¼Œç„¶åå°±ä¼šæ‰§è¡Œ reducer é‡Œé¢çš„æ“ä½œã€‚<br>æ¯”å¦‚ï¼š<br><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">text =&gt;</span><br><span class="line">  dispatch<span class="list">(<span class="keyword">addTodo</span><span class="list">(<span class="keyword">text</span>)</span>)</span></span><br></pre></td></tr></table></figure></p>
<p><code>addTodo(text)</code>ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯åœ¨ action é‡Œé¢çš„åˆ°çš„ï¼Œå¯ä»¥çœ‹ action çš„ä»£ç ï¼Œä»–å…¶å®è¿”å›ä¸€ä¸ª action å¯¹è±¡ï¼Œæ‰€ä»¥å…¶å®å°±æ˜¯<code>dispatch(action)</code> ã€‚</p>
<h2 id="action-1">action</h2><p><code>app/actions/index.js</code><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_TODO = <span class="string">'ADD_TODO'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> COMPLETE_TODO = <span class="string">'COMPLETE_TODO'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SET_VISIBILITY_FILTER = <span class="string">'SET_VISIBILITY_FILTER'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> VisibilityFilters = &#123;</span><br><span class="line">  SHOW_ALL: <span class="string">'SHOW_ALL'</span>,</span><br><span class="line">  SHOW_COMPLETED: <span class="string">'SHOW_COMPLETED'</span>,</span><br><span class="line">  SHOW_ACTIVE: <span class="string">'SHOW_ACTIVE'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addTodo</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: ADD_TODO,</span><br><span class="line">    text</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">completeTodo</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: COMPLETE_TODO,</span><br><span class="line">    index</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setVisibilityFilter</span>(<span class="params">filter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: SET_VISIBILITY_FILTER,</span><br><span class="line">    filter</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨å£°æ˜æ¯ä¸€ä¸ªè¿”å› action å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤´éƒ¨å£°æ˜è¿™ä¸ª action çš„ typeï¼Œä»¥ä¾¿å¥½ç»„ç»‡ç®¡ç†ã€‚<br>æ¯ä¸ªå‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ª action å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨ å®¹å™¨ç»„ä»¶é‡Œé¢ è°ƒç”¨<br><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">text =&gt;</span><br><span class="line">  dispatch<span class="list">(<span class="keyword">addTodo</span><span class="list">(<span class="keyword">text</span>)</span>)</span></span><br></pre></td></tr></table></figure></p>
<p>å°±æ˜¯è°ƒç”¨<code>dispatch(action)</code> ã€‚</p>
<h2 id="reducer-1">reducer</h2><p><code>app/reducers/visibilityFilter.js</code><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  SET_VISIBILITY_FILTER,</span><br><span class="line">  VisibilityFilters</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; SHOW_ALL &#125; = VisibilityFilters;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">visibilityFilter</span>(<span class="params">state = SHOW_ALL, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> SET_VISIBILITY_FILTER:</span><br><span class="line">      <span class="keyword">return</span> action.filter;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> visibilityFilter;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘ä»¬ä» actions è·å¾—å„ä¸ª type çš„å‚æ•°ï¼Œä»¥ä¾¿å’Œ action åšå¥½æ˜ å°„å¯¹åº”ã€‚<br>æ•´ä¸ªå‡½æ•°å…¶å®å°±æ˜¯æ‰§è¡Œ switchï¼Œæ ¹æ®ä¸åŒçš„ action.typeï¼Œè¿”å›ä¸åŒçš„å¯¹è±¡çŠ¶æ€ã€‚<br>ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ type å¾ˆå¤šï¼Œæ¯”å¦‚é™¤äº† visibilityFilterï¼Œè¿˜æœ‰ todosï¼Œéš¾é“è¦å†™ä¸€ä¸ªé•¿é•¿çš„switchï¼Œå½“ç„¶ä¸ã€‚<br>redux æä¾›ä¸€ä¸ª combineReducers è¾…åŠ©å‡½æ•°ï¼ŒæŠŠä¸€ä¸ªç”±å¤šä¸ªä¸åŒ reducer å‡½æ•°ä½œä¸º value çš„ objectï¼Œåˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„ reducer å‡½æ•°ï¼Œç„¶åå°±å¯ä»¥å¯¹è¿™ä¸ª reducer è°ƒç”¨ createStoreã€‚<br>æˆ‘ä»¬æŠŠä¸åŒçš„ reducer æ”¾åœ¨ä¸åŒæ–‡ä»¶ä¸‹ã€‚<br><code>app/reducers/todo.js</code><br><figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  ADD_TODO,</span><br><span class="line">  COMPLETE_TODO</span><br><span class="line">&#125; <span class="keyword">from</span> '../actions';</span><br><span class="line"></span><br><span class="line">function todos(<span class="keyword">state</span> = [], action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case ADD_TODO:</span><br><span class="line">      return [</span><br><span class="line">        ...<span class="keyword">state</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          text: action.text,</span><br><span class="line">          completed: false</span><br><span class="line">        &#125;</span><br><span class="line">      ];</span><br><span class="line">    case COMPLETE_TODO:</span><br><span class="line">      return [</span><br><span class="line">        ...<span class="keyword">state</span>.slice(<span class="number">0</span>, action.index),</span><br><span class="line">        Object.assign(&#123;&#125;, <span class="keyword">state</span>[action.index], &#123;</span><br><span class="line">          completed: true</span><br><span class="line">        &#125;),</span><br><span class="line">        ...<span class="keyword">state</span>.slice(action.index + <span class="number">1</span>)</span><br><span class="line">      ];</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      return <span class="keyword">state</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> todos;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åé€šè¿‡ä¸€ä¸ª index.js æŠŠä»–ä»¬åˆå¹¶ã€‚<br><code>app/reducers/index.js</code><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> todos <span class="keyword">from</span> <span class="string">'./todos'</span>;</span><br><span class="line"><span class="keyword">import</span> visibilityFilter <span class="keyword">from</span> <span class="string">'./visibilityFilter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</span><br><span class="line">  todos,</span><br><span class="line">  visibilityFilter</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure></p>
<h2 id="å±•ç¤ºç»„ä»¶">å±•ç¤ºç»„ä»¶</h2><p><code>app/components/AddTodo/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"><span class="keyword">import</span> &#123; findDOMNode &#125; from <span class="symbol">'react</span>-dom';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">AddTodo</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input <span class="class"><span class="keyword">type</span>=</span><span class="symbol">'tex</span>t' ref=<span class="symbol">'inpu</span>t' /&gt;</span><br><span class="line">        &lt;button onClick=&#123; e =&gt; <span class="keyword">this</span>.handleClick(e) &#125;&gt;</span><br><span class="line">          <span class="type">Add</span></span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick(e) &#123;</span><br><span class="line">    const inputNode = findDOMNode(<span class="keyword">this</span>.refs.input);</span><br><span class="line">    const text = inputNode.value.trim();</span><br><span class="line">    <span class="keyword">this</span>.props.onAddClick(text);</span><br><span class="line">    inputNode.value = '';</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">AddTodo</span>.propTypes = &#123;</span><br><span class="line">  onAddClick: <span class="type">PropTypes</span>.func.isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>app/components/Todo/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Todo</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; onClick, completed, text &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;li</span><br><span class="line">        onClick=&#123;onClick&#125;</span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          textDecoration: completed ? <span class="symbol">'line</span>-through' : <span class="symbol">'non</span>e',</span><br><span class="line">          cursor: completed ? <span class="symbol">'defaul</span>t' : <span class="symbol">'pointe</span>r'</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;text&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Todo</span>.propTypes = &#123;</span><br><span class="line">  onClick: <span class="type">PropTypes</span>.func.isRequired,</span><br><span class="line">  text: <span class="type">PropTypes</span>.string.isRequired,</span><br><span class="line">  completed: <span class="type">PropTypes</span>.bool.isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>app/components/TodoList/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"><span class="keyword">import</span> <span class="type">Todo</span> from '../<span class="type">Todo</span>';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">this</span>.props.todos.map((todo, index) =&gt;</span><br><span class="line">            &lt;<span class="type">Todo</span></span><br><span class="line">              &#123;...todo&#125;</span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onTodoClick(index)&#125;</span><br><span class="line">              key=&#123;index&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">TodoList</span>.propTypes = &#123;</span><br><span class="line">  onTodoClick: <span class="type">PropTypes</span>.func.isRequired,</span><br><span class="line">  todos: <span class="type">PropTypes</span>.arrayOf(<span class="type">PropTypes</span>.shape(&#123;</span><br><span class="line">    text: <span class="type">PropTypes</span>.string.isRequired,</span><br><span class="line">    completed: <span class="type">PropTypes</span>.bool.isRequired</span><br><span class="line">  &#125;).isRequired).isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>app/components/Footer/index.jsx</code><br><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Footer</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  renderFilter(filter, name) &#123;</span><br><span class="line">    <span class="keyword">if</span>(filter == <span class="keyword">this</span>.props.filter) &#123;</span><br><span class="line">      <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;a</span><br><span class="line">        href=<span class="string">"#"</span></span><br><span class="line">        onClick=&#123;e =&gt; &#123;</span><br><span class="line">          e.preventDefault();</span><br><span class="line">          <span class="keyword">this</span>.props.onFilterChange(filter);</span><br><span class="line">        &#125;&#125;&gt;</span><br><span class="line">        &#123;name&#125;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        <span class="type">SHOW</span></span><br><span class="line">        &#123;' '&#125;</span><br><span class="line">        &#123;<span class="keyword">this</span>.renderFilter(<span class="symbol">'SHOW_AL</span>L', <span class="symbol">'Al</span>l')&#125;</span><br><span class="line">        &#123;', '&#125;</span><br><span class="line">        &#123;<span class="keyword">this</span>.renderFilter(<span class="symbol">'SHOW_COMPLETE</span>D', <span class="symbol">'Complete</span>d')&#125;</span><br><span class="line">        &#123;', '&#125;</span><br><span class="line">        &#123;<span class="keyword">this</span>.renderFilter(<span class="symbol">'SHOW_ACTIV</span>E', <span class="symbol">'Activ</span>e')&#125;</span><br><span class="line">        .</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Footer</span>.propTypes = &#123;</span><br><span class="line">  onFilterChange: <span class="type">PropTypes</span>.func.isRequired,</span><br><span class="line">  filter: <span class="type">PropTypes</span>.oneOf([</span><br><span class="line">    <span class="symbol">'SHOW_AL</span>L',</span><br><span class="line">    <span class="symbol">'SHOW_COMPLETE</span>D',</span><br><span class="line">    <span class="symbol">'SHOW_ACTIV</span>E'</span><br><span class="line">  ]).isRequired</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„å±•ç¤ºç»„ä»¶éœ€è¦çš„ state å’Œ æ•°æ®ï¼Œéƒ½ä»å±æ€§ä¸­è·å–çš„ï¼Œæ‰€æœ‰çš„æ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡å®¹å™¨ç»„ä»¶ç»™çš„å›è°ƒå‡½æ•°æ¥æ“ä½œçš„ã€‚<br>ä»–ä»¬å°½å¯èƒ½åœ°ä¸æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œåšæ— çŠ¶æ€ç»„ä»¶ã€‚</p>
<h1 id="end">end</h1><p>å…³äº redux çš„ç”¨æ³•ï¼Œè¿™åªæ˜¯åŸºç¡€å…¥é—¨çš„éƒ¨åˆ†ï¼Œè¿˜æœ‰çš„å¤šçš„æåŸºæ“ä½œï¼Œæ¯”å¦‚å¼‚æ­¥æ•°æ®æµã€Middlewareã€å’Œ router é…åˆã€‚<br>æ•¬è¯·æœŸå¾…ï½ï½ï½ï½<br>ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶</p>
</div>

    <div class="post-sidebar">
  <div class="toggle-btn" id="toggle-btn">
    <i class="fa fa-reorder"></i>
  </div>
  <section class="post-toc-wrap" id="post-sidebar">
    <h2 class="toc-title">å†…å®¹ç›®å½•</h2>
    <div class="post-toc">
      
      
        <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Tip"><span class="nav-text">Tip</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#advantage"><span class="nav-text">advantage</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#state_æ ¹å¯¹è±¡çš„ç»“æ„"><span class="nav-text">state æ ¹å¯¹è±¡çš„ç»“æ„</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#part"><span class="nav-text">part</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#store"><span class="nav-text">store</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#action"><span class="nav-text">action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reducer"><span class="nav-text">reducer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ•°æ®æµ"><span class="nav-text">æ•°æ®æµ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#connect"><span class="nav-text">connect</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Provider"><span class="nav-text">Provider</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#connect-1"><span class="nav-text">connect</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å®æˆ˜_TodoList"><span class="nav-text">å®æˆ˜ TodoList</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ç›®å½•ç»“æ„"><span class="nav-text">ç›®å½•ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#index-js_å…¥å£æ–‡ä»¶"><span class="nav-text">index.js å…¥å£æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#store-1"><span class="nav-text">store</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®¹å™¨ç»„ä»¶"><span class="nav-text">å®¹å™¨ç»„ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#action-1"><span class="nav-text">action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reducer-1"><span class="nav-text">reducer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å±•ç¤ºç»„ä»¶"><span class="nav-text">å±•ç¤ºç»„ä»¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#end"><span class="nav-text">end</span></a></li></ol></div>
      
    </div>
  </section>
</div>


  </div>

  <footer class="post-footer">
    
      <div class="post-tags">
        
          <a href="/tags#JavaScript" rel="tag">#JavaScript</a>
        
          <a href="/tags#React" rel="tag">#React</a>
        
          <a href="/tags#redux" rel="tag">#redux</a>
        
      </div>
    
    
  <style>
    .donation {
      width: 100%;
      margin-top: 2rem;
    }
    .donation .text {
      color: #333;
      font-size: .8rem;
      cursor: pointer;
      text-decoration: underline;
    }
    .donation .text:hover {
      color: rgb(63,134,181);
    }
    .donation .img-box {
      transition: all .3s;
      width: 0;
      height: 0;
      margin: 1rem auto;
      overflow: hidden;
    }
    .donation .img-box img {
      width: 100%;
      height: 100%;
    }
    .donation #donation {
      display: none;
    }
    .donation #donation:checked + .img-box {
      width: 16rem;
      height: 16rem;
    }
  </style>
  <div class="donation">
    <label class="text" for="donation">
      å¦‚æœä½ è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¹¶ä¸”æƒ³ä¸ºæˆ‘ä¹°ä¸€æ¯å’–å•¡ï¼Œç‚¹è¿™é‡Œï½
    </label>
    <input type="checkbox" name="donation" id="donation">
    <div class="img-box">
      <img src="/img/donation.png" alt="donation" />
    </div>
    </style>
  </div>


  </footer>

</article>




      
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="post/redux-å¤§æ³•å¥½-â€”â€”-å…¥é—¨å®ä¾‹-TodoList.html"
           data-title="redux å¤§æ³•å¥½ â€”â€” å…¥é—¨å®ä¾‹ TodoList" data-url="http://qiutc.me/post/redux-å¤§æ³•å¥½-â€”â€”-å…¥é—¨å®ä¾‹-TodoList.html">
      </div>
    
  </div>




    </main>

    <footer class="footer clearfix">
  <div class="copyright" >
    <span>Copyright</span>
    
    &copy;  2015-
    <span itemprop="copyrightYear">2016</span>
    <span class="author" itemprop="copyrightHolder">é˜¿åŸğŸ˜‡</span>
  </div>

  <div class="info">
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
      <span id="showDays" class="show-days"></span>
      <script>
      var birthDay = new Date('10/04/2015');
      var now = new Date();
      var duration = now.getTime() - birthDay.getTime();
      var total= Math.floor(duration / (1000 * 60 * 60 * 24));
      document.getElementById("showDays").innerHTML = "æœ¬ç«™å·²è¿è¡Œ "+total+" å¤©";
      </script>
      ---
    
    <span id="busuanzi_container_site_pv">
        æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
    </span>
  </div>

</footer>


  </div>

  <div class="back-top-btn" id="back-top-btn"><i class="fa fa-chevron-up"></i></div>





  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"qiutongcheng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     




<script type="text/javascript" src="/js/motto.min.js?v=0.0.1"></script>
<script type="text/javascript" src="/js/main.js?v=0.0.1"></script>


</body>
</html>
