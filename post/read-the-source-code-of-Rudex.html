<!DOCTYPE html>
<html lang="en">
<head>
  <!-- content-Type -->
<meta charset="utf-8">


<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="language" content="en">
<meta name="robots" content="all">


<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="email=no" name="format-detection">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



<meta name="author" content="TongchengQiu, TongchengQiu@gmail.com">
<meta name="reply-to" content="TongchengQiu@gmail.com">
<meta name="owner" content="TongchengQiu">




<meta name="google-site-verification" content="UA-78049587-1" />




<meta name="baidu-site-verification" content="fRBucd9VmI" />




<meta name="description" content="hello word! ğŸ˜º" />




<meta name="keywords" content="JavaScript,Redux," />


<meta name="description" content="TIPRedux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚
ä½œä¸º React å…¨å®¶æ¡¶çš„ä¸€ä»½å­ï¼ŒRedux å¯è°“è¯´ä¹Ÿæ˜¯åå£°å“å“ï¼Œåœ¨ 2016 å¹´å­¦ä¹  JavaScript æƒ³å¿…æ²¡æœ‰å¤šå°‘äººæ²¡å¬è¿‡å§ã€‚
è¿™é‡Œï¼Œæœ¬æ–‡ä¸æ˜¯æ¥æ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ Redux çš„ API çš„ï¼Œè¿™ä¸€ç±»çš„æ–‡ç« å·²ç»å¾ˆå¤šï¼Œå¯¹äº Redux çš„ä»‹ç»å’Œå­¦ä¹ å¯ä»¥ç‚¹å‡»ä¸‹åˆ—é“¾æ¥ï¼š

å®˜æ–¹æ–‡æ¡£
å®˜æ–¹Github
ä¸­æ–‡æ–‡æ¡£
redux">
<meta property="og:type" content="article">
<meta property="og:title" content="è§£æ Redux æºç ">
<meta property="og:url" content="http://qiutc.me/post/read-the-source-code-of-Rudex.html">
<meta property="og:site_name" content="é˜¿åŸçš„blog">
<meta property="og:description" content="TIPRedux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚
ä½œä¸º React å…¨å®¶æ¡¶çš„ä¸€ä»½å­ï¼ŒRedux å¯è°“è¯´ä¹Ÿæ˜¯åå£°å“å“ï¼Œåœ¨ 2016 å¹´å­¦ä¹  JavaScript æƒ³å¿…æ²¡æœ‰å¤šå°‘äººæ²¡å¬è¿‡å§ã€‚
è¿™é‡Œï¼Œæœ¬æ–‡ä¸æ˜¯æ¥æ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ Redux çš„ API çš„ï¼Œè¿™ä¸€ç±»çš„æ–‡ç« å·²ç»å¾ˆå¤šï¼Œå¯¹äº Redux çš„ä»‹ç»å’Œå­¦ä¹ å¯ä»¥ç‚¹å‡»ä¸‹åˆ—é“¾æ¥ï¼š

å®˜æ–¹æ–‡æ¡£
å®˜æ–¹Github
ä¸­æ–‡æ–‡æ¡£
redux">
<meta property="og:image" content="http://qiutc.me/img/redux.jpeg">
<meta property="og:updated_time" content="2016-10-07T17:25:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="è§£æ Redux æºç ">
<meta name="twitter:description" content="TIPRedux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚
ä½œä¸º React å…¨å®¶æ¡¶çš„ä¸€ä»½å­ï¼ŒRedux å¯è°“è¯´ä¹Ÿæ˜¯åå£°å“å“ï¼Œåœ¨ 2016 å¹´å­¦ä¹  JavaScript æƒ³å¿…æ²¡æœ‰å¤šå°‘äººæ²¡å¬è¿‡å§ã€‚
è¿™é‡Œï¼Œæœ¬æ–‡ä¸æ˜¯æ¥æ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ Redux çš„ API çš„ï¼Œè¿™ä¸€ç±»çš„æ–‡ç« å·²ç»å¾ˆå¤šï¼Œå¯¹äº Redux çš„ä»‹ç»å’Œå­¦ä¹ å¯ä»¥ç‚¹å‡»ä¸‹åˆ—é“¾æ¥ï¼š

å®˜æ–¹æ–‡æ¡£
å®˜æ–¹Github
ä¸­æ–‡æ–‡æ¡£
redux">






  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.0.2" />






<link href="http://cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.0.2"/>


<script>
(function(){
  var bp = document.createElement('script');
  bp.src = '//push.zhanzhang.baidu.com/push.js';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>

  <title> è§£æ Redux æºç  </title>
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-78049587-1', 'auto');
  ga('send', 'pageview');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?47d302b006bf28a09c22990da53cd3da";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



</head>
<body lang="zh-Hans">

  <!--[if lte IE 9]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->


  <div class="another-theme layout">

    
<header class="header" id="header" style="background: url(/img/bg-redux.png) center / cover">

  <div class="header-cont">
    <div class="text-area">
      
        <h1 class="title" data-text="è§£æ Redux æºç "> è§£æ Redux æºç  </h1>

        
        <div class="post-meta">
          <div class="post-time">
            å‘è¡¨äº
            <time  datetime="2016-10-07T22:21:43+08:00" content="2016-10-07">
              2016-10-07
            </time>
          </div>

          
            <div class="post-category" >
              
                <span>
                  <a href="/categories#JavaScript" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </div>
          

          
            
              <span class="post-comments-count">
                <a href="/post/read-the-source-code-of-Rudex.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="post/read-the-source-code-of-Rudex.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          
        </div>
        
      
    </div>
    <!-- Navigation -->
    
    <nav class="navigation clearfix" id="navigation">
      
        
        <a class="nav-link" href="/" rel="section">
          é¦–é¡µ
        </a>
      
        
        <a class="nav-link" href="/categories" rel="section">
          åˆ†ç±»
        </a>
      
        
        <a class="nav-link" href="/tags" rel="section">
          æ ‡ç­¾
        </a>
      
        
        <a class="nav-link" href="/about" rel="section">
          å…³äº
        </a>
      
    </nav>
    
  </div>
  <div class="mask"></div>
</header>


    <main class="container">

      

  <article class="post-article post-type-normal post" itemscope>

  <div class="post-body">

    <div class="content markdown-body"><p><img src="/img/redux.jpeg" alt="redux"></p>
<h1 id="TIP">TIP</h1><p>Redux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚</p>
<p>ä½œä¸º React å…¨å®¶æ¡¶çš„ä¸€ä»½å­ï¼ŒRedux å¯è°“è¯´ä¹Ÿæ˜¯åå£°å“å“ï¼Œåœ¨ 2016 å¹´å­¦ä¹  JavaScript æƒ³å¿…æ²¡æœ‰å¤šå°‘äººæ²¡å¬è¿‡å§ã€‚</p>
<p>è¿™é‡Œï¼Œæœ¬æ–‡ä¸æ˜¯æ¥æ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ Redux çš„ API çš„ï¼Œè¿™ä¸€ç±»çš„æ–‡ç« å·²ç»å¾ˆå¤šï¼Œå¯¹äº Redux çš„ä»‹ç»å’Œå­¦ä¹ å¯ä»¥ç‚¹å‡»ä¸‹åˆ—é“¾æ¥ï¼š</p>
<ul>
<li><a href="http://redux.js.org/" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://github.com/reactjs/redux" target="_blank" rel="external">å®˜æ–¹Github</a></li>
<li><a href="http://cn.redux.js.org/index.html" target="_blank" rel="external">ä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="http://qiutc.me/post/redux-%E5%A4%A7%E6%B3%95%E5%A5%BD-%E2%80%94%E2%80%94-%E5%85%A5%E9%97%A8%E5%AE%9E%E4%BE%8B-TodoList.html">redux å¤§æ³•å¥½ â€”â€” å…¥é—¨å®ä¾‹ TodoList(æœ¬äººçš„æ¸£æ¸£æ–‡ç« )</a></li>
</ul>
<p>Redux ä½“å°ç²¾æ‚ï¼ˆåªæœ‰2kBï¼‰ä¸”æ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œå› æ­¤æœ¬æ–‡æƒ³é€šè¿‡é˜…è¯» Redux çš„æºç æ¥å­¦ä¹  Redux çš„ä½¿ç”¨ä»¥åŠæ€æƒ³ã€‚</p>
<h1 id="æºç ç»“æ„">æºç ç»“æ„</h1><p>Redux çš„æºç ç»“æ„å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹ <code>src</code> ç›®å½•ä¸‹çš„ä»£ç ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="class">.src</span></span><br><span class="line">â”œâ”€â”€ utils                #å·¥å…·å‡½æ•°</span><br><span class="line">â”œâ”€â”€ applyMiddleware<span class="class">.js</span></span><br><span class="line">â”œâ”€â”€ bindActionCreators<span class="class">.js</span>        </span><br><span class="line">â”œâ”€â”€ combineReducers<span class="class">.js</span>     </span><br><span class="line">â”œâ”€â”€ compose<span class="class">.js</span>       </span><br><span class="line">â”œâ”€â”€ createStore<span class="class">.js</span>  </span><br><span class="line">â””â”€â”€ index<span class="class">.js</span>             #å…¥å£ js</span><br></pre></td></tr></table></figure>
<h1 id="index-js">index.js</h1><p>è¿™ä¸ªæ˜¯æ•´ä¸ªä»£ç çš„å…¥å£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> createStore <span class="keyword">from</span> <span class="string">'./createStore'</span></span><br><span class="line"><span class="keyword">import</span> combineReducers <span class="keyword">from</span> <span class="string">'./combineReducers'</span></span><br><span class="line"><span class="keyword">import</span> bindActionCreators <span class="keyword">from</span> <span class="string">'./bindActionCreators'</span></span><br><span class="line"><span class="keyword">import</span> applyMiddleware <span class="keyword">from</span> <span class="string">'./applyMiddleware'</span></span><br><span class="line"><span class="keyword">import</span> compose <span class="keyword">from</span> <span class="string">'./compose'</span></span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">'./utils/warning'</span></span><br><span class="line"></span><br><span class="line">function isCrushed() &#123;&#125;</span><br><span class="line"></span><br><span class="line">if (</span><br><span class="line">  process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp;</span><br><span class="line">  typeof isCrushed.name === <span class="string">'string'</span> &amp;&amp;</span><br><span class="line">  isCrushed.name !== <span class="string">'isCrushed'</span></span><br><span class="line">) &#123;</span><br><span class="line">  warning(</span><br><span class="line">    <span class="string">'ã€‚ã€‚ã€‚'</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export &#123;</span><br><span class="line">  createStore,</span><br><span class="line">  combineReducers,</span><br><span class="line">  bindActionCreators,</span><br><span class="line">  applyMiddleware,</span><br><span class="line">  compose</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>isCrushed</code> å‡½æ•°ä¸»è¦æ˜¯ä¸ºäº†éªŒè¯åœ¨éç”Ÿäº§ç¯å¢ƒä¸‹ Redux æ˜¯å¦è¢«å‹ç¼©ï¼ˆå› ä¸ºå¦‚æœè¢«å‹ç¼©äº†é‚£ä¹ˆ <code>(isCrushed.name !== &#39;isCrushed&#39;)</code> å°±æ˜¯ <code>true</code>ï¼‰ï¼Œå¦‚æœè¢«å‹ç¼©ä¼šç»™å¼€å‘è€…ä¸€ä¸ª warn æç¤ºï¼‰ã€‚</p>
<p>ç„¶åå°±æ˜¯æš´éœ² <code>createStore</code> <code>combineReducers</code> <code>bindActionCreators</code> <code>applyMiddleware</code> <code>compose</code> è¿™å‡ ä¸ªæ¥å£ç»™å¼€å‘è€…ä½¿ç”¨ï¼Œæˆ‘ä»¬æ¥é€ä¸€è§£æè¿™å‡ ä¸ª APIã€‚</p>
<h1 id="createStore-js">createStore.js</h1><p>è¿™ä¸ªæ˜¯ Redux æœ€ä¸»è¦çš„ä¸€ä¸ª API äº†ï¼Œå®ƒåˆ›å»ºä¸€ä¸ª Redux store æ¥ä»¥å­˜æ”¾åº”ç”¨ä¸­æ‰€æœ‰çš„ stateï¼Œåº”ç”¨ä¸­åº”æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª storeã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> isPlainObject <span class="keyword">from</span> <span class="string">'lodash/isPlainObject'</span></span><br><span class="line"><span class="keyword">import</span> $$observable from <span class="string">'symbol-observable'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§æœ‰ action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> ActionTypes = &#123;</span><br><span class="line">  INIT: <span class="string">'@@redux/INIT'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ¥å—çš„å‚æ•°ä¸ªæ•°ï¼Œæ¥æŒ‡å®š reducer ã€ preloadedState å’Œ enhancer</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> preloadedState === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    enhancer = preloadedState</span><br><span class="line">    preloadedState = <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœ enhancer å­˜åœ¨å¹¶ä¸”é€‚åˆåˆæ³•çš„å‡½æ•°ï¼Œé‚£ä¹ˆè°ƒç”¨ enhancerï¼Œå¹¶ä¸”ç»ˆæ­¢å½“å‰å‡½æ•°æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the reducer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‚¨å­˜å½“å‰çš„ currentReducer</span></span><br><span class="line">  <span class="keyword">var</span> currentReducer = reducer</span><br><span class="line">  <span class="comment">// å‚¨å­˜å½“å‰çš„çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">var</span> currentState = preloadedState</span><br><span class="line">  <span class="comment">// å‚¨å­˜å½“å‰çš„ç›‘å¬å‡½æ•°åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">var</span> currentListeners = []</span><br><span class="line">  <span class="comment">// å‚¨å­˜ä¸‹ä¸€ä¸ªç›‘å¬å‡½æ•°åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">var</span> nextListeners = currentListeners</span><br><span class="line">  <span class="keyword">var</span> isDispatching = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿™ä¸ªå‡½æ•°å¯ä»¥æ ¹æ®å½“å‰ç›‘å¬å‡½æ•°çš„åˆ—è¡¨ç”Ÿæˆæ–°çš„ä¸‹ä¸€ä¸ªç›‘å¬å‡½æ•°åˆ—è¡¨å¼•ç”¨</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ensureCanMutateNextListeners</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nextListeners === currentListeners) &#123;</span><br><span class="line">      nextListeners = currentListeners.slice()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ... getState ...</span><br><span class="line"></span><br><span class="line">  ... subscribe ...</span><br><span class="line"></span><br><span class="line">  ... dispatch ...</span><br><span class="line"></span><br><span class="line">  ... replaceReducer ...</span><br><span class="line"></span><br><span class="line">  ... observable ...</span><br><span class="line"></span><br><span class="line">  dispatch(&#123; type: ActionTypes.INIT &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dispatch,</span><br><span class="line">    subscribe,</span><br><span class="line">    getState,</span><br><span class="line">    replaceReducer,</span><br><span class="line">    [$$observable]: observable</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª <code>ActionTypes</code> å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ª actionï¼Œæ˜¯ä¸€ä¸ª Redux çš„ç§æœ‰ actionï¼Œä¸å…è®¸å¤–ç•Œè§¦å‘ï¼Œç”¨æ¥åˆå§‹åŒ– Store çš„çŠ¶æ€æ ‘å’Œæ”¹å˜ reducers ååˆå§‹åŒ– Store çš„çŠ¶æ€æ ‘ã€‚</p>
<h4 id="createStore">createStore</h4><p>ç„¶åç€é‡æ¥çœ‹ <code>createStore</code> å‡½æ•°ï¼š</p>
<h5 id="æ¥å—">æ¥å—</h5><p>å®ƒå¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œreducerã€preloadedStateã€enhancerï¼š</p>
<ul>
<li>reducerï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šå½“å‰çŠ¶æ€ å’Œ è§¦å‘çš„ actionï¼›</li>
<li>preloadedStateï¼šåˆå§‹çŠ¶æ€å¯¹è±¡ï¼Œå¯ä»¥å¾ˆéšæ„æŒ‡å®šï¼Œæ¯”å¦‚æœåŠ¡ç«¯æ¸²æŸ“çš„åˆå§‹çŠ¶æ€ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ combineReducers æ¥ç”Ÿæˆ reducerï¼Œé‚£å¿…é¡»ä¿æŒçŠ¶æ€å¯¹è±¡çš„ key å’Œ combineReducers ä¸­çš„ key ç›¸å¯¹åº”ï¼›</li>
<li>enhancerï¼šstore çš„å¢å¼ºå™¨å‡½æ•°ï¼Œå¯ä»¥æŒ‡å®šä¸º ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶ï¼Œæ—¶é—´æ—…è¡Œï¼ŒæŒä¹…åŒ– ç­‰ç­‰ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°åªèƒ½ç”¨ Redux æä¾›çš„ applyMiddleware å‡½æ•°æ¥ç”Ÿæˆï¼›</li>
</ul>
<p>æ ¹æ®ä¼ å…¥å‚æ•°çš„ä¸ªæ•°å’Œç±»å‹ï¼Œåˆ¤æ–­ reducer ã€ preloadedState ã€ enhancerï¼›</p>
<h5 id="è¿”å›">è¿”å›</h5><p>è°ƒç”¨å®Œå‡½æ•°å®ƒè¿”å›çš„æ¥å£æ˜¯ <code>dispatch</code> <code>subscribe</code> <code>getState</code> <code>replaceReducer</code> å’Œ  <code>[$$observable]</code></p>
<p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¼€å‘ä¸­ä¸»è¦ä½¿ç”¨çš„å‡ ä¸ªæ¥å£ã€‚</p>
<h5 id="enhancer">enhancer</h5><p>å¦‚æœ enhancer å‚æ•°ä¼ å…¥å¹¶ä¸”æ˜¯ä¸ªåˆæ³•çš„å‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯è°ƒç”¨ <code>enhancer</code> å‡½æ•°ï¼ˆä¼ å…¥ <code>createStore</code> æ¥ç»™å®ƒæ“ä½œï¼‰ï¼Œ<code>enhancer</code> å‡½æ•°è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿™é‡Œä¼ å…¥ <code>reducer</code> å’Œ <code>preloadedState</code>ï¼Œå¹¶ä¸”è¿”å›å‡½æ•°è°ƒç”¨ç»“æœï¼Œç»ˆæ­¢å½“å‰å‡½æ•°æ‰§è¡Œï¼›<br>åœ¨ enhancer å‡½æ•°é‡Œé¢æ˜¯å¦‚ä½•æ“ä½œä½¿ç”¨çš„å¯ä»¥çœ‹ <code>applyMiddleware</code> éƒ¨åˆ†ï¼›</p>
<h5 id="getState">getState</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> currentState</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–å½“å‰çš„çŠ¶æ€ï¼Œ<code>createStore</code> ä¸­çš„ <code>currentState</code> å‚¨å­˜å½“å‰çš„çŠ¶æ€æ ‘ï¼Œè¿™æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè¿™ä¸ªå‚æ•°ä¼šæŒä¹…å­˜åœ¨ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ“ä½œçŠ¶æ€éƒ½æ˜¯æ”¹å˜è¿™ä¸ªå¼•ç”¨ï¼Œ<code>getState</code> å‡½æ•°è¿”å›å½“å‰çš„ <code>currentState</code>ã€‚</p>
<h5 id="subscribe">subscribe</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected listener to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> isSubscribed = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  ensureCanMutateNextListeners()</span><br><span class="line">  nextListeners.push(listener)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isSubscribed) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    isSubscribed = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    ensureCanMutateNextListeners()</span><br><span class="line">    <span class="keyword">var</span> index = nextListeners.indexOf(listener)</span><br><span class="line">    nextListeners.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°å¯ä»¥ç»™ store çš„çŠ¶æ€æ·»åŠ è®¢é˜…ç›‘å¬å‡½æ•°ï¼Œä¸€æ—¦è°ƒç”¨ <code>dispatch</code> ï¼Œæ‰€æœ‰çš„ç›‘å¬å‡½æ•°å°±ä¼šæ‰§è¡Œï¼›<br><code>nextListeners</code> å°±æ˜¯å‚¨å­˜å½“å‰ç›‘å¬å‡½æ•°çš„åˆ—è¡¨ï¼Œè°ƒç”¨ <code>subscribe</code>ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šç»™ <code>nextListeners</code> åˆ—è¡¨ <code>push</code> è¿™ä¸ªå‡½æ•°ï¼›<br>åŒæ—¶è°ƒç”¨ <code>subscribe</code> å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª <code>unsubscribe</code> å‡½æ•°ï¼Œç”¨æ¥è§£ç»‘å½“å‰ä¼ å…¥çš„å‡½æ•°ï¼ŒåŒæ—¶åœ¨ <code>subscribe</code> å‡½æ•°å®šä¹‰äº†ä¸€ä¸ª <code>isSubscribed</code> æ ‡å¿—å˜é‡æ¥åˆ¤æ–­å½“å‰çš„è®¢é˜…æ˜¯å¦å·²ç»è¢«è§£ç»‘ï¼Œè§£ç»‘çš„æ“ä½œå°±æ˜¯ä» <code>nextListeners</code> åˆ—è¡¨ä¸­åˆ é™¤å½“å‰çš„ç›‘å¬å‡½æ•°ã€‚</p>
<h5 id="dispatch">dispatch</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isPlainObject(action)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'Actions must be plain objects. '</span> +</span><br><span class="line">      <span class="string">'Use custom middleware for async actions.'</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­ action æ˜¯å¦æœ‰ typeï½›å¿…é¡»ï½ å±æ€§</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> action.type === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'Actions may not have an undefined "type" property. '</span> +</span><br><span class="line">      <span class="string">'Have you misspelled a constant?'</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœæ­£åœ¨ dispatch åˆ™æŠ›å‡ºé”™è¯¯</span></span><br><span class="line">  <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Reducers may not dispatch actions.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹æŠ›å‡º error çš„å…¼å®¹ï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•éƒ½ä¼šç»§ç»­æ‰§è¡Œ isDispatching = false çš„æ“ä½œ</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    isDispatching = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ currentReducer æ¥æ“ä½œä¼ å…¥ å½“å‰çŠ¶æ€å’Œactionï¼Œæ”¾å›å¤„ç†åçš„çŠ¶æ€</span></span><br><span class="line">    currentState = currentReducer(currentState, action)</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    isDispatching = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> listeners = currentListeners = nextListeners</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> listener = listeners[i]</span><br><span class="line">    listener()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> action</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥è§¦å‘çŠ¶æ€æ”¹å˜çš„ï¼Œä»–æ¥å—ä¸€ä¸ª action å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç„¶å reducer æ ¹æ® action çš„å±æ€§ ä»¥åŠ å½“å‰ store çš„çŠ¶æ€æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œèµ‹äºˆå½“å‰çŠ¶æ€ï¼Œæ”¹å˜ store çš„çŠ¶æ€ï¼›<br>å³ <code>currentState = currentReducer(currentState, action)</code>ï¼›<br>è¿™é‡Œçš„ <code>currentReducer</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»–æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šå½“å‰çŠ¶æ€ å’Œ actionï¼Œç„¶åè¿”å›è®¡ç®—å‡ºæ¥çš„æ–°çš„çŠ¶æ€ï¼›<br>ç„¶åéå† <code>nextListeners</code> åˆ—è¡¨ï¼Œè°ƒç”¨æ¯ä¸ªç›‘å¬å‡½æ•°ï¼›</p>
<h5 id="replaceReducer">replaceReducer</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceReducer</span>(<span class="params">nextReducer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å‚æ•°æ˜¯å¦æ˜¯å‡½æ•°ç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> nextReducer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the nextReducer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  currentReducer = nextReducer</span><br><span class="line">  dispatch(&#123; type: ActionTypes.INIT &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°å¯ä»¥æ›¿æ¢ store å½“å‰çš„ reducer å‡½æ•°ï¼Œé¦–å…ˆç›´æ¥æŠŠ <code>currentReducer = nextReducer</code>ï¼Œç›´æ¥æ›¿æ¢ï¼›<br>ç„¶å <code>dispatch({ type: ActionTypes.INIT })</code> ï¼Œç”¨æ¥åˆå§‹åŒ–æ›¿æ¢å reducer ç”Ÿæˆçš„åˆå§‹åŒ–çŠ¶æ€å¹¶ä¸”èµ‹äºˆ store çš„çŠ¶æ€ï¼›</p>
<h5 id="observable">observable</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observable</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> outerSubscribe = subscribe</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    subscribe(observer) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> observer !== <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Expected the observer to be an object.'</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">observeState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (observer.next) &#123;</span><br><span class="line">          observer.next(getState())</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      observeState()</span><br><span class="line">      <span class="keyword">var</span> unsubscribe = outerSubscribe(observeState)</span><br><span class="line">      <span class="keyword">return</span> &#123; unsubscribe &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    [$$observable]() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºè¿™ä¸ªå‡½æ•°ï¼Œæ˜¯ä¸ç›´æ¥æš´éœ²ç»™å¼€å‘è€…çš„ï¼Œå®ƒæä¾›äº†ç»™å…¶ä»–è§‚å¯Ÿè€…æ¨¡å¼ï¼å“åº”å¼åº“çš„äº¤äº’æ“ä½œï¼Œå…·ä½“å¯çœ‹ <a href="https://github.com/zenparsing/es-observable" target="_blank" rel="external">https://github.com/zenparsing/es-observable</a></p>
<h5 id="last">last</h5><p>æœ€åæ‰§è¡Œ <code>dispatch({ type: ActionTypes.INIT })</code>ï¼Œç”¨æ¥æ ¹æ® reducer åˆå§‹åŒ– store çš„çŠ¶æ€ã€‚</p>
<h1 id="compose-js">compose.js</h1><p><code>compose</code> å¯ä»¥æ¥å—ä¸€ç»„å‡½æ•°å‚æ•°ï¼Œä»å³åˆ°å·¦æ¥ç»„åˆå¤šä¸ªå‡½æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªç»„åˆå‡½æ•°ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arg =&gt; arg</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> last = funcs[funcs.length - <span class="number">1</span>]</span><br><span class="line">  <span class="keyword">const</span> rest = funcs.slice(<span class="number">0</span>, -<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">return</span> (...args) =&gt; rest.reduceRight((composed, f) =&gt; f(composed), last(...args))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="applyMiddleware-js">applyMiddleware.js</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">...middlewares</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™ä¸ªè¿”å›çš„å‡½æ•°å°±æ˜¯ enhancerï¼Œæ¥å— createStore å‡½æ•°ï¼Œå†è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—çš„å…¶å®åªæœ‰ reducer å’Œ preloadedStateï¼›</span></span><br><span class="line">  <span class="keyword">return</span> (createStore) =&gt; (reducer, preloadedState, enhancer) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> store = createStore(reducer, preloadedState, enhancer)</span><br><span class="line">    <span class="keyword">var</span> dispatch = store.dispatch</span><br><span class="line">    <span class="keyword">var</span> chain = []</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æš´æ¼ getState å’Œ dispatch ç»™ ç¬¬ä¸‰æ–¹ä¸­é—´ä»·ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">var</span> middlewareAPI = &#123;</span><br><span class="line">      getState: store.getState,</span><br><span class="line">      dispatch: (action) =&gt; dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›é€ ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ä½¿ç”¨ middlewareAPI åè¿”å›çš„å‡½æ•°ç»„æˆçš„æ•°ç»„</span></span><br><span class="line">    chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»“åˆè¿™ä¸€ç»„å‡½æ•° å’Œ dispatch ç»„æˆçš„æ–°çš„ dispatchï¼Œç„¶åè¿™ä¸ªæš´æ¼ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œè€ŒåŸæœ‰çš„ store.dispatch æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯ä¸æš´æ¼</span></span><br><span class="line">    dispatch = compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>applyMiddleware</code> å‡½æ•°çš„ä½œç”¨æ˜¯ç»„åˆ å¤šä¸ª ä¸­é—´ä»¶ç­‰ç­‰ï¼Œç„¶åè¿”å›ä¸€ä¸ªå‡½æ•°ï¼ˆ<code>enhancer</code>ï¼‰</p>
<p>è¿˜è®°å¾—åœ¨ <code>createStore</code> ä¸­çš„ä¸€æ®µå—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ <code>enhancer === applyMiddleware(...)</code>ï¼›</p>
<p>ç„¶åå†æ‰§è¡Œ <code>enhancer(createStore)</code> ç»§ç»­ä¹‹åçš„æ“ä½œï¼›</p>
<p>è¿™é‡Œ <code>enhancer(createStore) ç­‰åŒäº (reducer, preloadedState, enhancer) =&gt; { ... }</code></p>
<p>ç„¶åå†æ‰§è¡Œ <code>enhancer(createStore)(reducer, preloadedState)</code>ï¼›</p>
<p>å†å›åˆ° <code>applyMiddleware</code> ï¼Œè¿™é‡Œè°ƒç”¨äº† <code>var store = createStore(reducer, preloadedState, enhancer)</code> ï¼›<br>å¦‚ä¸Šæ‰€è§ï¼Œè¿™é‡Œæ‰§è¡Œçš„æ—¶å€™å·²ç»æ²¡æœ‰ <code>enhancer</code> å‚æ•°äº†ï¼Œå› æ­¤ä¼šå†æ¬¡æ‰§è¡Œ <code>createStore</code> å‡½æ•°çš„å…¨éƒ¨éƒ¨åˆ†ï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªè¿”å›çš„å®ä¾‹ <code>store</code>ï¼›</p>
<p>ä¹‹åä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>dispatch</code> ï¼Œå…ˆä¿å­˜ä¸‹æ¥åŸç”Ÿçš„ <code>dispatch</code> ï¼š <code>var dispatch = store.dispatch</code>ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> middlewareAPI = &#123;</span><br><span class="line">  getState: store.getState,</span><br><span class="line">  dispatch: (action) =&gt; dispatch(action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥æ˜¯æŠŠ store çš„ <code>getState</code> å’Œ <code>dispatch</code> æ¥å£æš´éœ²ç»™ä¸­é—´ä»¶æ¥æ“ä½œï¼š <code>chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</code>ï¼›</p>
<p>æœ€åç»„åˆ å…¨éƒ¨ä¸­é—´ä»¶çš„è¿”å›å€¼ï¼ˆå‡½æ•°ï¼‰<code>chain</code> å’Œ <code>store.dispatch</code>ï¼Œç„¶åè¿”å›æ–°çš„ <code>dispatch</code> ï¼š <code>dispatch = compose(...chain)(store.dispatch)</code></p>
<p>è¿™é‡Œçš„ <code>dispatch</code> å¹¶ä¸æ˜¯åŸæœ‰çš„ store çš„ï¼Œè€Œæ˜¯ç»è¿‡ç»„åˆä¸­é—´ä»¶ä¹‹åæ–°çš„ <code>dispatch</code>ï¼›</p>
<p>æœ€åè¿”å›æš´éœ²ç»™ç”¨æˆ·çš„æ¥å£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  ...store,</span><br><span class="line">  dispatch</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦è¿˜æ˜¯ store åŸæœ‰çš„æ¥å£ï¼Œä½†æ˜¯ç”¨æ–°çš„ dispatch æ›¿æ¢äº†åŸæœ‰çš„ï¼›</p>
<p><strong>è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯æ ¹æ®ä¸­é—´ä»¶å’Œstoreçš„æ¥å£ç”Ÿæˆæ–°çš„ dispatch ç„¶åæš´éœ²ç»™ç”¨æˆ·</strong></p>
<h1 id="combineReducers-js">combineReducers.js</h1><p>è¿™ä¸ªå‡½æ•°å¯ä»¥ç»„åˆä¸€ç»„ reducers(å¯¹è±¡) ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ reducer å‡½æ•°ç»™ <code>createStore</code> ä½¿ç”¨ã€‚</p>
<p>å®ƒæ¥å—ä¸€ç»„ reducers ç»„æˆçš„å¯¹è±¡ï¼Œå¯¹è±¡çš„ key æ˜¯å¯¹åº” valueï¼ˆreducerå‡½æ•°ï¼‰çš„çŠ¶æ€åç§°ï¼›</p>
<p>æ¯”å¦‚ï¼š <code>{ userInfo: getUserInfo, list: getList }</code></p>
<p><code>userInfo</code> æ˜¯æ ¹æ® <code>getUserInfo</code> å‡½æ•°è®¡ç®—å‡ºæ¥çš„ï¼›</p>
<p>é‚£ä¹ˆ store é‡Œé¢çš„ state ç»“æ„å°±ä¼šæ˜¯: <code>{ userInfo: ..., list: ... }</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ® reducers ç”Ÿæˆæœ€ç»ˆåˆæ³•çš„ finalReducersï¼švalue ä¸º å‡½æ•°</span></span><br><span class="line">  <span class="keyword">var</span> reducerKeys = <span class="built_in">Object</span>.keys(reducers)</span><br><span class="line">  <span class="keyword">var</span> finalReducers = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = reducerKeys[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        warning(<span class="string">`No reducer provided for key "<span class="subst">$&#123;key&#125;</span>"`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'function'</span>) &#123;</span><br><span class="line">      finalReducers[key] = reducers[key]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> finalReducerKeys = <span class="built_in">Object</span>.keys(finalReducers)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> unexpectedKeyCache = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éªŒè¯ reducer æ˜¯å¦åˆæ³•</span></span><br><span class="line">  <span class="keyword">var</span> sanityError</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    assertReducerSanity(finalReducers)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    sanityError = e</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›æœ€ç»ˆç”Ÿæˆçš„ reducer</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sanityError) &#123;</span><br><span class="line">      <span class="keyword">throw</span> sanityError</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache)</span><br><span class="line">      <span class="keyword">if</span> (warningMessage) &#123;</span><br><span class="line">        warning(warningMessage)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> hasChanged = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> nextState = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> key = finalReducerKeys[i]</span><br><span class="line">      <span class="keyword">var</span> reducer = finalReducers[key]</span><br><span class="line">      <span class="keyword">var</span> previousStateForKey = state[key]</span><br><span class="line">      <span class="keyword">var</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> nextStateForKey === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(errorMessage)</span><br><span class="line">      &#125;</span><br><span class="line">      nextState[key] = nextStateForKey</span><br><span class="line">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// éå†ä¸€éçœ‹æ˜¯å¦æ”¹å˜ï¼Œç„¶åè¿”å›åŸæœ‰çŠ¶æ€å€¼æˆ–è€…æ–°çš„çŠ¶æ€å€¼</span></span><br><span class="line">    <span class="keyword">return</span> hasChanged ? nextState : state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆè¿”å›ä¸€ä¸ª <code>combination</code> ä¹Ÿå°±æ˜¯çœŸæ­£ä¼ å…¥ <code>createStore</code> çš„ reducer å‡½æ•°ï¼›</p>
<p>è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ reducer å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªåˆå§‹åŒ–çŠ¶æ€ å’Œ ä¸€ä¸ª action å‚æ•°ï¼›</p>
<p>æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™ä¼šå»éå† <code>finalReducer</code> ï¼ˆæœ‰æ•ˆçš„ reducer åˆ—è¡¨ï¼‰ï¼Œè·å–åˆ—è¡¨ä¸­æ¯ä¸ª reducer å¯¹åº”çš„å…ˆå‰çŠ¶æ€ï¼š <code>var previousStateForKey = state[key]</code>ï¼›<br>çœ‹åˆ°è¿™é‡Œå°±åº”è¯¥æ˜ç™½ä¼ å…¥çš„ <code>reducers</code> ç»„åˆä¸ºä»€ä¹ˆ <code>key</code> è¦å’Œ store é‡Œé¢çš„ state çš„ <code>key</code> ç›¸å¯¹åº”ï¼›</p>
<p>ç„¶åå¾—åˆ°å½“å‰éå†é¡¹çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼š <code>var nextStateForKey = reducer(previousStateForKey, action)</code> ï¼›<br>ç„¶åæŠŠå®ƒæ·»åŠ åˆ°æ•´ä½“çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼š <code>nextState[key] = nextStateForKey</code></p>
<p>æ¯æ¬¡éå†ä¼šåˆ¤æ–­æ•´ä½“çŠ¶æ€æ˜¯å¦æ”¹å˜ï¼š <code>hasChanged = hasChanged || nextStateForKey !== previousStateForKey</code></p>
<p>åœ¨æœ€åï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜å°±è¿”å›åŸæœ‰çŠ¶æ€ï¼Œå¦‚æœæ”¹å˜äº†å°±è¿”å›æ–°ç”Ÿæˆçš„çŠ¶æ€å¯¹è±¡ï¼š <code>return hasChanged ? nextState : state</code>ã€‚</p>
<h1 id="bindActionCreators-js">bindActionCreators.js</h1><p><code>bindActionCreators</code> å‡½æ•°å¯ä»¥ç”Ÿæˆç›´æ¥è§¦å‘ action çš„å‡½æ•°ï¼›</p>
<p>å®è´¨ä¸Šå®ƒåªè¯´åšäº†è¿™ä¹ˆä¸€ä¸ªæ“ä½œ <code>bindActionFoo = (...args) =&gt; dispatch(actionCreator(...args))</code></p>
<p>å› æ­¤æˆ‘ä»¬ç›´æ¥è°ƒç”¨ <code>bindActionFoo</code> å‡½æ•°å°±å¯ä»¥æ”¹å˜çŠ¶æ€äº†ï¼›</p>
<p>æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ <code>actionCreatorsï¼ˆ</code> actionCreator ç»„æˆçš„å¯¹è±¡ï¼Œkey å¯¹äºç”Ÿæˆçš„å‡½æ•°åï¼æˆ–è€…æ˜¯ä¸€ä¸ª actionCreator ï¼‰ï¼Œä¸€ä¸ªæ˜¯ <code>dispatchï¼Œ</code> store å®ä¾‹ä¸­è·å–ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (...args) =&gt; dispatch(actionCreator(...args))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreators, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç›´æ¥è¿”å›ä¸€ä¸ª bindActionCreator å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è°ƒç”¨ dispatch è§¦å‘ action</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> bindActionCreator(actionCreators, dispatch)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators !== <span class="string">'object'</span> || actionCreators === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`bindActionCreators expected an object or a function, instead received <span class="subst">$&#123;actionCreators === null ? 'null' : typeof actionCreators&#125;</span>. `</span> +</span><br><span class="line">      <span class="string">`Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†å¯¹è±¡ï¼Œç„¶åå¯¹æ¯ä¸ªéå†é¡¹çš„ actionCreator ç”Ÿæˆå‡½æ•°ï¼Œå°†å‡½æ•°æŒ‰ç…§åŸæ¥çš„ key å€¼æ”¾åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œæœ€åè¿”å›è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(actionCreators)</span><br><span class="line">  <span class="keyword">var</span> boundActionCreators = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = keys[i]</span><br><span class="line">    <span class="keyword">var</span> actionCreator = actionCreators[key]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator === <span class="string">'function'</span>) &#123;</span><br><span class="line">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> boundActionCreators</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“">æ€»ç»“</h1><p>é˜…è¯»äº†ä¸€é Redux çš„æºç ï¼Œå®åœ¨æ˜¯å¤ªç²¾å¦™äº†ï¼Œå°‘ä¾èµ–ï¼Œå°‘è€¦åˆï¼Œçº¯å‡½æ•°å¼ã€‚</p>
</div>

    <div class="post-sidebar">
  <div class="toggle-btn" id="toggle-btn">
    <i class="fa fa-reorder"></i>
  </div>
  <section class="post-toc-wrap" id="post-sidebar">
    <h2 class="toc-title">å†…å®¹ç›®å½•</h2>
    <div class="post-toc">
      
      
        <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#TIP"><span class="nav-text">TIP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æºç ç»“æ„"><span class="nav-text">æºç ç»“æ„</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#index-js"><span class="nav-text">index.js</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#createStore-js"><span class="nav-text">createStore.js</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#createStore"><span class="nav-text">createStore</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#æ¥å—"><span class="nav-text">æ¥å—</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#è¿”å›"><span class="nav-text">è¿”å›</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#enhancer"><span class="nav-text">enhancer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#getState"><span class="nav-text">getState</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#subscribe"><span class="nav-text">subscribe</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#dispatch"><span class="nav-text">dispatch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#replaceReducer"><span class="nav-text">replaceReducer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#observable"><span class="nav-text">observable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#last"><span class="nav-text">last</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#compose-js"><span class="nav-text">compose.js</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#applyMiddleware-js"><span class="nav-text">applyMiddleware.js</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#combineReducers-js"><span class="nav-text">combineReducers.js</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#bindActionCreators-js"><span class="nav-text">bindActionCreators.js</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ€»ç»“"><span class="nav-text">æ€»ç»“</span></a></li></ol></div>
      
    </div>
  </section>
</div>


  </div>

  <footer class="post-footer">
    
      <div class="post-tags">
        
          <a href="/tags#JavaScript" rel="tag">#JavaScript</a>
        
          <a href="/tags#Redux" rel="tag">#Redux</a>
        
      </div>
    
    
  <style>
    .donation {
      width: 100%;
      margin-top: 2rem;
    }
    .donation .text {
      color: #333;
      font-size: .8rem;
      cursor: pointer;
      text-decoration: underline;
    }
    .donation .text:hover {
      color: rgb(63,134,181);
    }
    .donation .img-box {
      transition: all .3s;
      width: 0;
      height: 0;
      margin: 1rem auto;
      overflow: hidden;
    }
    .donation .img-box img {
      width: 100%;
      height: 100%;
    }
    .donation #donation {
      display: none;
    }
    .donation #donation:checked + .img-box {
      width: 16rem;
      height: 16rem;
    }
  </style>
  <div class="donation">
    <label class="text" for="donation">
      å¦‚æœä½ è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¹¶ä¸”æƒ³ä¸ºæˆ‘ä¹°ä¸€æ¯å’–å•¡ï¼Œç‚¹è¿™é‡Œï½
    </label>
    <input type="checkbox" name="donation" id="donation">
    <div class="img-box">
      <img src="/img/donation.png" alt="donation" />
    </div>
  </div>


  </footer>

</article>




      
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="post/read-the-source-code-of-Rudex.html"
           data-title="è§£æ Redux æºç " data-url="http://qiutc.me/post/read-the-source-code-of-Rudex.html">
      </div>
    
  </div>




    </main>

    <footer class="footer clearfix">
  <div class="copyright" >
    <span>Copyright</span>
    
    &copy;  2015-
    <span itemprop="copyrightYear">2016</span>
    <span class="author" itemprop="copyrightHolder">é˜¿åŸğŸ˜‡</span>
  </div>

  <div class="info">
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
      <span id="showDays" class="show-days"></span>
      <script>
      var birthDay = new Date('10/04/2015');
      var now = new Date();
      var duration = now.getTime() - birthDay.getTime();
      var total= Math.floor(duration / (1000 * 60 * 60 * 24));
      document.getElementById("showDays").innerHTML = "æœ¬ç«™å·²è¿è¡Œ "+total+" å¤©";
      </script>
      ---
    
    <span id="busuanzi_container_site_pv">
        æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
    </span>
  </div>

  <div class="my-theme">
    Theme by <a href="//qiutc.me">qiutc</a> | <iframe style="margin-left: 5px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=TongchengQiu&amp;repo=hexo-theme-another&amp;type=star&amp;count=true"></iframe>
  </div>

</footer>


  </div>

  <div class="back-top-btn" id="back-top-btn"><i class="fa fa-chevron-up"></i></div>





  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"qiutongcheng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     






<script type="text/javascript" src="/js/motto.min.js?v=0.0.2"></script>
<script type="text/javascript" src="/js/main.js?v=0.0.2"></script>


</body>
</html>
