<!DOCTYPE html>
<html lang="en">
<head>
  <!-- content-Type -->
<meta charset="utf-8">


<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="language" content="en">
<meta name="robots" content="all">


<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="email=no" name="format-detection">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



<meta name="author" content="theme.author, theme.email">
<meta name="reply-to" content="theme.email">
<meta name="owner" content="theme.author">




<meta name="google-site-verification" content="UA-78049587-1" />




<meta name="baidu-site-verification" content="fRBucd9VmI" />




<meta name="baidu-gxt-verify-token" content="ca8f032797b876ef3be37c3d492168a0" />




<meta name="description" content="hello word! ğŸ˜º" />




<meta name="keywords" content="è·¨åŸŸ," />


<meta name="description" content="è·¨åŸŸæ•´ç†è·¨åŸŸèµ„æºå…±äº« CORSå¯¹äºwebå¼€å‘æ¥è®²ï¼Œç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸ä½¿ç”¨ä¸€äº›hackçš„æ–¹æ³•å»è·¨åŸŸè·å–èµ„æºï¼Œä½†æ˜¯hackçš„æ–¹æ³•æ€»å½’æ˜¯hackã€‚ç›´åˆ°W3Cå‡ºäº†ä¸€ä¸ªæ ‡å‡†ï¼CORSï¼â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚é¦–å…ˆæ¥è¯´ CORS éœ€è¦æµè§ˆ">
<meta property="og:type" content="article">
<meta property="og:title" content="å‰ç«¯è·¨åŸŸçš„æ•´ç†">
<meta property="og:url" content="http://qiutc.me/post/cross-domain-collections.html">
<meta property="og:site_name" content="é˜¿åŸçš„blog">
<meta property="og:description" content="è·¨åŸŸæ•´ç†è·¨åŸŸèµ„æºå…±äº« CORSå¯¹äºwebå¼€å‘æ¥è®²ï¼Œç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸ä½¿ç”¨ä¸€äº›hackçš„æ–¹æ³•å»è·¨åŸŸè·å–èµ„æºï¼Œä½†æ˜¯hackçš„æ–¹æ³•æ€»å½’æ˜¯hackã€‚ç›´åˆ°W3Cå‡ºäº†ä¸€ä¸ªæ ‡å‡†ï¼CORSï¼â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚é¦–å…ˆæ¥è¯´ CORS éœ€è¦æµè§ˆ">
<meta property="og:image" content="http://qiutc.me/img/cross-domain-cors.png">
<meta property="og:image" content="http://qiutc.me/img/cross-domain-postmessage.png">
<meta property="og:updated_time" content="2016-08-10T11:35:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å‰ç«¯è·¨åŸŸçš„æ•´ç†">
<meta name="twitter:description" content="è·¨åŸŸæ•´ç†è·¨åŸŸèµ„æºå…±äº« CORSå¯¹äºwebå¼€å‘æ¥è®²ï¼Œç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸ä½¿ç”¨ä¸€äº›hackçš„æ–¹æ³•å»è·¨åŸŸè·å–èµ„æºï¼Œä½†æ˜¯hackçš„æ–¹æ³•æ€»å½’æ˜¯hackã€‚ç›´åˆ°W3Cå‡ºäº†ä¸€ä¸ªæ ‡å‡†ï¼CORSï¼â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚é¦–å…ˆæ¥è¯´ CORS éœ€è¦æµè§ˆ">






  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.0.1" />






<link href="http://cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.0.1"/>


<script>
(function(){
  var bp = document.createElement('script');
  bp.src = '//push.zhanzhang.baidu.com/push.js';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>

  <title> å‰ç«¯è·¨åŸŸçš„æ•´ç† </title>
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-78049587-1', 'auto');
  ga('send', 'pageview');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?47d302b006bf28a09c22990da53cd3da";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



</head>
<body lang="zh-Hans">

  <!--[if lte IE 9]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->


  <div class="another-theme layout">

    
<header class="header" id="header" style="background: url(/img/cross-domain.jpg) center / cover">

  <div class="header-cont">
    <div class="text-area">
      
        <h1 class="title" data-text="å‰ç«¯è·¨åŸŸçš„æ•´ç†"> å‰ç«¯è·¨åŸŸçš„æ•´ç† </h1>

        
        <div class="post-meta">
          <div class="post-time">
            å‘è¡¨äº
            <time  datetime="2016-05-17T02:09:20+08:00" content="2016-05-17">
              2016-05-17
            </time>
          </div>

          
            <div class="post-category" >
              
                <span>
                  <a href="/categories#è·¨åŸŸ" itemprop="url" rel="index">
                    <span itemprop="name">è·¨åŸŸ</span>
                  </a>
                </span>

                
                

              
            </div>
          

          
            
              <span class="post-comments-count">
                <a href="/post/cross-domain-collections.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="post/cross-domain-collections.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          
        </div>
        
      
    </div>
    <!-- Navigation -->
    
    <nav class="navigation clearfix" id="navigation">
      
        
        <a class="nav-link" href="/" rel="section">
          é¦–é¡µ
        </a>
      
        
        <a class="nav-link" href="/categories" rel="section">
          åˆ†ç±»
        </a>
      
        
        <a class="nav-link" href="/tags" rel="section">
          æ ‡ç­¾
        </a>
      
        
        <a class="nav-link" href="/about" rel="section">
          å…³äº
        </a>
      
    </nav>
    
  </div>
  <div class="mask"></div>
</header>


    <main class="container">

      

  <article class="post-article post-type-normal post" itemscope>

  <div class="post-body">

    <div class="content markdown-body"><h1 id="è·¨åŸŸæ•´ç†">è·¨åŸŸæ•´ç†</h1><h1 id="è·¨åŸŸèµ„æºå…±äº«_CORS">è·¨åŸŸèµ„æºå…±äº« CORS</h1><p>å¯¹äºwebå¼€å‘æ¥è®²ï¼Œç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸ä½¿ç”¨ä¸€äº›hackçš„æ–¹æ³•å»è·¨åŸŸè·å–èµ„æºï¼Œä½†æ˜¯hackçš„æ–¹æ³•æ€»å½’æ˜¯hackã€‚ç›´åˆ°W3Cå‡ºäº†ä¸€ä¸ªæ ‡å‡†ï¼CORSï¼â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚<br>å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚<br>é¦–å…ˆæ¥è¯´ CORS éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¯æŒçš„ï¼Œå¯¹äºå…¼å®¹æ€§æ¥è¯´ä¸»è¦æ˜¯ie10+ï¼Œå…¶å®ƒç°ä»£æµè§ˆå™¨éƒ½æ˜¯æ”¯æŒçš„ã€‚<br><a href="http://caniuse.com/#feat=cors" target="_blank" rel="external">http://caniuse.com/#feat=cors</a><br><img src="/img/cross-domain-cors.png" alt="cross-domain-cors"><br>ä½¿ç”¨ CORS è·¨åŸŸçš„æ—¶å€™å…¶å®å’Œæ™®é€šçš„ ajax è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æµè§ˆå™¨åœ¨å‘ç°è¿™æ˜¯ä¸€ä¸ªè·¨åŸŸè¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†ä¸€äº›äº‹ï¼Œæ¯”å¦‚éªŒè¯ç­‰ç­‰ï¼Œæ‰€ä»¥è¯´åªè¦æœåŠ¡ç«¯æä¾›æ”¯æŒï¼Œå‰ç«¯æ˜¯ä¸éœ€è¦åšé¢å¤–çš„äº‹æƒ…çš„ã€‚</p>
<h2 id="ä¸¤ç§è¯·æ±‚">ä¸¤ç§è¯·æ±‚</h2><p>CORS çš„è¯·æ±‚åˆ†ä¸¤ç§ï¼Œè¿™ä¹Ÿæ˜¯æµè§ˆå™¨ä¸ºäº†å®‰å…¨åšçš„ä¸€äº›å¤„ç†ï¼Œä¸åŒæƒ…å†µä¸‹æµè§ˆå™¨æ‰§è¡Œçš„æ“ä½œä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç§è¯·æ±‚ï¼Œå½“ç„¶è¿™ä¸€åˆ‡æˆ‘ä»¬æ˜¯ä¸éœ€è¦åšé¢å¤–å¤„ç†çš„ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¤„ç†çš„ã€‚</p>
<h2 id="ç®€å•è¯·æ±‚ï¼ˆsimple_requestï¼‰">ç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰</h2><p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚</p>
<h3 id="æ¡ä»¶">æ¡ä»¶</h3><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¸­çš„ä¸€ä¸ªï¼š</span><br><span class="line">HEAD</span><br><span class="line"><span class="literal">GET</span></span><br><span class="line"><span class="keyword">POST</span></span><br><span class="line">2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</span><br><span class="line">Accept</span><br><span class="line">Accept-Language</span><br><span class="line">Content-Language</span><br><span class="line">Last-Event-ID</span><br><span class="line">Content-<span class="keyword">Type</span>ï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-<span class="keyword">form</span>-urlencodedã€multipart/<span class="keyword">form</span>-dataã€text/plain</span><br></pre></td></tr></table></figure>
<h3 id="è¿‡ç¨‹">è¿‡ç¨‹</h3><p>å¯¹äºç®€å•çš„è·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚çš„å¤´ä¿¡æ¯åŠ ä¸Š <code>Origin</code> å­—æ®µï¼Œè¡¨ç¤ºæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ï¼ŒæœåŠ¡ç«¯ä¼šè·å–åˆ°è¿™ä¸ªå€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚å¹¶è¿”å›ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚</span></span><br><span class="line">GET <span class="regexp">/cors HTTP/</span><span class="number">1.1</span></span><br><span class="line"><span class="string">Origin:</span> <span class="string">http:</span><span class="comment">//api.qiutc.me</span></span><br><span class="line"><span class="string">Host:</span> api.alice.com</span><br><span class="line">Accept-<span class="string">Language:</span> en-US</span><br><span class="line"><span class="string">Connection:</span> keep-alive</span><br><span class="line">User-<span class="string">Agent:</span> Mozilla/<span class="number">5.0</span>...</span><br></pre></td></tr></table></figure>
<h4 id="1-æœåŠ¡ç«¯å…è®¸">1.æœåŠ¡ç«¯å…è®¸</h4><p>å¦‚æœæœåŠ¡ç«¯è®¸å¯æœ¬æ¬¡è¯·æ±‚ï¼Œå°±ä¼šåœ¨è¿”å›çš„å¤´ä¿¡æ¯å¤šå‡ºå‡ ä¸ªå­—æ®µï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿”å›</span></span><br><span class="line">Access-Control-Allow-<span class="string">Origin:</span> <span class="string">http:</span><span class="comment">//api.qiutc.me</span></span><br><span class="line">Access-Control-Allow-<span class="string">Credentials:</span> <span class="literal">true</span></span><br><span class="line">Access-Control-Expose-<span class="string">Headers:</span> Info</span><br><span class="line">Content-<span class="string">Type:</span> text/html; charset=utf-<span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸‰ä¸ªå¸¦æœ‰ <code>Access-Control</code> å¼€å¤´çš„å­—æ®µåˆ†åˆ«è¡¨ç¤ºï¼š</p>
<ul>
<li>Access-Control-Allow-Origin<br>å¿…é¡»ã€‚å®ƒçš„å€¼æ˜¯è¯·æ±‚æ—¶Originå­—æ®µçš„å€¼æˆ–è€… <code>*</code>ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚</li>
<li>Access-Control-Allow-Credentialsï¼›<br>å¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸ºtrueï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookieå¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚<br>å†éœ€è¦å‘é€cookieçš„æ—¶å€™è¿˜éœ€è¦æ³¨æ„è¦åœ¨AJAXè¯·æ±‚ä¸­æ‰“å¼€withCredentialså±æ€§ï¼š<code>var xhr = new XMLHttpRequest(); xhr.withCredentials = true;</code><br><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼Œå¦‚æœè¦å‘é€Cookieï¼ŒAccess-Control-Allow-Originå°±ä¸èƒ½è®¾ä¸º<code>*</code>ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookieä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„Cookieæ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„Cookieå¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”åŸç½‘é¡µä»£ç ä¸­çš„<code>document.cookie</code>ä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„Cookieã€‚</li>
<li>Access-Control-Expose-Headers<br>å¯é€‰ã€‚CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„<code>getResponseHeader()</code>æ–¹æ³•åªèƒ½æ‹¿åˆ°6ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨Access-Control-Expose-Headersé‡Œé¢æŒ‡å®šã€‚ä¸Šé¢çš„ä¾‹å­æŒ‡å®šï¼Œ<code>getResponseHeader(&#39;Info&#39;)</code>å¯ä»¥è¿”å›Infoå­—æ®µçš„å€¼ã€‚</li>
</ul>
<h4 id="2-æœåŠ¡ç«¯æ‹’ç»">2.æœåŠ¡ç«¯æ‹’ç»</h4><p>å½“ç„¶æˆ‘ä»¬ä¸ºäº†é˜²æ­¢æ¥å£è¢«ä¹±è°ƒç”¨ï¼Œéœ€è¦é™åˆ¶æºï¼Œå¯¹äºä¸å…è®¸çš„æºï¼ŒæœåŠ¡ç«¯è¿˜æ˜¯ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”ï¼Œä½†æ˜¯ä¸ä¼šå¸¦ä¸Š <code>Access-Control-Allow-Origin</code> å­—æ®µï¼Œæµè§ˆå™¨å‘ç°è¿™ä¸ªè·¨åŸŸè¯·æ±‚çš„è¿”å›å¤´ä¿¡æ¯æ²¡æœ‰è¯¥å­—æ®µï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œä¼šè¢« <code>XMLHttpRequest</code> çš„ <code>onerror</code> å›è°ƒæ•è·åˆ°ã€‚<br><strong>è¿™ç§é”™è¯¯æ— æ³•é€šè¿‡ HTTP çŠ¶æ€ç åˆ¤æ–­ï¼Œå› ä¸ºå›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯200</strong></p>
<h2 id="éç®€å•è¯·æ±‚">éç®€å•è¯·æ±‚</h2><h3 id="æ¡ä»¶-1">æ¡ä»¶</h3><p>å‡ºäº†ç®€å•è¯·æ±‚ä»¥å¤–çš„CORSè¯·æ±‚ã€‚<br>éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯PUTæˆ–DELETEï¼Œæˆ–è€…Content-Typeå­—æ®µçš„ç±»å‹æ˜¯application/jsonã€‚</p>
<h3 id="è¿‡ç¨‹-1">è¿‡ç¨‹</h3><h4 id="1ï¼‰é¢„æ£€è¯·æ±‚">1ï¼‰é¢„æ£€è¯·æ±‚</h4><p>éç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚<br>æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚<br>é¢„æ£€è¯·æ±‚çš„å‘é€è¯·æ±‚ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="request">OPTIONS <span class="string">/cors</span> HTTP/1.1</span></span><br><span class="line"><span class="attribute">Origin</span>: <span class="string">http://api.qiutc.me</span></span><br><span class="line"><span class="attribute">Access-Control-Request-Method</span>: <span class="string">PUT</span></span><br><span class="line"><span class="attribute">Access-Control-Request-Headers</span>: <span class="string">X-Custom-Header</span></span><br><span class="line"><span class="attribute">Host</span>: <span class="string">api.qiutc.com</span></span><br><span class="line"><span class="attribute">Accept-Language</span>: <span class="string">en-US</span></span><br><span class="line"><span class="attribute">Connection</span>: <span class="string">keep-alive</span></span><br><span class="line"><span class="attribute">User-Agent</span>: <span class="string">Mozilla/5.0...</span></span><br></pre></td></tr></table></figure>
<p>â€œé¢„æ£€â€è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯OPTIONSï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ®µæ˜¯Originï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚<br>é™¤äº†Originå­—æ®µï¼Œâ€é¢„æ£€â€è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚</p>
<ul>
<li>Access-Control-Request-Method<br>è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„CORSè¯·æ±‚ä¼šç”¨åˆ°å“ªäº›HTTPæ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯PUTã€‚</li>
<li><p>Access-Control-Request-Headers<br>è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨CORSè¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šä¾‹æ˜¯X-Custom-Headerã€‚<br>é¢„æ£€è¯·æ±‚çš„è¿”å›ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="status">HTTP/1.1 <span class="number">200</span> OK</span></span><br><span class="line"><span class="attribute">Date</span>: <span class="string">Mon, 01 Dec 2008 01:15:39 GMT</span></span><br><span class="line"><span class="attribute">Server</span>: <span class="string">Apache/2.0.61 (Unix)</span></span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: <span class="string">http://api.qiutc.me</span></span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span>: <span class="string">GET, POST, PUT</span></span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span>: <span class="string">X-Custom-Header</span></span><br><span class="line"><span class="attribute">Content-Type</span>: <span class="string">text/html; charset=utf-8</span></span><br><span class="line"><span class="attribute">Content-Encoding</span>: <span class="string">gzip</span></span><br><span class="line"><span class="attribute">Content-Length</span>: <span class="string">0</span></span><br><span class="line"><span class="attribute">Keep-Alive</span>: <span class="string">timeout=2, max=100</span></span><br><span class="line"><span class="attribute">Connection</span>: <span class="string">Keep-Alive</span></span><br><span class="line"><span class="attribute">Content-Type</span>: <span class="string">text/plain</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Access-Control-Allow-Methods<br>å¿…éœ€ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡â€é¢„æ£€â€è¯·æ±‚ã€‚</p>
</li>
<li>Access-Control-Allow-Headers<br>å¦‚æœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬Access-Control-Request-Headerså­—æ®µï¼Œåˆ™Access-Control-Allow-Headerså­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨â€é¢„æ£€â€ä¸­è¯·æ±‚çš„å­—æ®µã€‚</li>
<li>Access-Control-Max-Age<br>è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯20å¤©ï¼ˆ1728000ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº”1728000ç§’ï¼ˆå³20å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚<h4 id="2ï¼‰æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”">2ï¼‰æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”</h4>ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„CORSè¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ªOriginå¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›åº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ªAccess-Control-Allow-Originå¤´ä¿¡æ¯å­—æ®µã€‚</li>
</ul>
<p><strong>å‚è€ƒï¼š</strong><a href="">ã€Šè·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£ã€‹</a><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2016/04/cors.html</a><br>)<br>é˜®å¤§ç¥çš„æ–‡ç« ï¼Œå¤åˆ¶ç²˜è´´äº†ä¸å°‘ã€‚</p>
<h1 id="jsonp">jsonp</h1><p>jsonp = json + padding<br>å…¶å®å¯¹äºå¸¸ç”¨æ€§æ¥è¯´ï¼Œjsonpåº”è¯¥æ˜¯ä½¿ç”¨æœ€ç»å¸¸çš„ä¸€ç§è·¨åŸŸæ–¹å¼äº†ï¼Œä»–ä¸å—æµè§ˆå™¨å…¼å®¹æ€§çš„é™åˆ¶ã€‚ä½†æ˜¯ä»–ä¹Ÿæœ‰ä»–çš„å±€é™æ€§ï¼Œåªèƒ½å‘é€ GET è¯·æ±‚ï¼Œéœ€è¦æœåŠ¡ç«¯å’Œå‰ç«¯è§„å®šå¥½ï¼Œå†™æ³•ä¸‘é™‹ã€‚<br>å®ƒçš„åŸç†åœ¨äºæµè§ˆå™¨è¯·æ±‚ script èµ„æºä¸å—åŒæºç­–ç•¥é™åˆ¶ï¼Œå¹¶ä¸”è¯·æ±‚åˆ° script èµ„æºåç«‹å³æ‰§è¡Œã€‚<br>ä¸»è¦åšæ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li><p>åœ¨æµè§ˆå™¨ç«¯ï¼š<br>é¦–å…ˆå…¨å±€æ³¨å†Œä¸€ä¸ªcallbackå›è°ƒå‡½æ•°ï¼Œè®°ä½è¿™ä¸ªå‡½æ•°åå­—ï¼ˆæ¯”å¦‚ï¼šresolveJsonï¼‰ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°æ˜¯æœŸæœ›çš„åˆ°çš„æœåŠ¡ç«¯è¿”å›æ•°æ®ï¼Œå‡½æ•°çš„å…·ä½“å†…å®¹æ˜¯å¤„ç†è¿™ä¸ªæ•°æ®ã€‚<br>ç„¶ååŠ¨æ€ç”Ÿæˆä¸€ä¸ª script æ ‡ç­¾ï¼Œsrc ä¸ºï¼šè¯·æ±‚èµ„æºçš„åœ°å€ï¼‹è·å–å‡½æ•°çš„å­—æ®µåï¼‹å›è°ƒå‡½æ•°åç§°ï¼Œè¿™é‡Œçš„è·å–å‡½æ•°çš„å­—æ®µåæ˜¯è¦å’ŒæœåŠ¡ç«¯çº¦å®šå¥½çš„ï¼Œæ˜¯ä¸ºäº†è®©æœåŠ¡ç«¯æ‹¿åˆ°å›è°ƒå‡½æ•°åç§°ã€‚ï¼ˆå¦‚ï¼š<code>www.qiute.com?callbackName=resolveJson</code>ï¼‰ã€‚</p>
<figure class="highlight nimrod"><table><tr><td class="code"><pre><span class="line">function resolveJosn(<span class="literal">result</span>) &#123;</span><br><span class="line">	console.log(<span class="literal">result</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> jsonpScript= document.createElement(<span class="string">"script"</span>);</span><br><span class="line">jsonpScript.<span class="keyword">type</span> = <span class="string">"text/javascript"</span>;</span><br><span class="line">jsonpScript.src = <span class="string">"http://www.qiute.com?callbackName=resolveJson"</span>;</span><br><span class="line">document.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>].appendChild(jsonpScript);</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœåŠ¡ç«¯<br>åœ¨æ¥å—åˆ°æµè§ˆå™¨ç«¯ script çš„è¯·æ±‚ä¹‹åï¼Œä»urlçš„queryçš„callbackNameè·å–åˆ°å›è°ƒå‡½æ•°çš„åå­—ï¼Œä¾‹å­ä¸­æ˜¯<code>resolveJson</code>ã€‚<br>ç„¶ååŠ¨æ€ç”Ÿæˆä¸€æ®µjavascriptç‰‡æ®µå»ç»™è¿™ä¸ªå‡½æ•°ä¼ å…¥å‚æ•°æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="tag">resolveJson</span>(<span class="rules">&#123;<span class="rule"><span class="attribute">name</span>:<span class="value"> <span class="string">'qiutc'</span></span></span></span>&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰§è¡Œ<br>æœåŠ¡ç«¯è¿”å›è¿™ä¸ª script ä¹‹åï¼Œæµè§ˆå™¨ç«¯è·å–åˆ° script èµ„æºï¼Œç„¶åä¼šç«‹å³æ‰§è¡Œè¿™ä¸ª javascriptï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢é‚£ä¸ªç‰‡æ®µã€‚è¿™æ ·å°±èƒ½æ ¹æ®ä¹‹å‰å†™å¥½çš„å›è°ƒå‡½æ•°å¤„ç†è¿™äº›æ•°æ®äº†ã€‚</p>
</li>
</ul>
<p>åœ¨ä¸€äº›ç¬¬ä¸‰æ–¹åº“å¾€å¾€éƒ½ä¼šå°è£…jsonpçš„æ“ä½œï¼Œæ¯”å¦‚ jQuery çš„<code>$.getJSON</code>ã€‚</p>
<h1 id="document-domain">document.domain</h1><p>ä¸€ä¸ªé¡µé¢æ¡†æ¶ï¼ˆiframeï¼frameï¼‰ä¹‹é—´ï¼ˆçˆ¶å­æˆ–åŒè¾ˆï¼‰ï¼Œæ˜¯èƒ½å¤Ÿè·å–åˆ°å½¼æ­¤çš„windowå¯¹è±¡çš„ï¼Œä½†æ˜¯è¿™ä¸ª window ä¸èƒ½æ‹¿åˆ°æ–¹æ³•å’Œå±æ€§ï¼ˆå°¼ç›è¿™æœ‰ä»€ä¹ˆç”¨ï¼Œç”©è„¸ï¼‰ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// å½“å‰é¡µé¢åŸŸå http://blog.qiutc.me/a.html</span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onLoad</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> iframe =<span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>);</span><br><span class="line">	<span class="keyword">var</span> iframeWindow = iframe.contentWindow; <span class="comment">// è¿™é‡Œå¯ä»¥è·å– iframe é‡Œé¢ window å¯¹è±¡ï¼Œä½†æ˜¯å‡ ä¹æ²¡ç”¨</span></span><br><span class="line">	<span class="keyword">var</span> doc = iframeWindow.document; <span class="comment">// è·å–ä¸åˆ°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">iframe</span> <span class="attribute">src</span>=<span class="value">"http://www.qiutc.me/b.html"</span> <span class="attribute">onload</span>=<span class="value">"onLoad()"</span><span class="value">&lt;</span>/<span class="attribute">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™ï¼Œ<code>document.domain</code> å°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ï¼Œæˆ‘ä»¬åªè¦æŠŠ <code>http://blog.qiutc.me/a.html</code> å’Œ <code>http://www.qiutc.me/b.html</code> è¿™ä¸¤ä¸ªé¡µé¢çš„ <code>document.domain</code> éƒ½è®¾æˆç›¸åŒçš„åŸŸåå°±å¯ä»¥äº†ã€‚<br>å‰ææ¡ä»¶ï¼šè¿™ä¸¤ä¸ªåŸŸåå¿…é¡»å±äºåŒä¸€ä¸ªåŸºç¡€åŸŸå!è€Œä¸”æ‰€ç”¨çš„åè®®ï¼Œç«¯å£éƒ½è¦ä¸€è‡´ã€‚<br>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>document.domain</code> çš„è®¾ç½®æ˜¯æœ‰é™åˆ¶çš„ï¼Œæˆ‘ä»¬åªèƒ½æŠŠ <code>document.domain</code> è®¾ç½®æˆè‡ªèº«æˆ–æ›´é«˜ä¸€çº§çš„çˆ¶åŸŸï¼Œä¸”ä¸»åŸŸå¿…é¡»ç›¸åŒã€‚ä¾‹å¦‚ï¼š<code>a.b.example.com</code> ä¸­æŸä¸ªæ–‡æ¡£çš„ <code>document.domain</code> å¯ä»¥è®¾æˆ<code>a.b.example.com</code>ã€<code>b.example.com</code>ã€<code>example.com</code>ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œä½†æ˜¯ä¸å¯ä»¥è®¾æˆ <code>c.a.b.example.com</code>,å› ä¸ºè¿™æ˜¯å½“å‰åŸŸçš„å­åŸŸï¼Œä¹Ÿä¸å¯ä»¥è®¾æˆ<code>baidu.com</code>,å› ä¸ºä¸»åŸŸå·²ç»ä¸ç›¸åŒäº†ã€‚<br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡jsè®¿é—®åˆ°iframeä¸­çš„å„ç§å±æ€§å’Œå¯¹è±¡äº†ã€‚<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// ä¸»é¡µé¢ï¼šhttp://blog.qiutc.me/a.html</span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">'qiutc.me'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onLoad</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> iframe =<span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>);</span><br><span class="line">	<span class="keyword">var</span> iframeWindow = iframe.contentWindow; <span class="comment">// è¿™é‡Œå¯ä»¥è·å– iframe é‡Œé¢ window å¯¹è±¡å¹¶ä¸”èƒ½å¾—åˆ°æ–¹æ³•å’Œå±æ€§</span></span><br><span class="line">	<span class="keyword">var</span> doc = iframeWindow.document; <span class="comment">// è·å–åˆ°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">iframe</span> <span class="attribute">src</span>=<span class="value">"http://www.qiutc.me/b.html"</span> <span class="attribute">onload</span>=<span class="value">"onLoad()"</span><span class="value">&lt;</span>/<span class="attribute">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// iframe é‡Œé¢çš„é¡µé¢</span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">'qiutc.me'</span>;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="window-name">window.name</h1><p>windowå¯¹è±¡æœ‰ä¸ªnameå±æ€§ï¼Œè¯¥å±æ€§æœ‰ä¸ªç‰¹å¾ï¼šå³åœ¨ä¸€ä¸ªçª—å£(window)çš„ç”Ÿå‘½å‘¨æœŸå†…,çª—å£è½½å…¥çš„æ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯å…±äº«ä¸€ä¸ª <code>window.name</code> çš„ï¼Œæ¯ä¸ªé¡µé¢å¯¹ <code>window.name</code> éƒ½æœ‰è¯»å†™çš„æƒé™ï¼Œ<code>window.name</code> æ˜¯æŒä¹…å­˜åœ¨ä¸€ä¸ªçª—å£è½½å…¥è¿‡çš„æ‰€æœ‰é¡µé¢ä¸­çš„ï¼Œå¹¶ä¸ä¼šå› æ–°é¡µé¢çš„è½½å…¥è€Œè¿›è¡Œé‡ç½®ã€‚<br>æ¯”å¦‚æœ‰ä¸€ä¸ª<code>www.qiutc.me/a.html</code>é¡µé¢ï¼Œéœ€è¦é€šè¿‡a.htmlé¡µé¢é‡Œçš„jsæ¥è·å–å¦ä¸€ä¸ªä½äºä¸åŒåŸŸä¸Šçš„é¡µé¢<code>www.qiutc.com/data.html</code>é‡Œçš„æ•°æ®ã€‚<br>data.htmlé¡µé¢é‡Œçš„ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯ç»™å½“å‰çš„window.nameè®¾ç½®ä¸€ä¸ªa.htmlé¡µé¢æƒ³è¦å¾—åˆ°çš„æ•°æ®å€¼ã€‚data.htmlé‡Œçš„ä»£ç ï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'æˆ‘æ˜¯è¢«æœŸæœ›å¾—åˆ°çš„æ•°æ®'</span>;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆåœ¨ <code>a.html</code> é¡µé¢ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆæŠŠ <code>data.html</code> é¡µé¢è½½å…¥è¿›æ¥å‘¢ï¼Ÿæ˜¾ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ <code>a.html</code> é¡µé¢ä¸­é€šè¿‡æ”¹å˜ <code>window.location</code> æ¥è½½å…¥data.htmlé¡µé¢ï¼ˆè¿™ç®€ç›´æ‰¯è›‹ï¼‰å› ä¸ºæˆ‘ä»¬æƒ³è¦å³ä½¿ <code>a.html</code>é¡µé¢ä¸è·³è½¬ä¹Ÿèƒ½å¾—åˆ° <code>data.html</code> é‡Œçš„æ•°æ®ã€‚<br>ç­”æ¡ˆå°±æ˜¯åœ¨ <code>a.html</code> é¡µé¢ä¸­ä½¿ç”¨ä¸€ä¸ªéšè—çš„ <code>iframe</code> æ¥å……å½“ä¸€ä¸ªä¸­é—´äººè§’è‰²ï¼Œç”± <code>iframe</code> å»è·å– <code>data.html</code> çš„æ•°æ®ï¼Œç„¶å <code>a.html</code> å†å»å¾—åˆ° <code>iframe</code> è·å–åˆ°çš„æ•°æ®ã€‚<br>å……å½“ä¸­é—´äººçš„ <code>iframe</code> æƒ³è¦è·å–åˆ°<code>data.html</code>çš„é€šè¿‡<code>window.name</code>è®¾ç½®çš„æ•°æ®ï¼Œåªéœ€è¦æŠŠè¿™ä¸ª<code>iframe</code>çš„srcè®¾ä¸º<code>www.qiutc.com/data.html</code>å°±è¡Œäº†ã€‚ç„¶å<code>a.html</code>æƒ³è¦å¾—åˆ°<code>iframe</code>æ‰€è·å–åˆ°çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æƒ³è¦å¾—åˆ°<code>iframe</code>çš„<code>window.name</code>çš„å€¼ï¼Œè¿˜å¿…é¡»æŠŠè¿™ä¸ª<code>iframe</code>çš„<code>src</code>è®¾æˆè·Ÿ<code>a.html</code>é¡µé¢åŒä¸€ä¸ªåŸŸæ‰è¡Œï¼Œä¸ç„¶æ ¹æ®å‰é¢è®²çš„åŒæºç­–ç•¥ï¼Œ<code>a.html</code>æ˜¯ä¸èƒ½è®¿é—®åˆ°<code>iframe</code>é‡Œ<code>çš„window.name</code>å±æ€§çš„ã€‚è¿™å°±æ˜¯æ•´ä¸ªè·¨åŸŸè¿‡ç¨‹ã€‚<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// a.html</span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> iframe =<span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>);</span><br><span class="line">		iframe.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">var</span> data = iframe.contentWindow.name; <span class="comment">// å¾—åˆ°</span></span><br><span class="line">		&#125;</span><br><span class="line">		iframe.src = <span class="string">'b.html'</span>;  <span class="comment">// è¿™é‡Œbå’ŒaåŒæº</span></span><br><span class="line">	&#125;</span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">iframe</span> <span class="attribute">src</span>=<span class="value">"http://www.qiutc.com/data.html"</span> <span class="attribute">style</span>=<span class="value">"display:none"</span> <span class="attribute">onload</span>=<span class="value">"getData()"</span><span class="value">&lt;</span>/<span class="attribute">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="window-postMessage">window.postMessage</h1><p><code>window.postMessage(message, targetOrigin)</code>  æ–¹æ³•æ˜¯html5æ–°å¼•è¿›çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å‘å…¶å®ƒçš„windowå¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œæ— è®ºè¿™ä¸ªwindowå¯¹è±¡æ˜¯å±äºåŒæºæˆ–ä¸åŒæºã€‚å…¼å®¹æ€§ï¼š<br><img src="/img/cross-domain-postmessage.png" alt="cross-domain-postmessage"><br><a href="http://caniuse.com/#search=postMessage" target="_blank" rel="external">http://caniuse.com/#search=postMessage</a></p>
<p>è°ƒç”¨postMessageæ–¹æ³•çš„windowå¯¹è±¡æ˜¯æŒ‡è¦æ¥æ”¶æ¶ˆæ¯çš„é‚£ä¸€ä¸ªwindowå¯¹è±¡ï¼Œè¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°messageä¸ºè¦å‘é€çš„æ¶ˆæ¯ï¼Œç±»å‹åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼›ç¬¬äºŒä¸ªå‚æ•°targetOriginç”¨æ¥é™å®šæ¥æ”¶æ¶ˆæ¯çš„é‚£ä¸ªwindowå¯¹è±¡æ‰€åœ¨çš„åŸŸï¼Œå¦‚æœä¸æƒ³é™å®šåŸŸï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *  ã€‚<br>éœ€è¦æ¥æ”¶æ¶ˆæ¯çš„windowå¯¹è±¡ï¼Œå¯æ˜¯é€šè¿‡ç›‘å¬è‡ªèº«çš„messageäº‹ä»¶æ¥è·å–ä¼ è¿‡æ¥çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯å†…å®¹å‚¨å­˜åœ¨è¯¥äº‹ä»¶å¯¹è±¡çš„dataå±æ€§ä¸­ã€‚<br>ä¸Šé¢æ‰€è¯´çš„å‘å…¶ä»–windowå¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œå…¶å®å°±æ˜¯æŒ‡ä¸€ä¸ªé¡µé¢æœ‰å‡ ä¸ªæ¡†æ¶çš„é‚£ç§æƒ…å†µï¼Œå› ä¸ºæ¯ä¸€ä¸ªæ¡†æ¶éƒ½æœ‰ä¸€ä¸ªwindowå¯¹è±¡ã€‚åœ¨è®¨è®ºç¬¬ç§æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œä¸åŒåŸŸçš„æ¡†æ¶é—´æ˜¯å¯ä»¥è·å–åˆ°å¯¹æ–¹çš„windowå¯¹è±¡çš„ï¼Œè™½ç„¶æ²¡ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯å¯ç”¨çš„ï¼<code>window.postMessage</code>ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæœ‰ä¸¤ä¸ªé¡µé¢ï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// ä¸»é¡µé¢  blog.qiutc.com</span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onLoad</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> iframe =<span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>);</span><br><span class="line">	<span class="keyword">var</span> iframeWindow = iframe.contentWindow;</span><br><span class="line">	iframeWindow.postMessage(<span class="string">"I'm message from main page."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">iframe</span> <span class="attribute">src</span>=<span class="value">"http://www.qiutc.me/b.html"</span> <span class="attribute">onload</span>=<span class="value">"onLoad()"</span><span class="value">&lt;</span>/<span class="attribute">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// b é¡µé¢</span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">	e = e || event;</span><br><span class="line">	<span class="built_in">console</span>.log(e.data);</span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="CSST_(CSS_Text_Transformation)">CSST (CSS Text Transformation)</h1><p>ä¸€ç§ç”¨ CSS è·¨åŸŸä¼ è¾“æ–‡æœ¬çš„æ–¹æ¡ˆã€‚<br>ä¼˜ç‚¹ï¼šç›¸æ¯” JSONP æ›´ä¸ºå®‰å…¨ï¼Œä¸éœ€è¦æ‰§è¡Œè·¨ç«™è„šæœ¬ã€‚<br>ç¼ºç‚¹ï¼šæ²¡æœ‰ JSONP é€‚é…å¹¿ï¼ŒCSST ä¾èµ–æ”¯æŒ CSS3 çš„æµè§ˆå™¨ã€‚<br>åŸç†ï¼šé€šè¿‡è¯»å– CSS3 content å±æ€§è·å–ä¼ é€å†…å®¹ã€‚<br>å…·ä½“å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/zswang/csst" target="_blank" rel="external">CSST (CSS Text Transformation)</a></p>
<h1 id="åˆ©ç”¨flash">åˆ©ç”¨flash</h1><p>flash å˜›ï¼Œè¿™ä¸ªä¸œè¥¿æ³¨å®šç­äº¡ï¼Œä¸æƒ³è¯´äº†ã€‚ã€‚ã€‚</p>
</div>

    <div class="post-sidebar">
  <div class="toggle-btn" id="toggle-btn">
    <i class="fa fa-reorder"></i>
  </div>
  <section class="post-toc-wrap" id="post-sidebar">
    <h2 class="toc-title">å†…å®¹ç›®å½•</h2>
    <div class="post-toc">
      
      
        <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#è·¨åŸŸæ•´ç†"><span class="nav-text">è·¨åŸŸæ•´ç†</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è·¨åŸŸèµ„æºå…±äº«_CORS"><span class="nav-text">è·¨åŸŸèµ„æºå…±äº« CORS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸¤ç§è¯·æ±‚"><span class="nav-text">ä¸¤ç§è¯·æ±‚</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç®€å•è¯·æ±‚ï¼ˆsimple_requestï¼‰"><span class="nav-text">ç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¡ä»¶"><span class="nav-text">æ¡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿‡ç¨‹"><span class="nav-text">è¿‡ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-æœåŠ¡ç«¯å…è®¸"><span class="nav-text">1.æœåŠ¡ç«¯å…è®¸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-æœåŠ¡ç«¯æ‹’ç»"><span class="nav-text">2.æœåŠ¡ç«¯æ‹’ç»</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#éç®€å•è¯·æ±‚"><span class="nav-text">éç®€å•è¯·æ±‚</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¡ä»¶-1"><span class="nav-text">æ¡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿‡ç¨‹-1"><span class="nav-text">è¿‡ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1ï¼‰é¢„æ£€è¯·æ±‚"><span class="nav-text">1ï¼‰é¢„æ£€è¯·æ±‚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2ï¼‰æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”"><span class="nav-text">2ï¼‰æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#jsonp"><span class="nav-text">jsonp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#document-domain"><span class="nav-text">document.domain</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#window-name"><span class="nav-text">window.name</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#window-postMessage"><span class="nav-text">window.postMessage</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CSST_(CSS_Text_Transformation)"><span class="nav-text">CSST (CSS Text Transformation)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#åˆ©ç”¨flash"><span class="nav-text">åˆ©ç”¨flash</span></a></li></ol></div>
      
    </div>
  </section>
</div>


  </div>

  <footer class="post-footer">
    
      <div class="post-tags">
        
          <a href="/tags#è·¨åŸŸ" rel="tag">#è·¨åŸŸ</a>
        
      </div>
    
    
  <style>
    .donation {
      width: 100%;
      margin-top: 2rem;
    }
    .donation .text {
      color: #333;
      font-size: .8rem;
      cursor: pointer;
      text-decoration: underline;
    }
    .donation .text:hover {
      color: rgb(63,134,181);
    }
    .donation .img-box {
      transition: all .3s;
      width: 0;
      height: 0;
      margin: 1rem auto;
      overflow: hidden;
    }
    .donation .img-box img {
      width: 100%;
      height: 100%;
    }
    .donation #donation {
      display: none;
    }
    .donation #donation:checked + .img-box {
      width: 16rem;
      height: 16rem;
    }
  </style>
  <div class="donation">
    <label class="text" for="donation">
      å¦‚æœä½ è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¹¶ä¸”æƒ³ä¸ºæˆ‘ä¹°ä¸€æ¯å’–å•¡ï¼Œç‚¹è¿™é‡Œï½
    </label>
    <input type="checkbox" name="donation" id="donation">
    <div class="img-box">
      <img src="/img/donation.png" alt="donation" />
    </div>
    </style>
  </div>


  </footer>

</article>




      
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="post/cross-domain-collections.html"
           data-title="å‰ç«¯è·¨åŸŸçš„æ•´ç†" data-url="http://qiutc.me/post/cross-domain-collections.html">
      </div>
    
  </div>




    </main>

    <footer class="footer clearfix">
  <div class="copyright" >
    <span>Copyright</span>
    
    &copy;  2015-
    <span itemprop="copyrightYear">2016</span>
    <span class="author" itemprop="copyrightHolder">é˜¿åŸğŸ˜‡</span>
  </div>

  <div class="info">
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
      <span id="showDays" class="show-days"></span>
      <script>
      var birthDay = new Date('10/04/2015');
      var now = new Date();
      var duration = now.getTime() - birthDay.getTime();
      var total= Math.floor(duration / (1000 * 60 * 60 * 24));
      document.getElementById("showDays").innerHTML = "æœ¬ç«™å·²è¿è¡Œ "+total+" å¤©";
      </script>
      ---
    
    <span id="busuanzi_container_site_pv">
        æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
    </span>
  </div>

</footer>


  </div>

  <div class="back-top-btn" id="back-top-btn"><i class="fa fa-chevron-up"></i></div>





  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"qiutongcheng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     




<script type="text/javascript" src="/js/motto.min.js?v=0.0.1"></script>
<script type="text/javascript" src="/js/main.js?v=0.0.1"></script>


</body>
</html>
